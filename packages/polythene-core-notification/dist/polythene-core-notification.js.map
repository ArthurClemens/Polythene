{"version":3,"file":"polythene-core-notification.js","sources":["../../polythene-css-classes/notification.js","../src/index.js"],"sourcesContent":["\nexport default {\n  component:      \"pe-notification\",\n\n  // elements\n  action:         \"pe-notification__action\",\n  content:        \"pe-notification__content\",\n  holder:         \"pe-notification__holder\",\n  placeholder:    \"pe-notification__placeholder\",\n  title:          \"pe-notification__title\",\n\n  // states\n  hasContainer:   \"pe-notification--container\",\n  horizontal:     \"pe-notification--horizontal\",\n  multilineTitle: \"pe-notification__title--multi-line\",\n  vertical:       \"pe-notification--vertical\",\n  visible:        \"pe-notification--visible\",\n};","import { filterSupportedAttributes, transitionComponent, isClient, isServer, transitionStateReducer, REFERRER_COMPONENT } from \"polythene-core\";\nimport { Timer } from \"polythene-utilities\";\nimport classes from \"polythene-css-classes/notification\";\n\nconst DEFAULT_TIME_OUT = 3;\n\nconst setTitleStyles = titleEl => {\n  if (isServer) return;\n  const height = titleEl.getBoundingClientRect().height;\n  const lineHeight = parseInt(window.getComputedStyle(titleEl).lineHeight, 10);\n  const paddingTop = parseInt(window.getComputedStyle(titleEl).paddingTop, 10);\n  const paddingBottom = parseInt(window.getComputedStyle(titleEl).paddingBottom, 10);\n  if (height > (lineHeight + paddingTop + paddingBottom)) {\n    titleEl.classList.add(classes.multilineTitle);\n  }\n};\n\nconst initialTransitionState = {\n  isVisible: false,\n  isTransitioning: false,\n  isHiding: false,\n};\n\nexport const _Notification = ({ h, a, useState, useEffect, useRef, getRef, useReducer, ...props }) => {\n  const [transitionState, dispatchTransitionState] = useReducer(transitionStateReducer, initialTransitionState);\n  const [domElement, setDomElement] = useState();\n  const [isPaused, setIsPaused] = useState(false);\n  const containerElRef = useRef();\n  const titleElRef = useRef();\n  const timerRef = useRef(new Timer());\n  \n  const isVisible = transitionState.isVisible;\n  const isTransitioning = transitionState.isTransitioning;\n  const isHiding = transitionState.isHiding;\n  const timer = timerRef.current;\n\n  const transitionOptions = ({ isShow, referrer }) => ({\n    dispatchTransitionState,\n    instanceId: props.instanceId,\n    props,\n    isShow,\n    beforeTransition: stopTimer,\n    afterTransition: isShow\n      ? () => {\n        // set timer to hide in a few seconds\n        const timeout = props.timeout;\n        if (timeout === 0) {\n          // do not time out\n        } else {\n          const timeoutSeconds = timeout !== undefined\n            ? timeout\n            : DEFAULT_TIME_OUT;\n          timer.start(() => hideNotification({ referrer: REFERRER_COMPONENT }), timeoutSeconds);\n        }     \n      }\n      : null,\n    domElements: {\n      el: domElement,\n      containerEl: containerElRef.current\n    },\n    showClass: classes.visible,\n    referrer\n  });\n\n  const showNotification = () =>\n    transitionComponent(transitionOptions({ isShow: true }));\n\n  const hideNotification = ({ referrer } = {}) =>\n    transitionComponent(transitionOptions({ isShow: false, referrer }));\n\n  const pause = () => {\n    setIsPaused(true);\n    if (timer) {\n      timer.pause();\n    }\n  };\n  \n  const unpause = () => {\n    setIsPaused(false);\n    if (timer) {\n      timer.resume();\n    }\n  };\n  \n  const stopTimer = () => {\n    if (timer) {\n      timer.stop();\n    }\n  };\n\n  useEffect(\n    () => {\n      return () => {\n        stopTimer();\n      }\n    },\n    []\n  );\n\n  // DOM elements\n  useEffect(\n    () => {\n      if (!domElement) {\n        return;\n      }\n      if (isClient) {\n        // props.holderSelector is passed as option to Multiple\n        containerElRef.current = document.querySelector(props.containerSelector || props.holderSelector);\n        if (!containerElRef.current) {\n          console.error(\"No container element found\"); // eslint-disable-line no-console\n        }\n        if (props.containerSelector && containerElRef.current) {\n          containerElRef.current.classList.add(classes.hasContainer);\n        }\n      }\n\n      titleElRef.current = domElement.querySelector(`.${classes.title}`);\n      if (titleElRef.current) {\n        setTitleStyles(titleElRef.current);\n      }\n    },\n    [domElement]\n  );\n\n  // Show / hide logic\n  useEffect(\n    () => {\n      if (!domElement || isTransitioning || isHiding) {\n        return;\n      }\n      if (props.hide) {\n        if (isVisible) {\n          hideNotification();\n        }\n      } else if (props.show) {\n        if (!isVisible) {\n          showNotification();\n        }\n      }\n    },\n    [domElement, isTransitioning, isVisible, isHiding, props.hide, props.show]\n  );\n\n  // Pause logic\n  useEffect(\n    () => {\n      if (!domElement || isTransitioning || isHiding) {\n        return;\n      }\n      if (props.unpause) {\n        if (isPaused) {\n          unpause();\n        }\n      } else if (props.pause) {\n        if (!isPaused) {\n          pause();\n        }\n      }\n    },\n    [domElement, isTransitioning, isHiding, props.pause, props.unpause]\n  );\n  \n  const componentProps = Object.assign(\n    {}, \n    filterSupportedAttributes(props, { remove: [\"style\"] }), // style set in content, and set by show/hide transition\n    getRef(dom => dom && !domElement && (\n      setDomElement(dom),\n      props.ref && props.ref(dom)\n    )),\n    props.testId && { \"data-test-id\": props.testId },\n    {\n      className: [\n        classes.component,\n        props.fromMultipleClassName,\n        // classes.visible is set in showNotification though transition\n        props.tone === \"light\" ? null : \"pe-dark-tone\", // default dark tone\n        props.containerSelector ? classes.hasContainer : null,\n        props.layout === \"vertical\" ? classes.vertical : classes.horizontal,\n        props.tone === \"dark\" ? \"pe-dark-tone\" : null,\n        props.tone === \"light\" ? \"pe-light-tone\" : null,\n        props.className || props[a.class],\n      ].join(\" \"),\n      [a.onclick]: e => e.preventDefault()\n    }\n  );\n\n  const contents = h(\"div\",\n    {\n      className: classes.content,\n      style: props.style,\n    },\n    props.content || [\n      props.title\n        ? h(\"div\",\n          { className: classes.title },\n          props.title\n        )\n        : null,\n      props.action\n        ? h(\"div\",\n          { className: classes.action },\n          props.action\n        )\n        : null\n    ]\n  );\n  const content = [\n    props.before,\n    contents,\n    props.after\n  ];\n  return h(props.element || \"div\", componentProps, content);\n};\n"],"names":["component","action","content","holder","placeholder","title","hasContainer","horizontal","multilineTitle","vertical","visible","initialTransitionState","isVisible","isTransitioning","isHiding","h","a","useState","useEffect","useRef","getRef","useReducer","props","transitionStateReducer","transitionState","dispatchTransitionState","domElement","setDomElement","isPaused","setIsPaused","containerElRef","titleElRef","timerRef","Timer","timer","current","transitionOptions","isShow","referrer","instanceId","beforeTransition","stopTimer","afterTransition","timeout","timeoutSeconds","undefined","start","hideNotification","REFERRER_COMPONENT","domElements","el","containerEl","showClass","classes","transitionComponent","stop","titleEl","isClient","document","querySelector","containerSelector","holderSelector","console","error","classList","add","isServer","getBoundingClientRect","height","parseInt","window","getComputedStyle","lineHeight","paddingTop","paddingBottom","hide","show","unpause","resume","pause","componentProps","_extends","filterSupportedAttributes","remove","dom","ref","testId","className","fromMultipleClassName","tone","layout","join","onclick","e","preventDefault","contents","style","before","after","element"],"mappings":"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"}