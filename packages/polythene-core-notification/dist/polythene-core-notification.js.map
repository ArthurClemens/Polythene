{"version":3,"file":"polythene-core-notification.js","sources":["../../polythene-css-classes/notification.js","../src/index.js"],"sourcesContent":["\nexport default {\n  component:      \"pe-notification\",\n\n  // elements\n  action:         \"pe-notification__action\",\n  content:        \"pe-notification__content\",\n  holder:         \"pe-notification__holder\",\n  placeholder:    \"pe-notification__placeholder\",\n  title:          \"pe-notification__title\",\n\n  // states\n  hasContainer:   \"pe-notification--container\",\n  horizontal:     \"pe-notification--horizontal\",\n  multilineTitle: \"pe-notification__title--multi-line\",\n  vertical:       \"pe-notification--vertical\",\n  visible:        \"pe-notification--visible\",\n};","import { filterSupportedAttributes, transitionComponent, isClient, isServer, transitionStateReducer, initialTransitionState } from \"polythene-core\";\nimport { Timer } from \"polythene-utilities\";\nimport classes from \"polythene-css-classes/notification\";\n\nconst DEFAULT_TIME_OUT = 3;\n\nconst setTitleStyles = titleEl => {\n  if (isServer) return;\n  const height = titleEl.getBoundingClientRect().height;\n  const lineHeight = parseInt(window.getComputedStyle(titleEl).lineHeight, 10);\n  const paddingTop = parseInt(window.getComputedStyle(titleEl).paddingTop, 10);\n  const paddingBottom = parseInt(window.getComputedStyle(titleEl).paddingBottom, 10);\n  if (height > (lineHeight + paddingTop + paddingBottom)) {\n    titleEl.classList.add(classes.multilineTitle);\n  }\n};\n\nexport const _Notification = ({ h, a, useState, useEffect, useRef, getRef, useReducer, ...props }) => {\n  const [transitionState, dispatchTransitionState] = useReducer(transitionStateReducer, initialTransitionState);\n  const [domElement, setDomElement] = useState();\n  const [isPaused, setIsPaused] = useState(false);\n  const containerElRef = useRef();\n  const titleElRef = useRef();\n  const timerRef = useRef(new Timer());\n  \n  const isVisible = (transitionState || initialTransitionState).isVisible;\n  const isTransitioning = (transitionState || initialTransitionState).isTransitioning;\n  const isHiding = (transitionState || initialTransitionState).isHiding;\n  const timer = timerRef && timerRef.current;\n\n  const transitionOptions = ({ isShow, referrer }) => ({\n    dispatchTransitionState,\n    instanceId: props.instanceId,\n    props,\n    isShow,\n    beforeTransition: stopTimer,\n    afterTransition: isShow\n      ? () => {\n        // set timer to hide in a few seconds\n        const timeout = props.timeout;\n        if (timeout === 0) {\n          // do not time out\n        } else {\n          const timeoutSeconds = timeout !== undefined\n            ? timeout\n            : DEFAULT_TIME_OUT;\n          timer.start(() => hideNotification(), timeoutSeconds);\n        }     \n      }\n      : null,\n    domElements: {\n      el: domElement,\n      containerEl: containerElRef.current\n    },\n    showClass: classes.visible,\n    referrer\n  });\n\n  const showNotification = () =>\n    transitionComponent(transitionOptions({ isShow: true }));\n\n  const hideNotification = ({ referrer } = {}) =>\n    transitionComponent(transitionOptions({ isShow: false, referrer }));\n\n  const pause = () => {\n    setIsPaused(true);\n    if (timer) {\n      timer.pause();\n    }\n  };\n  \n  const unpause = () => {\n    setIsPaused(false);\n    if (timer) {\n      timer.resume();\n    }\n  };\n  \n  const stopTimer = () => {\n    if (timer) {\n      timer.stop();\n    }\n  };\n\n  useEffect(\n    () => {\n      return () => {\n        stopTimer();\n      }\n    },\n    []\n  );\n\n  // DOM elements\n  useEffect(\n    () => {\n      if (!domElement) {\n        return;\n      }\n      if (isClient) {\n        // props.holderSelector is passed as option to Multiple\n        containerElRef.current = document.querySelector(props.containerSelector || props.holderSelector);\n        if (!containerElRef.current) {\n          console.error(\"No container element found\"); // eslint-disable-line no-console\n        }\n        if (props.containerSelector && containerElRef.current) {\n          containerElRef.current.classList.add(classes.hasContainer);\n        }\n      }\n\n      titleElRef.current = domElement.querySelector(`.${classes.title}`);\n      if (titleElRef.current) {\n        setTitleStyles(titleElRef.current);\n      }\n    },\n    [domElement]\n  );\n\n  // Show / hide logic\n  useEffect(\n    () => {\n      if (!domElement || isTransitioning || isHiding) {\n        return;\n      }\n      if (props.hide) {\n        if (isVisible) {\n          hideNotification();\n        }\n      } else if (props.show) {\n        if (!isVisible) {\n          showNotification();\n        }\n      }\n    },\n    [domElement, isTransitioning, isVisible, isHiding, props.hide, props.show]\n  );\n\n  // Pause logic\n  useEffect(\n    () => {\n      if (!domElement || isTransitioning || isHiding) {\n        return;\n      }\n      if (props.unpause) {\n        if (isPaused) {\n          unpause();\n        }\n      } else if (props.pause) {\n        if (!isPaused) {\n          pause();\n        }\n      }\n    },\n    [domElement, isTransitioning, isHiding, props.pause, props.unpause]\n  );\n  \n  const componentProps = Object.assign(\n    {}, \n    filterSupportedAttributes(props, { remove: [\"style\"] }), // style set in content, and set by show/hide transition\n    getRef(dom => dom && !domElement && (\n      setDomElement(dom),\n      props.ref && props.ref(dom)\n    )),\n    props.testId && { \"data-test-id\": props.testId },\n    {\n      className: [\n        classes.component,\n        props.fromMultipleClassName,\n        // classes.visible is set in showNotification though transition\n        props.tone === \"light\" ? null : \"pe-dark-tone\", // default dark tone\n        props.containerSelector ? classes.hasContainer : null,\n        props.layout === \"vertical\" ? classes.vertical : classes.horizontal,\n        props.tone === \"dark\" ? \"pe-dark-tone\" : null,\n        props.tone === \"light\" ? \"pe-light-tone\" : null,\n        props.className || props[a.class],\n      ].join(\" \"),\n      [a.onclick]: e => e.preventDefault()\n    }\n  );\n\n  const contents = h(\"div\",\n    {\n      className: classes.content,\n      style: props.style,\n    },\n    props.content || [\n      props.title\n        ? h(\"div\",\n          { className: classes.title },\n          props.title\n        )\n        : null,\n      props.action\n        ? h(\"div\",\n          { className: classes.action },\n          props.action\n        )\n        : null\n    ]\n  );\n  const content = [\n    props.before,\n    contents,\n    props.after\n  ];\n  return h(props.element || \"div\", componentProps, content);\n};\n"],"names":["component","action","content","holder","placeholder","title","hasContainer","horizontal","multilineTitle","vertical","visible","h","a","useState","useEffect","useRef","getRef","useReducer","props","transitionStateReducer","initialTransitionState","transitionState","dispatchTransitionState","domElement","setDomElement","isPaused","setIsPaused","containerElRef","titleElRef","timerRef","Timer","isVisible","isTransitioning","isHiding","timer","current","transitionOptions","isShow","referrer","instanceId","beforeTransition","stopTimer","afterTransition","timeout","timeoutSeconds","undefined","start","hideNotification","domElements","el","containerEl","showClass","classes","transitionComponent","stop","titleEl","isClient","document","querySelector","containerSelector","holderSelector","console","error","classList","add","isServer","getBoundingClientRect","height","parseInt","window","getComputedStyle","lineHeight","paddingTop","paddingBottom","hide","show","unpause","resume","pause","componentProps","_extends","filterSupportedAttributes","remove","dom","ref","testId","className","fromMultipleClassName","tone","layout","join","onclick","e","preventDefault","contents","style","before","after","element"],"mappings":"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"}