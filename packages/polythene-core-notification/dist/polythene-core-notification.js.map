{"version":3,"file":"polythene-core-notification.js","sources":["../../polythene-css-classes/notification.js","../src/notification-instance.js"],"sourcesContent":["\nexport default {\n  component:      \"pe-notification\",\n\n  // elements\n  action:         \"pe-notification__action\",\n  content:        \"pe-notification__content\",\n  holder:         \"pe-notification__holder\",\n  placeholder:    \"pe-notification__placeholder\",\n  title:          \"pe-notification__title\",\n\n  // states\n  hasContainer:   \"pe-notification--container\",\n  horizontal:     \"pe-notification--horizontal\",\n  multilineTitle: \"pe-notification__title--multi-line\",\n  vertical:       \"pe-notification--vertical\",\n  visible:        \"pe-notification--visible\",\n};","import { filterSupportedAttributes, transitionComponent, isClient, isServer } from \"polythene-core\";\nimport { Timer } from \"polythene-utilities\";\nimport classes from \"polythene-css-classes/notification\";\n\nconst DEFAULT_TIME_OUT = 3;\n\nexport const getElement = vnode =>\n  vnode.attrs.element || \"div\";\n\nconst pause = state => {\n  state.paused(true);\n  if (state.timer) {\n    state.timer.pause();\n  }\n};\n\nconst unpause = state => {\n  state.paused(false);\n  if (state.timer) {\n    state.timer.resume();\n  }\n};\n\nconst stopTimer = state => {\n  if (state.timer) {\n    state.timer.stop();\n  }\n};\n\nconst transitionOptions = (state, attrs, isShow) => ({\n  state,\n  attrs,\n  isShow,\n  beforeTransition: isShow\n    ? () => stopTimer(state)\n    : () => stopTimer(state),\n  afterTransition: isShow\n    ? () => {\n      // set timer to hide in a few seconds\n      const timeout = attrs.timeout;\n      if (timeout === 0) {\n        // do not time out\n      } else {\n        const timeoutSeconds = timeout !== undefined\n          ? timeout\n          : DEFAULT_TIME_OUT;\n        state.timer.start(() => {\n          hideNotification(state, attrs);\n        }, timeoutSeconds);\n      }     \n    }\n    : null,\n  domElements: {\n    el: state.el,\n    containerEl: state.containerEl,\n  },\n  showClass: classes.visible,\n});\n\nconst showNotification = (state, attrs) =>\n  transitionComponent(transitionOptions(state, attrs, true));\n\nconst hideNotification = (state, attrs) =>\n  transitionComponent(transitionOptions(state, attrs, false));\n\nconst setTitleStyles = titleEl => {\n  if (isServer) return;\n  const height = titleEl.getBoundingClientRect().height;\n  const lineHeight = parseInt(window.getComputedStyle(titleEl).lineHeight, 10);\n  const paddingTop = parseInt(window.getComputedStyle(titleEl).paddingTop, 10);\n  const paddingBottom = parseInt(window.getComputedStyle(titleEl).paddingBottom, 10);\n  if (height > (lineHeight + paddingTop + paddingBottom)) {\n    titleEl.classList.add(classes.multilineTitle);\n  }\n};\n\nexport const getInitialState = (vnode, createStream) => {\n  const transitioning = createStream(false);\n  const paused = createStream(false);\n  const mounted = createStream(false);\n  const visible = createStream(false);\n  return {\n    cleanUp:        undefined,\n    containerEl:    undefined,\n    dismissEl:      undefined,\n    el:             undefined,\n    timer:          new Timer(),\n    paused,\n    transitioning,\n    visible,\n    mounted,\n    redrawOnUpdate: createStream.merge([visible])\n  };\n};\n\nexport const onMount = vnode => {\n  if (!vnode.dom) {\n    return;\n  }\n  const dom = vnode.dom;\n  const state = vnode.state;\n  const attrs = vnode.attrs;\n  state.el = dom;\n  const titleEl = state.el.querySelector(`.${classes.title}`);\n  if (titleEl) {\n    setTitleStyles(titleEl);\n  }\n  if (!state.containerEl && isClient) {\n    // attrs.holderSelector is passed as option to Multiple\n    state.containerEl = document.querySelector(attrs.containerSelector || attrs.holderSelector);\n  }\n  if (!state.containerEl && isClient) {\n    console.error(\"No container element found\"); // eslint-disable-line no-console\n  }\n  if (attrs.containerSelector && state.containerEl) {\n    state.containerEl.classList.add(classes.hasContainer);\n  }\n  if (attrs.show && !state.visible()) {\n    showNotification(state, attrs);\n  }\n  state.mounted(true);\n};\n\nexport const onUnMount = vnode => (\n  vnode.state.mounted(false)\n);\n\nexport const createProps = (vnode, { keys: k }) => {\n  const attrs = vnode.attrs;\n  return Object.assign(\n    {},\n    filterSupportedAttributes(attrs, { remove: [\"style\"] }), // style set in content, and set by show/hide transition\n    {\n      className: [\n        classes.component,\n        attrs.fromMultipleClassName,\n        // classes.visible is set in showNotification though transition\n        attrs.tone === \"light\" ? null : \"pe-dark-tone\", // default dark tone\n        attrs.containerSelector ? classes.hasContainer : null,\n        attrs.layout === \"vertical\" ? classes.vertical : classes.horizontal,\n        attrs.tone === \"dark\" ? \"pe-dark-tone\" : null,\n        attrs.tone === \"light\" ? \"pe-light-tone\" : null,\n        attrs.className || attrs[k.class],\n      ].join(\" \"),\n      [k.onclick]: e => e.preventDefault()\n    }\n  );\n};\n\nexport const createContent = (vnode, { renderer: h }) => {\n  const state = vnode.state;\n  const attrs = vnode.attrs;\n  if (state.mounted() && !state.transitioning()) {\n    if (attrs.hide && state.visible()) {\n      hideNotification(state, attrs);\n    } else if (attrs.show && !state.visible()) {\n      showNotification(state, attrs);\n    }\n  }\n  if (attrs.pause && !state.paused()) {\n    pause(state, attrs);\n  } else if (attrs.unpause && state.paused()) {\n    unpause(state, attrs);\n  }\n\n  return h(\"div\",\n    {\n      className: classes.content,\n      style: attrs.style,\n    },\n    attrs.content || [\n      attrs.title\n        ? h(\"div\",\n          { className: classes.title },\n          attrs.title\n        )\n        : null,\n      attrs.action\n        ? h(\"div\",\n          { className: classes.action },\n          attrs.action\n        )\n        : null\n    ]\n  );\n};\n"],"names":["component","action","content","holder","placeholder","title","hasContainer","horizontal","multilineTitle","vertical","visible","stopTimer","state","timer","stop","transitionOptions","attrs","isShow","beforeTransition","afterTransition","timeout","timeoutSeconds","undefined","start","hideNotification","domElements","el","containerEl","showClass","classes","showNotification","transitionComponent","vnode","element","createStream","transitioning","paused","mounted","cleanUp","dismissEl","Timer","redrawOnUpdate","merge","dom","titleEl","querySelector","isServer","getBoundingClientRect","height","parseInt","window","getComputedStyle","lineHeight","paddingTop","paddingBottom","classList","add","setTitleStyles","isClient","document","containerSelector","holderSelector","console","error","show","keys","k","Object","assign","filterSupportedAttributes","remove","className","fromMultipleClassName","tone","layout","class","join","onclick","e","preventDefault","renderer","h","hide","pause","unpause","resume","style"],"mappings":"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"}