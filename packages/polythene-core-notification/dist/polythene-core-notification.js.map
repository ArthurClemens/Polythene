{"version":3,"file":"polythene-core-notification.js","sources":["../../polythene-css-classes/notification.js","../src/notification.js"],"sourcesContent":["\nexport default {\n  component:      \"pe-notification\",\n\n  // elements\n  action:         \"pe-notification__action\",\n  content:        \"pe-notification__content\",\n  holder:         \"pe-notification__holder\",\n  placeholder:    \"pe-notification__placeholder\",\n  title:          \"pe-notification__title\",\n\n  // states\n  hasContainer:   \"pe-notification--container\",\n  horizontal:     \"pe-notification--horizontal\",\n  multilineTitle: \"pe-notification__title--multi-line\",\n  vertical:       \"pe-notification--vertical\",\n  visible:        \"pe-notification--visible\",\n};","import { filterSupportedAttributes, transitionComponent, isClient, isServer } from \"polythene-core\";\nimport { Timer } from \"polythene-utilities\";\nimport classes from \"polythene-css-classes/notification\";\n\nconst DEFAULT_TIME_OUT = 3;\n\nexport const getElement = vnode =>\n  vnode.attrs.element || \"div\";\n\nconst pause = state => {\n  state.paused(true);\n  if (state.timer) {\n    state.timer.pause();\n  }\n};\n\nconst unpause = state => {\n  state.paused(false);\n  if (state.timer) {\n    state.timer.resume();\n  }\n};\n\nconst stopTimer = state => {\n  if (state.timer) {\n    state.timer.stop();\n  }\n};\n\nconst transitionOptions = (state, props, isShow) => ({\n  isTransitioning: state.transitioning(),\n  setIsTransitioning: state.transitioning,\n  setIsVisible: state.visible,\n  instanceId: state.instanceId,\n  props,\n  isShow,\n  beforeTransition: isShow\n    ? () => stopTimer(state)\n    : () => stopTimer(state),\n  afterTransition: isShow\n    ? () => {\n      // set timer to hide in a few seconds\n      const timeout = props.timeout;\n      if (timeout === 0) {\n        // do not time out\n      } else {\n        const timeoutSeconds = timeout !== undefined\n          ? timeout\n          : DEFAULT_TIME_OUT;\n        state.timer.start(() => {\n          hideNotification(state, props);\n        }, timeoutSeconds);\n      }     \n    }\n    : null,\n  domElements: {\n    el: state.el,\n    containerEl: state.containerEl,\n  },\n  showClass: classes.visible,\n});\n\nconst showNotification = (state, attrs) =>\n  transitionComponent(transitionOptions(state, attrs, true));\n\nconst hideNotification = (state, attrs) =>\n  transitionComponent(transitionOptions(state, attrs, false));\n\nconst setTitleStyles = titleEl => {\n  if (isServer) return;\n  const height = titleEl.getBoundingClientRect().height;\n  const lineHeight = parseInt(window.getComputedStyle(titleEl).lineHeight, 10);\n  const paddingTop = parseInt(window.getComputedStyle(titleEl).paddingTop, 10);\n  const paddingBottom = parseInt(window.getComputedStyle(titleEl).paddingBottom, 10);\n  if (height > (lineHeight + paddingTop + paddingBottom)) {\n    titleEl.classList.add(classes.multilineTitle);\n  }\n};\n\nexport const getInitialState = (vnode, createStream) => {\n  const transitioning = createStream(false);\n  const paused = createStream(false);\n  const mounted = createStream(false);\n  const visible = createStream(false);\n  return {\n    cleanUp:        undefined,\n    containerEl:    undefined,\n    dismissEl:      undefined,\n    el:             undefined,\n    timer:          new Timer(),\n    paused,\n    transitioning,\n    visible,\n    mounted,\n    redrawOnUpdate: createStream.merge([visible])\n  };\n};\n\nexport const onMount = vnode => {\n  if (!vnode.dom) {\n    return;\n  }\n  const dom = vnode.dom;\n  const state = vnode.state;\n  const attrs = vnode.attrs;\n  state.el = dom;\n  const titleEl = state.el.querySelector(`.${classes.title}`);\n  if (titleEl) {\n    setTitleStyles(titleEl);\n  }\n  if (!state.containerEl && isClient) {\n    // attrs.holderSelector is passed as option to Multiple\n    state.containerEl = document.querySelector(attrs.containerSelector || attrs.holderSelector);\n  }\n  if (!state.containerEl && isClient) {\n    console.error(\"No container element found\"); // eslint-disable-line no-console\n  }\n  if (attrs.containerSelector && state.containerEl) {\n    state.containerEl.classList.add(classes.hasContainer);\n  }\n  if (attrs.show && !state.visible()) {\n    showNotification(state, attrs);\n  }\n  state.mounted(true);\n};\n\nexport const onUnMount = vnode => (\n  vnode.state.mounted(false)\n);\n\nexport const createProps = (vnode, { keys: k }) => {\n  const attrs = vnode.attrs;\n  return Object.assign(\n    {},\n    filterSupportedAttributes(attrs, { remove: [\"style\"] }), // style set in content, and set by show/hide transition\n    attrs.testId && { \"data-test-id\": attrs.testId },\n    {\n      className: [\n        classes.component,\n        attrs.fromMultipleClassName,\n        // classes.visible is set in showNotification though transition\n        attrs.tone === \"light\" ? null : \"pe-dark-tone\", // default dark tone\n        attrs.containerSelector ? classes.hasContainer : null,\n        attrs.layout === \"vertical\" ? classes.vertical : classes.horizontal,\n        attrs.tone === \"dark\" ? \"pe-dark-tone\" : null,\n        attrs.tone === \"light\" ? \"pe-light-tone\" : null,\n        attrs.className || attrs[k.class],\n      ].join(\" \"),\n      [k.onclick]: e => e.preventDefault()\n    }\n  );\n};\n\nexport const createContent = (vnode, { renderer: h }) => {\n  const state = vnode.state;\n  const attrs = vnode.attrs;\n  if (state.mounted() && !state.transitioning()) {\n    if (attrs.hide && state.visible()) {\n      hideNotification(state, attrs);\n    } else if (attrs.show && !state.visible()) {\n      showNotification(state, attrs);\n    }\n  }\n  if (attrs.pause && !state.paused()) {\n    pause(state, attrs);\n  } else if (attrs.unpause && state.paused()) {\n    unpause(state, attrs);\n  }\n\n  return h(\"div\",\n    {\n      className: classes.content,\n      style: attrs.style,\n    },\n    attrs.content || [\n      attrs.title\n        ? h(\"div\",\n          { className: classes.title },\n          attrs.title\n        )\n        : null,\n      attrs.action\n        ? h(\"div\",\n          { className: classes.action },\n          attrs.action\n        )\n        : null\n    ]\n  );\n};\n"],"names":["component","action","content","holder","placeholder","title","hasContainer","horizontal","multilineTitle","vertical","visible","stopTimer","state","timer","stop","transitionOptions","props","isShow","isTransitioning","transitioning","setIsTransitioning","setIsVisible","instanceId","beforeTransition","afterTransition","timeout","timeoutSeconds","undefined","start","hideNotification","domElements","el","containerEl","showClass","classes","showNotification","attrs","transitionComponent","vnode","element","createStream","paused","mounted","cleanUp","dismissEl","Timer","redrawOnUpdate","merge","dom","titleEl","querySelector","isServer","getBoundingClientRect","height","parseInt","window","getComputedStyle","lineHeight","paddingTop","paddingBottom","classList","add","setTitleStyles","isClient","document","containerSelector","holderSelector","console","error","show","k","keys","_extends","filterSupportedAttributes","remove","testId","className","fromMultipleClassName","tone","layout","class","join","onclick","e","preventDefault","h","renderer","hide","pause","unpause","resume","style"],"mappings":"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"}