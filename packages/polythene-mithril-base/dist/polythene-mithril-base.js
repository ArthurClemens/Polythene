!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((e=e||self).polythene={})}(this,function(e){"use strict";var n={autocomplete:"autocomplete",autofocus:"autofocus",class:"class",className:"class",enctype:"enctype",formaction:"formaction",frameborder:"frameborder",maxlength:"maxlength",minlength:"minlength",onblur:"onblur",onchange:"onchange",onclick:"onclick",onfocus:"onfocus",oninput:"oninput",onkeydown:"onkeydown",onkeyup:"onkeyup",onmousedown:"onmousedown",onmouseout:"onmouseout",onmouseover:"onmouseover",onmouseup:"onmouseup",onscroll:"onscroll",onsubmit:"onsubmit",ontouchend:"ontouchend",ontouchmove:"ontouchmove",ontouchstart:"ontouchstart",readonly:"readonly",tabindex:"tabindex"};function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(){return(r=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e}).apply(this,arguments)}function o(e,n,t,r,o,i){return{tag:e,key:n,attrs:t,children:r,text:o,dom:i,domSize:void 0,state:void 0,events:void 0,instance:void 0}}o.normalize=function(e){return Array.isArray(e)?o("[",void 0,void 0,o.normalizeChildren(e),void 0,void 0):null!=e&&"object"!==t(e)?o("#",void 0,void 0,!1===e?"":e,void 0,void 0):e},o.normalizeChildren=function(e){for(var n=[],t=0;t<e.length;t++)n[t]=o.normalize(e[t]);return n};var i=function(){var e,n=arguments[this],r=this+1;if(null==n?n={}:("object"!==t(n)||null!=n.tag||Array.isArray(n))&&(n={},r=this),arguments.length===r+1)e=arguments[r],Array.isArray(e)||(e=[e]);else for(e=[];r<arguments.length;)e.push(arguments[r++]);return o("",n.key,n,e)},l=/(?:(^|#|\.)([^#\.\[\]]+))|(\[(.+?)(?:\s*=\s*("|'|)((?:\\["'\]]|.)*?)\5)?\])/g,a={},u={}.hasOwnProperty;function c(e){for(var n in e)if(u.call(e,n))return!1;return!0}function f(e){if(null==e||"string"!=typeof e&&"function"!=typeof e&&"function"!=typeof e.view)throw Error("The selector must be either a string or a component.");var n=i.apply(1,arguments);return"string"==typeof e?function(e,n){var t=n.attrs,r=o.normalizeChildren(n.children),i=u.call(t,"class"),l=i?t.class:t.className;if(n.tag=e.tag,n.attrs=null,n.children=void 0,!c(e.attrs)&&!c(t)){var a={};for(var f in t)u.call(t,f)&&(a[f]=t[f]);t=a}for(var f in e.attrs)u.call(e.attrs,f)&&"className"!==f&&!u.call(t,f)&&(t[f]=e.attrs[f]);for(var f in null==l&&null==e.attrs.className||(t.className=null!=l?null!=e.attrs.className?String(e.attrs.className)+" "+String(l):l:null!=e.attrs.className?e.attrs.className:null),i&&(t.class=null),t)if(u.call(t,f)&&"key"!==f){n.attrs=t;break}return Array.isArray(r)&&1===r.length&&null!=r[0]&&"#"===r[0].tag?n.text=r[0].children:n.children=r,n}(a[e]||function(e){for(var n,t="div",r=[],o={};n=l.exec(e);){var i=n[1],u=n[2];if(""===i&&""!==u)t=u;else if("#"===i)o.id=u;else if("."===i)r.push(u);else if("["===n[3][0]){var c=n[6];c&&(c=c.replace(/\\(["'])/g,"$1").replace(/\\\\/g,"\\")),"class"===n[4]?r.push(c):o[n[4]]=""===c?c:c||!0}}return r.length>0&&(o.className=r.join(" ")),a[e]={tag:t,attrs:o}}(e),n):(n.tag=e,n)}f.trust=function(e){return null==e&&(e=""),o("<",void 0,void 0,e,void 0,void 0)},f.fragment=function(){var e=i.apply(0,arguments);return e.tag="[",e.children=o.normalizeChildren(e.children),e};var s=function(){return f.apply(this,arguments)};if(s.m=f,s.trust=f.trust,s.fragment=f.fragment,(d=function(e){if(!(this instanceof d))throw new Error("Promise must be called with `new`");if("function"!=typeof e)throw new TypeError("executor must be a function");var n=this,r=[],o=[],i=c(r,!0),l=c(o,!1),a=n._instance={resolvers:r,rejectors:o},u="function"==typeof setImmediate?setImmediate:setTimeout;function c(e,i){return function c(s){var d;try{if(!i||null==s||"object"!==t(s)&&"function"!=typeof s||"function"!=typeof(d=s.then))u(function(){i||0!==e.length||console.error("Possible unhandled promise rejection:",s);for(var n=0;n<e.length;n++)e[n](s);r.length=0,o.length=0,a.state=i,a.retry=function(){c(s)}});else{if(s===n)throw new TypeError("Promise can't be resolved w/ itself");f(d.bind(s))}}catch(e){l(e)}}}function f(e){var n=0;function t(e){return function(t){n++>0||e(t)}}var r=t(l);try{e(t(i),r)}catch(e){r(e)}}f(e)}).prototype.then=function(e,n){var t,r,o=this._instance;function i(e,n,i,l){n.push(function(n){if("function"!=typeof e)i(n);else try{t(e(n))}catch(e){r&&r(e)}}),"function"==typeof o.retry&&l===o.state&&o.retry()}var l=new d(function(e,n){t=e,r=n});return i(e,o.resolvers,t,!0),i(n,o.rejectors,r,!1),l},d.prototype.catch=function(e){return this.then(null,e)},d.prototype.finally=function(e){return this.then(function(n){return d.resolve(e()).then(function(){return n})},function(n){return d.resolve(e()).then(function(){return d.reject(n)})})},d.resolve=function(e){return e instanceof d?e:new d(function(n){n(e)})},d.reject=function(e){return new d(function(n,t){t(e)})},d.all=function(e){return new d(function(n,r){var o=e.length,i=0,l=[];if(0===e.length)n([]);else for(var a=0;a<e.length;a++)!function(a){function u(e){i++,l[a]=e,i===o&&n(l)}null==e[a]||"object"!==t(e[a])&&"function"!=typeof e[a]||"function"!=typeof e[a].then?u(e[a]):e[a].then(u,r)}(a)})},d.race=function(e){return new d(function(n,t){for(var r=0;r<e.length;r++)e[r].then(n,t)})},"undefined"!=typeof window){void 0===window.Promise?window.Promise=d:window.Promise.prototype.finally||(window.Promise.prototype.finally=d.prototype.finally);var d=window.Promise}else if("undefined"!=typeof global){void 0===global.Promise?global.Promise=d:global.Promise.prototype.finally||(global.Promise.prototype.finally=d.prototype.finally);d=global.Promise}var v=function(e){if("[object Object]"!==Object.prototype.toString.call(e))return"";var n=[];for(var t in e)r(t,e[t]);return n.join("&");function r(e,t){if(Array.isArray(t))for(var o=0;o<t.length;o++)r(e+"["+o+"]",t[o]);else if("[object Object]"===Object.prototype.toString.call(t))for(var o in t)r(e+"["+o+"]",t[o]);else n.push(encodeURIComponent(e)+(null!=t&&""!==t?"="+encodeURIComponent(t):""))}},p=function(e,n){var t,r=0;function o(e){return function(r,o){"string"!=typeof r?(o=r,r=r.url):null==o&&(o={});var i=new n(function(n,t){e(r,o,function(e){if("function"==typeof o.type)if(Array.isArray(e))for(var t=0;t<e.length;t++)e[t]=new o.type(e[t]);else e=new o.type(e);n(e)},t)});if(!0===o.background)return i;var l=0;function a(){0==--l&&"function"==typeof t&&t()}return function e(n){var t=n.then;return n.then=function(){l++;var r=t.apply(n,arguments);return r.then(a,function(e){if(a(),0===l)throw e}),e(r)},n}(i)}}function i(e,n){for(var t in e.headers)if({}.hasOwnProperty.call(e.headers,t)&&n.test(t))return!0;return!1}function l(e,n,t){if(null==n)return e;if(e=e.replace(/:([^\/]+)/gi,function(e,t){return null!=n[t]?n[t]:e}),t&&null!=n){var r=v(n);r&&(e+=(e.indexOf("?")<0?"?":"&")+r)}return e}return{request:o(function(n,t,r,o){var a=null!=t.method?t.method.toUpperCase():"GET",u="GET"!==a&&"TRACE"!==a&&("boolean"!=typeof t.useBody||t.useBody),c=t.data,f=!(null!=t.serialize&&t.serialize!==JSON.serialize||c instanceof e.FormData);u&&("function"==typeof t.serialize?c=t.serialize(c):c instanceof e.FormData||(c=JSON.stringify(c)));var s=new e.XMLHttpRequest,d=!1,v=s.abort;for(var p in s.abort=function(){d=!0,v.call(s)},s.open(a,l(n,t.data,!u),"boolean"!=typeof t.async||t.async,"string"==typeof t.user?t.user:void 0,"string"==typeof t.password?t.password:void 0),f&&u&&!i(t,/^content-type0$/i)&&s.setRequestHeader("Content-Type","application/json; charset=utf-8"),"function"==typeof t.deserialize||i(t,/^accept$/i)||s.setRequestHeader("Accept","application/json, text/*"),t.withCredentials&&(s.withCredentials=t.withCredentials),t.timeout&&(s.timeout=t.timeout),t.responseType&&(s.responseType=t.responseType),t.headers)({}).hasOwnProperty.call(t.headers,p)&&s.setRequestHeader(p,t.headers[p]);"function"==typeof t.config&&(s=t.config(s,t)||s),s.onreadystatechange=function(){if(!d&&4===s.readyState)try{var e=s.status>=200&&s.status<300||304===s.status||/^file:\/\//i.test(n),i=s.responseText;if("function"==typeof t.extract)i=t.extract(s,t),e=!0;else if("function"==typeof t.deserialize)i=t.deserialize(i);else try{i=i?JSON.parse(i):null}catch(e){throw new Error("Invalid JSON: "+i)}if(e)r(i);else{var l=new Error(s.responseText);l.code=s.status,l.response=i,o(l)}}catch(e){o(e)}},u&&null!=c?s.send(c):s.send()}),jsonp:o(function(n,t,o,i){var a=t.callbackName||"_mithril_"+Math.round(1e16*Math.random())+"_"+r++,u=e.document.createElement("script");e[a]=function(n){u.parentNode.removeChild(u),o(n),delete e[a]},u.onerror=function(){u.parentNode.removeChild(u),i(new Error("JSONP request failed")),delete e[a]},n=l(n,t.data,!0),u.src=n+(n.indexOf("?")<0?"?":"&")+encodeURIComponent(t.callbackKey||"callback")+"="+encodeURIComponent(a),e.document.documentElement.appendChild(u)}),setCompletionCallback:function(e){t=e}}}(window,d),m=function(e){var n,r=e.document,i={svg:"http://www.w3.org/2000/svg",math:"http://www.w3.org/1998/Math/MathML"};function l(e){return e.attrs&&e.attrs.xmlns||i[e.tag]}function a(e,n){if(e.state!==n)throw new Error("`vnode.state` must not be modified")}function u(e){var n=e.state;try{return this.apply(n,arguments)}finally{a(e,n)}}function c(){try{return r.activeElement}catch(e){return null}}function f(e,n,t,r,o,i,l){for(var a=t;a<r;a++){var u=n[a];null!=u&&s(e,u,o,l,i)}}function s(e,n,t,i,a){var c=n.tag;if("string"==typeof c)switch(n.state={},null!=n.attrs&&T(n.attrs,n,t),c){case"#":!function(e,n,t){n.dom=r.createTextNode(n.children),w(e,n.dom,t)}(e,n,a);break;case"<":v(e,n,i,a);break;case"[":!function(e,n,t,o,i){var l=r.createDocumentFragment();if(null!=n.children){var a=n.children;f(l,a,0,a.length,t,null,o)}n.dom=l.firstChild,n.domSize=l.childNodes.length,w(e,l,i)}(e,n,t,i,a);break;default:!function(e,n,t,i,a){var u=n.tag,c=n.attrs,s=c&&c.is,d=(i=l(n)||i)?s?r.createElementNS(i,u,{is:s}):r.createElementNS(i,u):s?r.createElement(u,{is:s}):r.createElement(u);n.dom=d,null!=c&&function(e,n,t){for(var r in n)S(e,r,null,n[r],t)}(n,c,i);if(w(e,d,a),null!=c&&null!=c.contenteditable)b(n);else if(null!=n.text&&(""!==n.text?d.textContent=n.text:n.children=[o("#",void 0,void 0,n.text,void 0,void 0)]),null!=n.children){var v=n.children;f(d,v,0,v.length,t,null,i),"select"===n.tag&&null!=c&&function(e,n){if("value"in n)if(null===n.value)-1!==e.dom.selectedIndex&&(e.dom.value=null);else{var t=""+n.value;e.dom.value===t&&-1!==e.dom.selectedIndex||(e.dom.value=t)}"selectedIndex"in n&&S(e,"selectedIndex",null,n.selectedIndex,void 0)}(n,c)}}(e,n,t,i,a)}else!function(e,n,t,r,i){(function(e,n){var t;if("function"==typeof e.tag.view){if(e.state=Object.create(e.tag),null!=(t=e.state.view).$$reentrantLock$$)return;t.$$reentrantLock$$=!0}else{if(e.state=void 0,null!=(t=e.tag).$$reentrantLock$$)return;t.$$reentrantLock$$=!0,e.state=null!=e.tag.prototype&&"function"==typeof e.tag.prototype.view?new e.tag(e):e.tag(e)}if(T(e.state,e,n),null!=e.attrs&&T(e.attrs,e,n),e.instance=o.normalize(u.call(e.state.view,e)),e.instance===e)throw Error("A view cannot return the vnode it received as argument");t.$$reentrantLock$$=null})(n,t),null!=n.instance?(s(e,n.instance,t,r,i),n.dom=n.instance.dom,n.domSize=null!=n.dom?n.instance.domSize:0):n.domSize=0}(e,n,t,i,a)}var d={caption:"table",thead:"table",tbody:"table",tfoot:"table",tr:"tbody",th:"tr",td:"tr",colgroup:"table",col:"colgroup"};function v(e,n,t,o){var i=n.children.match(/^\s*?<(\w+)/im)||[],l=r.createElement(d[i[1]]||"div");"http://www.w3.org/2000/svg"===t?(l.innerHTML='<svg xmlns="http://www.w3.org/2000/svg">'+n.children+"</svg>",l=l.firstChild):l.innerHTML=n.children,n.dom=l.firstChild,n.domSize=l.childNodes.length;for(var a,u=r.createDocumentFragment();a=l.firstChild;)u.appendChild(a);w(e,u,o)}function p(e,n,t,r,o,i){if(n!==t&&(null!=n||null!=t))if(null==n||0===n.length)f(e,t,0,t.length,r,o,i);else if(null==t||0===t.length)x(n,0,n.length);else{for(var l=0,a=0,u=null,c=null;a<n.length;a++)if(null!=n[a]){u=null!=n[a].key;break}for(;l<t.length;l++)if(null!=t[l]){c=null!=t[l].key;break}if(null===c&&null==u)return;if(u!==c)x(n,a,n.length),f(e,t,l,t.length,r,o,i);else if(c){for(var d,v,p,b,S,C=n.length-1,E=t.length-1;C>=a&&E>=l;)if(p=n[C],b=t[E],null==p)C--;else if(null==b)E--;else{if(p.key!==b.key)break;p!==b&&m(e,p,b,r,o,i),null!=b.dom&&(o=b.dom),C--,E--}for(;C>=a&&E>=l;)if(d=n[a],v=t[l],null==d)a++;else if(null==v)l++;else{if(d.key!==v.key)break;a++,l++,d!==v&&m(e,d,v,r,g(n,a,o),i)}for(;C>=a&&E>=l;){if(null==d)a++;else if(null==v)l++;else if(null==p)C--;else if(null==b)E--;else{if(l===E)break;if(d.key!==b.key||p.key!==v.key)break;S=g(n,a,o),w(e,y(p),S),p!==v&&m(e,p,v,r,S,i),++l<=--E&&w(e,y(d),o),d!==b&&m(e,d,b,r,o,i),null!=b.dom&&(o=b.dom),a++,C--}p=n[C],b=t[E],d=n[a],v=t[l]}for(;C>=a&&E>=l;){if(null==p)C--;else if(null==b)E--;else{if(p.key!==b.key)break;p!==b&&m(e,p,b,r,o,i),null!=b.dom&&(o=b.dom),C--,E--}p=n[C],b=t[E]}if(l>E)x(n,a,C+1);else if(a>C)f(e,t,l,E+1,r,o,i);else{var P,O,j=o,z=E-l+1,A=new Array(z),N=0,I=0,T=2147483647,$=0;for(I=0;I<z;I++)A[I]=-1;for(I=E;I>=l;I--)if(null==P&&(P=h(n,a,C+1)),null!=(b=t[I])){var R=P[b.key];null!=R&&(T=R<T?R:-1,A[I-l]=R,p=n[R],n[R]=null,p!==b&&m(e,p,b,r,o,i),null!=b.dom&&(o=b.dom),$++)}if(o=j,$!==C-a+1&&x(n,a,C+1),0===$)f(e,t,l,E+1,r,o,i);else if(-1===T)for(N=(O=function(e){var n,t,r=e.slice(),o=[];o.push(0);for(var i=0,l=e.length;i<l;++i)if(-1!==e[i]){var a=o[o.length-1];if(e[a]<e[i])r[i]=a,o.push(i);else{for(n=0,t=o.length-1;n<t;){var u=(n+t)/2|0;e[o[u]]<e[i]?n=u+1:t=u}e[i]<e[o[n]]&&(n>0&&(r[i]=o[n-1]),o[n]=i)}}n=o.length,t=o[n-1];for(;n-- >0;)o[n]=t,t=r[t];return o}(A)).length-1,I=E;I>=l;I--)v=t[I],-1===A[I-l]?s(e,v,r,i,o):O[N]===I-l?N--:w(e,y(v),o),null!=v.dom&&(o=t[I].dom);else for(I=E;I>=l;I--)v=t[I],-1===A[I-l]&&s(e,v,r,i,o),null!=v.dom&&(o=t[I].dom)}}else{var M=n.length<t.length?n.length:t.length;for(l=l<a?l:a;l<M;l++)(d=n[l])===(v=t[l])||null==d&&null==v||(null==d?s(e,v,r,i,g(n,l+1,o)):null==v?k(d):m(e,d,v,r,g(n,l+1,o),i));n.length>M&&x(n,l,n.length),t.length>M&&f(e,t,l,t.length,r,o,i)}}}function m(e,n,t,r,i,a){var c=n.tag;if(c===t.tag){if(t.state=n.state,t.events=n.events,function(e,n){do{if(null!=e.attrs&&"function"==typeof e.attrs.onbeforeupdate){var t=u.call(e.attrs.onbeforeupdate,e,n);if(void 0!==t&&!t)break}if("string"!=typeof e.tag&&"function"==typeof e.state.onbeforeupdate){var t=u.call(e.state.onbeforeupdate,e,n);if(void 0!==t&&!t)break}return!1}while(0);return e.dom=n.dom,e.domSize=n.domSize,e.instance=n.instance,!0}(t,n))return;if("string"==typeof c)switch(null!=t.attrs&&$(t.attrs,t,r),c){case"#":!function(e,n){e.children.toString()!==n.children.toString()&&(e.dom.nodeValue=n.children);n.dom=e.dom}(n,t);break;case"<":!function(e,n,t,r,o){n.children!==t.children?(y(n),v(e,t,r,o)):(t.dom=n.dom,t.domSize=n.domSize)}(e,n,t,a,i);break;case"[":!function(e,n,t,r,o,i){p(e,n.children,t.children,r,o,i);var l=0,a=t.children;if(t.dom=null,null!=a){for(var u=0;u<a.length;u++){var c=a[u];null!=c&&null!=c.dom&&(null==t.dom&&(t.dom=c.dom),l+=c.domSize||1)}1!==l&&(t.domSize=l)}}(e,n,t,r,i,a);break;default:!function(e,n,t,r){var i=n.dom=e.dom;r=l(n)||r,"textarea"===n.tag&&(null==n.attrs&&(n.attrs={}),null!=n.text&&(n.attrs.value=n.text,n.text=void 0));(function(e,n,t,r){if(null!=t)for(var o in t)S(e,o,n&&n[o],t[o],r);var i;if(null!=n)for(var o in n)null==(i=n[o])||null!=t&&null!=t[o]||C(e,o,i,r)})(n,e.attrs,n.attrs,r),null!=n.attrs&&null!=n.attrs.contenteditable?b(n):null!=e.text&&null!=n.text&&""!==n.text?e.text.toString()!==n.text.toString()&&(e.dom.firstChild.nodeValue=n.text):(null!=e.text&&(e.children=[o("#",void 0,void 0,e.text,void 0,e.dom.firstChild)]),null!=n.text&&(n.children=[o("#",void 0,void 0,n.text,void 0,void 0)]),p(i,e.children,n.children,t,null,r))}(n,t,r,a)}else!function(e,n,t,r,i,l){if(t.instance=o.normalize(u.call(t.state.view,t)),t.instance===t)throw Error("A view cannot return the vnode it received as argument");$(t.state,t,r),null!=t.attrs&&$(t.attrs,t,r);null!=t.instance?(null==n.instance?s(e,t.instance,r,l,i):m(e,n.instance,t.instance,r,i,l),t.dom=t.instance.dom,t.domSize=t.instance.domSize):null!=n.instance?(k(n.instance),t.dom=void 0,t.domSize=0):(t.dom=n.dom,t.domSize=n.domSize)}(e,n,t,r,i,a)}else k(n),s(e,t,r,a,i)}function h(e,n,t){for(var r=Object.create(null);n<t;n++){var o=e[n];if(null!=o){var i=o.key;null!=i&&(r[i]=n)}}return r}function y(e){var n=e.domSize;if(null!=n||null==e.dom){var t=r.createDocumentFragment();if(n>0){for(var o=e.dom;--n;)t.appendChild(o.nextSibling);t.insertBefore(o,t.firstChild)}return t}return e.dom}function g(e,n,t){for(;n<e.length;n++)if(null!=e[n]&&null!=e[n].dom)return e[n].dom;return t}function w(e,n,t){null!=t?e.insertBefore(n,t):e.appendChild(n)}function b(e){var n=e.children;if(null!=n&&1===n.length&&"<"===n[0].tag){var t=n[0].children;e.dom.innerHTML!==t&&(e.dom.innerHTML=t)}else if(null!=e.text||null!=n&&0!==n.length)throw new Error("Child node of a contenteditable must be trusted")}function x(e,n,t){for(var r=n;r<t;r++){var o=e[r];null!=o&&k(o)}}function k(e){var n,t=1,r=0,o=e.state;"string"!=typeof e.tag&&"function"==typeof e.state.onbeforeremove&&(null!=(n=u.call(e.state.onbeforeremove,e))&&"function"==typeof n.then&&(t++,n.then(i,i)));e.attrs&&"function"==typeof e.attrs.onbeforeremove&&(null!=(n=u.call(e.attrs.onbeforeremove,e))&&"function"==typeof n.then&&(t++,n.then(i,i)));function i(){if(++r===t&&(a(e,o),function e(n){"string"!=typeof n.tag&&"function"==typeof n.state.onremove&&u.call(n.state.onremove,n);n.attrs&&"function"==typeof n.attrs.onremove&&u.call(n.attrs.onremove,n);if("string"!=typeof n.tag)null!=n.instance&&e(n.instance);else{var t=n.children;if(Array.isArray(t))for(var r=0;r<t.length;r++){var o=t[r];null!=o&&e(o)}}}(e),e.dom)){for(var n=e.dom.parentNode,i=e.domSize||1;--i;)n.removeChild(e.dom.nextSibling);n.removeChild(e.dom)}}i()}function S(e,n,o,i,l){if("key"!==n&&"is"!==n&&null!=i&&!E(n)&&(o!==i||function(e,n){return"value"===n||"checked"===n||"selectedIndex"===n||"selected"===n&&e.dom===c()||"option"===e.tag&&e.dom.parentNode===r.activeElement}(e,n)||"object"===t(i))){if("o"===n[0]&&"n"===n[1])return I(e,n,i);if("xlink:"===n.slice(0,6))e.dom.setAttributeNS("http://www.w3.org/1999/xlink",n.slice(6),i);else if("style"===n)A(e.dom,o,i);else if(P(e,n,l)){if("value"===n){if(("input"===e.tag||"textarea"===e.tag)&&e.dom.value===""+i&&e.dom===c())return;if("select"===e.tag&&null!==o&&e.dom.value===""+i)return;if("option"===e.tag&&null!==o&&e.dom.value===""+i)return}"input"===e.tag&&"type"===n?e.dom.setAttribute(n,i):e.dom[n]=i}else"boolean"==typeof i?i?e.dom.setAttribute(n,""):e.dom.removeAttribute(n):e.dom.setAttribute("className"===n?"class":n,i)}}function C(e,n,t,r){if("key"!==n&&"is"!==n&&null!=t&&!E(n))if("o"!==n[0]||"n"!==n[1]||E(n))if("style"===n)A(e.dom,t,null);else if(!P(e,n,r)||"className"===n||"value"===n&&("option"===e.tag||"select"===e.tag&&-1===e.dom.selectedIndex&&e.dom===c())||"input"===e.tag&&"type"===n){var o=n.indexOf(":");-1!==o&&(n=n.slice(o+1)),!1!==t&&e.dom.removeAttribute("className"===n?"class":n)}else e.dom[n]=null;else I(e,n,void 0)}function E(e){return"oninit"===e||"oncreate"===e||"onupdate"===e||"onremove"===e||"onbeforeremove"===e||"onbeforeupdate"===e}function P(e,n,t){return void 0===t&&(e.tag.indexOf("-")>-1||null!=e.attrs&&e.attrs.is||"href"!==n&&"list"!==n&&"form"!==n&&"width"!==n&&"height"!==n)&&n in e.dom}var O=/[A-Z]/g;function j(e){return"-"+e.toLowerCase()}function z(e){return"-"===e[0]&&"-"===e[1]?e:"cssFloat"===e?"float":e.replace(O,j)}function A(e,n,r){if(n===r);else if(null==r)e.style.cssText="";else if("object"!==t(r))e.style.cssText=r;else if(null==n||"object"!==t(n))for(var o in e.style.cssText="",r){null!=(i=r[o])&&e.style.setProperty(z(o),String(i))}else{for(var o in r){var i;null!=(i=r[o])&&(i=String(i))!==String(n[o])&&e.style.setProperty(z(o),i)}for(var o in n)null!=n[o]&&null==r[o]&&e.style.removeProperty(z(o))}}function N(){}function I(e,n,r){if(null!=e.events){if(e.events[n]===r)return;null==r||"function"!=typeof r&&"object"!==t(r)?(null!=e.events[n]&&e.dom.removeEventListener(n.slice(2),e.events,!1),e.events[n]=void 0):(null==e.events[n]&&e.dom.addEventListener(n.slice(2),e.events,!1),e.events[n]=r)}else null==r||"function"!=typeof r&&"object"!==t(r)||(e.events=new N,e.dom.addEventListener(n.slice(2),e.events,!1),e.events[n]=r)}function T(e,n,t){"function"==typeof e.oninit&&u.call(e.oninit,n),"function"==typeof e.oncreate&&t.push(u.bind(e.oncreate,n))}function $(e,n,t){"function"==typeof e.onupdate&&t.push(u.bind(e.onupdate,n))}return N.prototype=Object.create(null),N.prototype.handleEvent=function(e){var t,r=this["on"+e.type];"function"==typeof r?t=r.call(e.currentTarget,e):"function"==typeof r.handleEvent&&r.handleEvent(e),!1===e.redraw?e.redraw=void 0:"function"==typeof n&&n(),!1===t&&(e.preventDefault(),e.stopPropagation())},{render:function(e,n){if(!e)throw new Error("Ensure the DOM element being passed to m.route/m.mount/m.render is not undefined.");var t=[],r=c(),i=e.namespaceURI;null==e.vnodes&&(e.textContent=""),n=o.normalizeChildren(Array.isArray(n)?n:[n]),p(e,e.vnodes,n,t,null,"http://www.w3.org/1999/xhtml"===i?void 0:i),e.vnodes=n,null!=r&&c()!==r&&"function"==typeof r.focus&&r.focus();for(var l=0;l<t.length;l++)t[l]()},setRedraw:function(e){return n=e}}};var h=function(e,n){var t=m(e),r=[],o=!1;function i(e){var n=r.indexOf(e);n>-1&&r.splice(n,2)}function l(){if(o)throw new Error("Nested m.redraw.sync() call");o=!0;for(var e=1;e<r.length;e+=2)try{r[e]()}catch(e){"undefined"!=typeof console&&console.error(e)}o=!1}var a=(n||function(e){var n=null;return function(){null===n&&(n=requestAnimationFrame(function(){n=null,e()}))}})(l);return a.sync=l,t.setRedraw(a),{subscribe:function(e,n){i(e),r.push(e,n)},unsubscribe:i,redraw:a,render:t.render}}(window);p.setCompletionCallback(h.redraw);var y;s.mount=(y=h,function(e,n){if(null===n)return y.render(e,[]),void y.unsubscribe(e);if(null==n.view&&"function"!=typeof n)throw new Error("m.mount(element, component) expects a component, not a vnode");var t=function(){y.render(e,o(n))};y.subscribe(e,t),t()});var g=d,w=function(e){if(""===e||null==e)return{};"?"===e.charAt(0)&&(e=e.slice(1));for(var n=e.split("&"),t={},r={},o=0;o<n.length;o++){var i=n[o].split("="),l=decodeURIComponent(i[0]),a=2===i.length?decodeURIComponent(i[1]):"";"true"===a?a=!0:"false"===a&&(a=!1);var u=l.split(/\]\[?|\[/),c=t;l.indexOf("[")>-1&&u.pop();for(var f=0;f<u.length;f++){var s=u[f],d=u[f+1],v=""==d||!isNaN(parseInt(d,10)),p=f===u.length-1;if(""===s)null==r[l=u.slice(0,f).join()]&&(r[l]=0),s=r[l]++;null==c[s]&&(c[s]=p?a:v?[]:{}),c=c[s]}}return t},b=function(e){var n,t="function"==typeof e.history.pushState,r="function"==typeof setImmediate?setImmediate:setTimeout;function o(n){var t=e.location[n].replace(/(?:%[a-f89][a-f0-9])+/gim,decodeURIComponent);return"pathname"===n&&"/"!==t[0]&&(t="/"+t),t}function i(e,n,t){var r=e.indexOf("?"),o=e.indexOf("#"),i=r>-1?r:o>-1?o:e.length;if(r>-1){var l=o>-1?o:e.length,a=w(e.slice(r+1,l));for(var u in a)n[u]=a[u]}if(o>-1){var c=w(e.slice(o+1));for(var u in c)t[u]=c[u]}return e.slice(0,i)}var l={prefix:"#!",getPath:function(){switch(l.prefix.charAt(0)){case"#":return o("hash").slice(l.prefix.length);case"?":return o("search").slice(l.prefix.length)+o("hash");default:return o("pathname").slice(l.prefix.length)+o("search")+o("hash")}},setPath:function(n,r,o){var a={},u={};if(n=i(n,a,u),null!=r){for(var c in r)a[c]=r[c];n=n.replace(/:([^\/]+)/g,function(e,n){return delete a[n],r[n]})}var f=v(a);f&&(n+="?"+f);var s=v(u);if(s&&(n+="#"+s),t){var d=o?o.state:null,p=o?o.title:null;e.onpopstate(),o&&o.replace?e.history.replaceState(d,p,l.prefix+n):e.history.pushState(d,p,l.prefix+n)}else e.location.href=l.prefix+n}};return l.defineRoutes=function(o,a,u){function c(){var n=l.getPath(),t={},r=i(n,t,t),c=e.history.state;if(null!=c)for(var f in c)t[f]=c[f];for(var s in o){var d=new RegExp("^"+s.replace(/:[^\/]+?\.{3}/g,"(.*?)").replace(/:[^\/]+/g,"([^\\/]+)")+"/?$");if(d.test(r))return void r.replace(d,function(){for(var e=s.match(/:[^\/]+/g)||[],r=[].slice.call(arguments,1,-2),i=0;i<e.length;i++)t[e[i].replace(/:|\./g,"")]=decodeURIComponent(r[i]);a(o[s],t,n,s)})}u(n,t)}var f;t?e.onpopstate=(f=c,function(){null==n&&(n=r(function(){n=null,f()}))}):"#"===l.prefix.charAt(0)&&(e.onhashchange=c),c()},l};s.route=function(e,n){var t,r,i,l,a,u=b(e),c=function(e,c,f){if(null==e)throw new Error("Ensure the DOM element that was passed to `m.route` is not undefined");function s(){null!=t&&n.render(e,t(o(r,i.key,i)))}var d=function(){s(),d=n.redraw};n.subscribe(e,s);var v=function(e){if(e===c)throw new Error("Could not resolve default route "+c);u.setPath(c,null,{replace:!0})};u.defineRoutes(f,function(e,n,o){var u=a=function(e,c){u===a&&(r=null==c||"function"!=typeof c.view&&"function"!=typeof c?"div":c,i=n,l=o,a=null,t=(e.render||function(e){return e}).bind(e),d())};e.view||"function"==typeof e?u({},e):e.onmatch?g.resolve(e.onmatch(n,o)).then(function(n){u(e,n)},v):u(e,"div")},v)};c.set=function(e,n,t){null!=a&&((t=t||{}).replace=!0),a=null,u.setPath(e,n,t)},c.get=function(){return l},c.prefix=function(e){u.prefix=e};var f=function(e,n){n.dom.setAttribute("href",u.prefix+n.attrs.href),n.dom.onclick=function(n){if(!(n.ctrlKey||n.metaKey||n.shiftKey||2===n.which)){n.preventDefault(),n.redraw=!1;var t=this.getAttribute("href");0===t.indexOf(u.prefix)&&(t=t.slice(u.prefix.length)),c.set(t,void 0,e)}}};return c.link=function(e){return null==e.tag?f.bind(f,e):f({},e)},c.param=function(e){return void 0!==i&&void 0!==e?i[e]:i},c}(window,h);var x=m(window);s.render=x.render,s.redraw=h.redraw,s.request=p.request,s.jsonp=p.jsonp,s.parseQueryString=w,s.buildQueryString=v,s.version="2.0.0-rc.3",s.vnode=o,s.PromisePolyfill=d;var k=s;k.displayName="mithril",C.SKIP={},C.lift=function(){var e=arguments[0];return P(Array.prototype.slice.call(arguments,1)).map(function(n){return e.apply(void 0,n)})},C.scan=function(e,n,t){var r=t.map(function(t){return n=e(n,t)});return r(n),r},C.merge=P,C.combine=E,C.scanMerge=function(e,n){var t=e.map(function(e){return e[0]}),r=E(function(){var r=arguments[arguments.length-1];return t.forEach(function(t,o){r.indexOf(t)>-1&&(n=e[o][1](n,t()))}),n},t);return r(n),r},C["fantasy-land/of"]=C;var S=!1;function C(e){var n,t=[],r=[];function o(n){return arguments.length&&n!==C.SKIP&&O(o)&&(e=n,o.changing(),o.state="active",t.forEach(function(n,t){n(r[t](e))})),e}return o.constructor=C,o.state=arguments.length&&e!==C.SKIP?"active":"pending",o.changing=function(){O(o)&&(o.state="changing"),t.forEach(function(e){e.dependent&&e.dependent.changing(),e.changing()})},o.map=function(n,i){var l="active"===o.state&&i!==C.SKIP?C(n(e)):C();return t.push(l),r.push(n),l},o.toJSON=function(){return null!=e&&"function"==typeof e.toJSON?e.toJSON():e},o["fantasy-land/map"]=o.map,o["fantasy-land/ap"]=function(e){return E(function(e,n){return e()(n())},[e,o])},Object.defineProperty(o,"end",{get:function(){return n||((n=C()).map(function(e){return!0===e&&(o.state="ended",t.length=r.length=0),e}),n)}}),o}function E(e,n){var t=n.every(function(e){if(e.constructor!==C)throw new Error("Ensure that each item passed to stream.combine/stream.merge/lift is a stream");return"active"===e.state}),r=t?C(e.apply(null,n.concat([n]))):C(),o=[];return n.forEach(function(i){i.map(function(l){return o.push(i),(t||n.every(function(e){return"pending"!==e.state}))&&(t=!0,r(e.apply(null,n.concat([o]))),o=[]),l},C.SKIP).parent=r}),r}function P(e){return E(function(){return e.map(function(e){return e()})},e)}function O(e){return"pending"===e.state||"active"===e.state||"changing"===e.state}Object.defineProperty(C,"HALT",{get:function(){return S&&console.log("HALT is deprecated and has been renamed to SKIP"),S=!0,C.SKIP}});var j,z=(j=Object.freeze({default:C}))&&j.default||j;e.keys=n,e.renderer=k,e.StateComponent=function(e){var t=e.createContent,o=void 0===t?function(){}:t,i=e.createProps,l=void 0===i?function(){}:i,a=e.component,u=void 0===a?null:a,c=e.getElement,f=void 0===c?function(){return"div"}:c,s=e.getInitialState,d=void 0===s?function(){return{}}:s,v=e.onMount,p=void 0===v?function(){}:v,m=e.onUnMount,h=void 0===m?function(){}:m,y=e.onUpdate,g=void 0===y?function(){}:y,w=e.view,b=void 0===w?null:w,x=function(e){return k(u||f(e),l(e,{renderer:k,requiresKeys:!1,keys:n}),[e.attrs.before,o(e,{renderer:k,requiresKeys:!1,keys:n}),e.attrs.after])};return{view:b?function(e){return b(e,{render:x,renderer:k})}:function(e){return x(e)},oninit:function(e){var t=r({},e),o=d(t,z,{keys:n});r(e.state,o),e._mounted=!1,e.state.redrawOnUpdate&&e.state.redrawOnUpdate.map(function(){return e._mounted&&setTimeout(k.redraw(!0))})},oncreate:function(e){e._mounted=!0,p(e,{keys:n})},onremove:h,onupdate:g}},e.ViewComponent=function(e){var t=e.createContent,r=void 0===t?function(){}:t,o=e.createProps,i=void 0===o?function(){}:o,l=e.getElement,a=void 0===l?function(){return"div"}:l,u=e.component,c=void 0===u?null:u,f=e.view,s=void 0===f?null:f,d=e.onMount,v=void 0===d?function(){}:d,p=e.onUnMount,m=function(e){return k(c||a(e),i(e,{renderer:k,requiresKeys:!1,keys:n}),[e.attrs.before,r(e,{renderer:k,requiresKeys:!1,keys:n}),e.attrs.after])};return{view:s?function(e){return s(e,{render:m,renderer:k})}:function(e){return m(e)},oncreate:function(e){return v(e,{keys:n})},onremove:void 0===p?function(){}:p}},Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=polythene-mithril-base.js.map
