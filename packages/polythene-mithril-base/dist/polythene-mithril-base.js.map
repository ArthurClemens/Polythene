{"version":3,"file":"polythene-mithril-base.js","sources":["../src/keys.js","../src/renderer.js","../../../node_modules/mithril/stream/stream.js","../src/StateComponent.js","../src/ViewComponent.js"],"sourcesContent":["\nexport const keys = {\n  autocomplete: \"autocomplete\",\n  autofocus:    \"autofocus\",\n  class:        \"class\",\n  className:    \"class\",\n  enctype:      \"enctype\",\n  formaction:   \"formaction\",\n  frameborder:  \"frameborder\",\n  maxlength:    \"maxlength\",\n  minlength:    \"minlength\",\n  onblur:       \"onblur\",\n  onchange:     \"onchange\",\n  onclick:      \"onclick\",\n  onfocus:      \"onfocus\",\n  oninput:      \"oninput\",\n  onkeydown:    \"onkeydown\",\n  onkeyup:      \"onkeyup\",\n  onmousedown:  \"onmousedown\",\n  onmouseout:   \"onmouseout\",\n  onmouseover:  \"onmouseover\",\n  onmouseup:    \"onmouseup\",\n  onscroll:     \"onscroll\",\n  onsubmit:     \"onsubmit\",\n  ontouchend:   \"ontouchend\",\n  ontouchmove:  \"ontouchmove\",\n  ontouchstart: \"ontouchstart\",\n  readonly:     \"readonly\",\n  tabindex:     \"tabindex\",\n};\n\nexport const normalizeKey = key => key.toLowerCase();\n","import m from \"mithril\";\n\nexport const renderer = m;\nrenderer.displayName = \"mithril\";\n","/* eslint-disable */\n;(function() {\n\"use strict\"\n/* eslint-enable */\n\nvar guid = 0, HALT = {}\nfunction createStream() {\n\tfunction stream() {\n\t\tif (arguments.length > 0 && arguments[0] !== HALT) updateStream(stream, arguments[0])\n\t\treturn stream._state.value\n\t}\n\tinitStream(stream)\n\n\tif (arguments.length > 0 && arguments[0] !== HALT) updateStream(stream, arguments[0])\n\n\treturn stream\n}\nfunction initStream(stream) {\n\tstream.constructor = createStream\n\tstream._state = {id: guid++, value: undefined, state: 0, derive: undefined, recover: undefined, deps: {}, parents: [], endStream: undefined, unregister: undefined}\n\tstream.map = stream[\"fantasy-land/map\"] = map, stream[\"fantasy-land/ap\"] = ap, stream[\"fantasy-land/of\"] = createStream\n\tstream.valueOf = valueOf, stream.toJSON = toJSON, stream.toString = valueOf\n\n\tObject.defineProperties(stream, {\n\t\tend: {get: function() {\n\t\t\tif (!stream._state.endStream) {\n\t\t\t\tvar endStream = createStream()\n\t\t\t\tendStream.map(function(value) {\n\t\t\t\t\tif (value === true) {\n\t\t\t\t\t\tunregisterStream(stream)\n\t\t\t\t\t\tendStream._state.unregister = function(){unregisterStream(endStream)}\n\t\t\t\t\t}\n\t\t\t\t\treturn value\n\t\t\t\t})\n\t\t\t\tstream._state.endStream = endStream\n\t\t\t}\n\t\t\treturn stream._state.endStream\n\t\t}}\n\t})\n}\nfunction updateStream(stream, value) {\n\tupdateState(stream, value)\n\tfor (var id in stream._state.deps) updateDependency(stream._state.deps[id], false)\n\tif (stream._state.unregister != null) stream._state.unregister()\n\tfinalize(stream)\n}\nfunction updateState(stream, value) {\n\tstream._state.value = value\n\tstream._state.changed = true\n\tif (stream._state.state !== 2) stream._state.state = 1\n}\nfunction updateDependency(stream, mustSync) {\n\tvar state = stream._state, parents = state.parents\n\tif (parents.length > 0 && parents.every(active) && (mustSync || parents.some(changed))) {\n\t\tvar value = stream._state.derive()\n\t\tif (value === HALT) return false\n\t\tupdateState(stream, value)\n\t}\n}\nfunction finalize(stream) {\n\tstream._state.changed = false\n\tfor (var id in stream._state.deps) stream._state.deps[id]._state.changed = false\n}\n\nfunction combine(fn, streams) {\n\tif (!streams.every(valid)) throw new Error(\"Ensure that each item passed to stream.combine/stream.merge is a stream\")\n\treturn initDependency(createStream(), streams, function() {\n\t\treturn fn.apply(this, streams.concat([streams.filter(changed)]))\n\t})\n}\n\nfunction initDependency(dep, streams, derive) {\n\tvar state = dep._state\n\tstate.derive = derive\n\tstate.parents = streams.filter(notEnded)\n\n\tregisterDependency(dep, state.parents)\n\tupdateDependency(dep, true)\n\n\treturn dep\n}\nfunction registerDependency(stream, parents) {\n\tfor (var i = 0; i < parents.length; i++) {\n\t\tparents[i]._state.deps[stream._state.id] = stream\n\t\tregisterDependency(stream, parents[i]._state.parents)\n\t}\n}\nfunction unregisterStream(stream) {\n\tfor (var i = 0; i < stream._state.parents.length; i++) {\n\t\tvar parent = stream._state.parents[i]\n\t\tdelete parent._state.deps[stream._state.id]\n\t}\n\tfor (var id in stream._state.deps) {\n\t\tvar dependent = stream._state.deps[id]\n\t\tvar index = dependent._state.parents.indexOf(stream)\n\t\tif (index > -1) dependent._state.parents.splice(index, 1)\n\t}\n\tstream._state.state = 2 //ended\n\tstream._state.deps = {}\n}\n\nfunction map(fn) {return combine(function(stream) {return fn(stream())}, [this])}\nfunction ap(stream) {return combine(function(s1, s2) {return s1()(s2())}, [stream, this])}\nfunction valueOf() {return this._state.value}\nfunction toJSON() {return this._state.value != null && typeof this._state.value.toJSON === \"function\" ? this._state.value.toJSON() : this._state.value}\n\nfunction valid(stream) {return stream._state }\nfunction active(stream) {return stream._state.state === 1}\nfunction changed(stream) {return stream._state.changed}\nfunction notEnded(stream) {return stream._state.state !== 2}\n\nfunction merge(streams) {\n\treturn combine(function() {\n\t\treturn streams.map(function(s) {return s()})\n\t}, streams)\n}\n\nfunction scan(reducer, seed, stream) {\n\tvar newStream = combine(function (s) {\n\t\treturn seed = reducer(seed, s._state.value)\n\t}, [stream])\n\n\tif (newStream._state.state === 0) newStream(seed)\n\n\treturn newStream\n}\n\nfunction scanMerge(tuples, seed) {\n\tvar streams = tuples.map(function(tuple) {\n\t\tvar stream = tuple[0]\n\t\tif (stream._state.state === 0) stream(undefined)\n\t\treturn stream\n\t})\n\n\tvar newStream = combine(function() {\n\t\tvar changed = arguments[arguments.length - 1]\n\n\t\tstreams.forEach(function(stream, idx) {\n\t\t\tif (changed.indexOf(stream) > -1) {\n\t\t\t\tseed = tuples[idx][1](seed, stream._state.value)\n\t\t\t}\n\t\t})\n\n\t\treturn seed\n\t}, streams)\n\n\treturn newStream\n}\n\ncreateStream[\"fantasy-land/of\"] = createStream\ncreateStream.merge = merge\ncreateStream.combine = combine\ncreateStream.scan = scan\ncreateStream.scanMerge = scanMerge\ncreateStream.HALT = HALT\n\nif (typeof module !== \"undefined\") module[\"exports\"] = createStream\nelse if (typeof window.m === \"function\" && !(\"stream\" in window.m)) window.m.stream = createStream\nelse window.m = {stream : createStream}\n\n}());\n","import stream from \"mithril/stream\";\nimport { renderer } from \"./renderer\";\nimport { keys } from \"./keys\";\n\nconst requiresKeys = false;\n\nexport const StateComponent = ({\n  createContent = () => {},\n  createProps = () => {},\n  component = null,\n  getElement = () => \"div\",\n  getInitialState = () => ({}),\n  onMount = () => {},\n  onUnMount = () => {},\n  onUpdate = () => {},\n  view = null\n}) => {\n\n  const oninit = vnode => {\n    const protoState = Object.assign(\n      {},\n      vnode\n    );\n    const initialState = getInitialState(protoState, stream, { keys });\n    Object.assign(vnode.state, initialState);\n    vnode._mounted = false;\n\n    vnode.state.redrawOnUpdate && vnode.state.redrawOnUpdate.map(() => (\n      vnode._mounted && setTimeout(renderer.redraw(true))\n    ));\n  };\n\n  const oncreate = vnode => {\n    vnode._mounted = true;\n    onMount(vnode, { keys });\n  };\n\n  const render = vnode => {\n    return renderer(\n      component || getElement(vnode),\n      createProps(vnode, { renderer, requiresKeys, keys }),\n      [\n        vnode.attrs.before,\n        createContent(vnode, { renderer, requiresKeys, keys }),\n        vnode.attrs.after\n      ]\n    );\n  };\n\n  return {\n    view: view\n      ? vnode => view(vnode, { render, renderer })\n      : vnode => render(vnode),\n    oninit,\n    oncreate,\n    onremove: onUnMount,\n    onupdate: onUpdate,\n  };\n};\n","import { renderer } from \"./renderer\";\nimport { keys } from \"./keys\";\n\nconst requiresKeys = false;\n\nexport const ViewComponent = ({\n  createContent = () => {},\n  createProps = () => {},\n  getElement = () => \"div\",\n  component = null,\n  view = null,\n  onMount = () => {},\n  onUnMount = () => {},\n}) => {\n\n  const render = vnode =>\n    renderer(\n      component || getElement(vnode),\n      createProps(vnode, { renderer, requiresKeys, keys }),\n      [\n        vnode.attrs.before,\n        createContent(vnode, { renderer, requiresKeys, keys }),\n        vnode.attrs.after\n      ]\n    );\n\n  return {\n    view: view\n      ? vnode => view(vnode, { render, renderer })\n      : vnode => render(vnode),\n    oncreate: vnode => onMount(vnode, { keys }),\n    onremove: onUnMount\n  };\n};\n"],"names":["keys","autocomplete","autofocus","class","className","enctype","formaction","frameborder","maxlength","minlength","onblur","onchange","onclick","onfocus","oninput","onkeydown","onkeyup","onmousedown","onmouseout","onmouseover","onmouseup","onscroll","onsubmit","ontouchend","ontouchmove","ontouchstart","readonly","tabindex","renderer","m","displayName","guid","HALT","createStream","stream","arguments","length","updateStream","_state","value","constructor","id","undefined","state","derive","recover","deps","parents","endStream","unregister","map","ap","valueOf","toJSON","toString","Object","defineProperties","end","get","unregisterStream","initStream","updateState","updateDependency","changed","finalize","mustSync","every","active","some","combine","fn","streams","valid","Error","dep","filter","notEnded","registerDependency","i","initDependency","apply","this","concat","dependent","index","indexOf","splice","s1","s2","merge","s","scan","reducer","seed","newStream","scanMerge","tuples","tuple","forEach","idx","module","createContent","createProps","component","getElement","getInitialState","onMount","onUnMount","onUpdate","view","render","vnode","requiresKeys","attrs","before","after","oninit","protoState","assign","initialState","_mounted","redrawOnUpdate","setTimeout","redraw","oncreate","onremove","onupdate"],"mappings":"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"}