{"version":3,"file":"polythene-scripts.js","sources":["../src/write-css.js"],"sourcesContent":["const autoprefixer = require(\"autoprefixer\");\nconst cssbeautify  = require(\"cssbeautify\");\nconst fs           = require(\"fs\");\nconst J2c          = require(\"j2c\");\nconst postcss      = require(\"postcss\");\nconst cssnano      = require(\"cssnano\");\nconst tar          = require(\"tar\");\n\nconst j2c = new J2c();\nconst COLOR_RED = \"\\x1b[31m\";\nconst COLOR_WHITE = \"\\x1b[37m\";\n\nconst makeStyleSheet = (...styles) =>\n  styles.reduce((acc, styleList) =>\n    // each style returns a list\n    Object.keys(styleList).length\n      ? (\n        styleList.forEach(style => {\n          const scoped = {\n            \"@global\": style\n          };\n          const sheet = j2c.sheet(scoped);\n          acc += sheet;      \n        }),\n        acc\n      )\n      : acc, \"\");\n\nconst beautifyCSS = cssString =>\n  cssbeautify(cssString, {\n    indent: \"  \"\n  });\n\nconst saveToFile = (path, cssString) => \n  fs.writeFileSync(path, cssString, \"ascii\", err => {  \n    // throws an error, you could also catch it here\n    if (err) throw err;\n  });\n\nexport const processCSS = ({ styles, path, autoPrefix }) => {\n  const cssString = styles.reduce((acc, current) => (\n    acc + makeStyleSheet(current)\n  ), \"\");\n  return { cssString, path, autoPrefix };\n};\n\nexport const writeCSS = ({ css, styles, path, autoPrefix, beautify, sourceMap=true, gzip }) => {\n  const cssString = css\n    ? css\n    : styles\n      ? styles.reduce((acc, current) => acc + makeStyleSheet(current), \"\")\n      : \"\";\n\n  const mapPath = `${path}.map`;\n\n  const plugins = [];\n  if (autoPrefix) {\n    plugins.push(autoprefixer());\n  }\n  plugins.push(cssnano({\n    preset:       \"default\",\n    reduceIdents: false,\n    zindex:       false,\n  }));\n\n  const options = sourceMap\n    ? {\n      from: undefined,\n      to:  path,\n      map: { inline: false }\n    }\n    : {};\n\n  postcss(plugins)\n    .process(cssString, options)\n    .then(result => {\n      result.warnings().forEach(warn => {\n        console.warn(COLOR_RED, \"Warning\", COLOR_WHITE, warn.toString()); // eslint-disable-line no-console\n      });\n      saveToFile(path, beautify ? beautifyCSS(result.css) : result.css);\n      if (gzip) {\n        tar.c(\n          { gzip: true },\n          [path]\n        ).pipe(fs.createWriteStream(`${path}.gz`));\n      }\n      if (sourceMap) {\n        saveToFile(mapPath, result.map);\n      }\n    });\n};\n\n"],"names":["autoprefixer","require","cssbeautify","fs","J2c","postcss","cssnano","tar","j2c","COLOR_RED","COLOR_WHITE","makeStyleSheet","styles","reduce","acc","styleList","Object","keys","length","forEach","style","scoped","sheet","beautifyCSS","cssString","indent","saveToFile","path","writeFileSync","err","writeCSS","css","autoPrefix","beautify","sourceMap","gzip","current","mapPath","plugins","push","preset","reduceIdents","zindex","options","from","undefined","to","map","inline","process","then","result","warnings","warn","console","toString","c","pipe","createWriteStream"],"mappings":"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"}