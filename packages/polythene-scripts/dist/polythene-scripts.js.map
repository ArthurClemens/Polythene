{"version":3,"file":"polythene-scripts.js","sources":["../src/write-css.js"],"sourcesContent":["const autoprefixer = require(\"autoprefixer\");\nconst cssbeautify  = require(\"cssbeautify\");\nconst fs           = require(\"fs\");\nconst J2c          = require(\"j2c\");\nconst postcss      = require(\"postcss\");\nconst cssnano      = require(\"cssnano\");\nconst tar          = require(\"tar\");\n\nconst j2c = new J2c();\nconst COLOR_RED = \"\\x1b[31m\";\nconst COLOR_WHITE = \"\\x1b[37m\";\n\nconst makeStyleSheet = (...styles) =>\n  styles.reduce((acc, styleList) =>\n    // each style returns a list\n    Object.keys(styleList).length\n      ? (\n        styleList.forEach(style => {\n          const scoped = {\n            \"@global\": style\n          };\n          const sheet = j2c.sheet(scoped);\n          acc += sheet;      \n        }),\n        acc\n      )\n      : acc, \"\");\n\nconst beautifyCSS = cssString =>\n  cssbeautify(cssString, {\n    indent: \"  \"\n  });\n\nconst saveToFile = (path, cssString) => \n  fs.writeFileSync(path, cssString, \"ascii\");\n\nexport const processCSS = ({ styles, path, autoPrefix }) => {\n  const cssString = styles.reduce((acc, current) => (\n    acc + makeStyleSheet(current)\n  ), \"\");\n  return { cssString, path, autoPrefix };\n};\n\nexport const writeCSS = ({ css, styles, path, autoPrefix, beautify, sourceMap=true, gzip }) => {\n  const cssString = css\n    ? css\n    : styles\n      ? styles.reduce((acc, current) => (\n        current !== undefined\n          ? acc + makeStyleSheet(current)\n          : (\n            console.log(\"No style passed to writeCSS. Make sure to use getStyle, not addStyle...\"), // eslint-disable-line no-console\n            acc\n          )\n      ), \"\")\n      : \"\";\n\n  const mapPath = `${path}.map`;\n\n  const plugins = [];\n  if (autoPrefix) {\n    plugins.push(autoprefixer());\n  }\n  plugins.push(cssnano({\n    preset:       \"default\",\n    reduceIdents: false,\n    zindex:       false,\n  }));\n\n  const options = sourceMap\n    ? {\n      from: undefined,\n      to:  path,\n      map: { inline: false }\n    }\n    : { from: undefined };\n\n  postcss(plugins)\n    .process(cssString, options)\n    .then(result => {\n      result.warnings().forEach(warn => {\n        console.warn(COLOR_RED, \"Warning\", COLOR_WHITE, warn.toString()); // eslint-disable-line no-console\n      });\n      saveToFile(path, beautify ? beautifyCSS(result.css) : result.css);\n      if (gzip) {\n        tar.c(\n          { gzip: true },\n          [path]\n        ).pipe(fs.createWriteStream(`${path}.gz`));\n      }\n      if (sourceMap) {\n        saveToFile(mapPath, result.map);\n      }\n    });\n};\n\n"],"names":["autoprefixer","require","cssbeautify","fs","J2c","postcss","cssnano","tar","j2c","saveToFile","path","cssString","writeFileSync","css","styles","autoPrefix","beautify","sourceMap","gzip","reduce","acc","current","undefined","styleList","Object","keys","length","forEach","style","scoped","sheet","makeStyleSheet","console","log","mapPath","plugins","push","preset","reduceIdents","zindex","options","from","to","map","inline","process","then","result","warnings","warn","toString","indent","c","pipe","createWriteStream"],"mappings":"sMAAA,IAAMA,EAAeC,QAAQ,gBACvBC,EAAeD,QAAQ,eACvBE,EAAeF,QAAQ,MACvBG,EAAeH,QAAQ,OACvBI,EAAeJ,QAAQ,WACvBK,EAAeL,QAAQ,WACvBM,EAAeN,QAAQ,OAEvBO,EAAM,IAAIJ,EAyBVK,EAAa,SAACC,EAAMC,UACxBR,EAAGS,cAAcF,EAAMC,EAAW,qBASZ,gBAAGE,IAAAA,IAAKC,IAAAA,OAAQJ,IAAAA,KAAMK,IAAAA,WAAYC,IAAAA,aAAUC,UAAAA,gBAAgBC,IAAAA,KAC5EP,EAAYE,IAEdC,EACEA,EAAOK,OAAO,SAACC,EAAKC,eACRC,IAAZD,EACID,EArCW,sCAAIN,2BAAAA,yBACzBA,EAAOK,OAAO,SAACC,EAAKG,UAElBC,OAAOC,KAAKF,GAAWG,QAEnBH,EAAUI,QAAQ,SAAAC,OACVC,EAAS,WACFD,GAEPE,EAAQtB,EAAIsB,MAAMD,GACxBT,GAAOU,IAETV,GAEAA,GAAK,IAuBKW,CAAeV,IAErBW,QAAQC,IAAI,2EACZb,IAEH,IACD,IAEAc,YAAaxB,UAEbyB,EAAU,GACZpB,GACFoB,EAAQC,KAAKpC,KAEfmC,EAAQC,KAAK9B,EAAQ,CACnB+B,OAAc,UACdC,cAAc,EACdC,QAAc,SAGVC,EAAUvB,EACZ,CACAwB,UAAMnB,EACNoB,GAAKhC,EACLiC,IAAK,CAAEC,QAAQ,IAEf,CAAEH,UAAMnB,GAEZjB,EAAQ8B,GACLU,QAAQlC,EAAW6B,GACnBM,KAAK,SAAAC,GAnDU,IAAApC,EAoDdoC,EAAOC,WAAWrB,QAAQ,SAAAsB,GACxBjB,QAAQiB,KAxEE,QAwEc,UAvEZ,QAuEoCA,EAAKC,cAEvDzC,EAAWC,EAAMM,GAvDHL,EAuD0BoC,EAAOlC,IAtDnDX,EAAYS,EAAW,CACrBwC,OAAQ,QAqDgDJ,EAAOlC,KACzDK,GACFX,EAAI6C,EACF,CAAElC,MAAM,GACR,CAACR,IACD2C,KAAKlD,EAAGmD,4BAAqB5C,WAE7BO,GACFR,EAAWyB,EAASa,EAAOJ"}