"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.writeCSS=void 0;var _fs=_interopRequireDefault(require("fs")),_postcss=_interopRequireDefault(require("postcss")),_cssnano=_interopRequireDefault(require("cssnano")),_tar=_interopRequireDefault(require("tar")),_autoprefixer=_interopRequireDefault(require("autoprefixer")),_perfectionist=_interopRequireDefault(require("perfectionist")),_postcssPrettify=_interopRequireDefault(require("postcss-prettify")),_j2c=_interopRequireDefault(require("j2c"));function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}var j2c=new _j2c["default"],COLOR_RED="\x1B[31m",COLOR_WHITE="\x1B[37m",makeStyleSheet=function(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];return b.reduce(function(a,b){return Object.keys(b).length?(b.forEach(function(b){var c=j2c.sheet({"@global":b});a+=c}),a):a},"")},saveToFile=function(a,b){return _fs["default"].writeFileSync(a,b,"ascii")},templateWithGlobal=function(a){return":global {\n  ".concat(a,"\n}")},writeCSS=function(a){var b=!(a.sourceMap!==void 0)||a.sourceMap,c=a.css?a.css:a.styles?a.styles.reduce(function(a,b){return b===void 0?(console.log("No styles passed to `writeCSS`. Make sure to use `getStyle` instead of `addStyle`."),a):a+makeStyleSheet(b)},""):"",d=a.wrapInGlobal?templateWithGlobal(c):c,e="".concat(a.path,".map"),f=[];a.autoPrefix&&f.push((0,_autoprefixer["default"])()),f.push((0,_cssnano["default"])({preset:["default",{reduceIdents:!1,zindex:!1}]})),a.wrapInGlobal&&a.beautify?f.push((0,_postcssPrettify["default"])()):a.beautify&&f.push((0,_perfectionist["default"])({indentSize:2}));var g=b?{from:void 0,to:a.path,map:{inline:!1}}:{from:void 0};return new Promise(function(c,h){(0,_postcss["default"])(f).process(d,g).then(function(d){d.warnings().forEach(function(a){console.warn(COLOR_RED,"Warning",COLOR_WHITE,a.toString())}),saveToFile(a.path,d.css),a.gzip&&_tar["default"].c({gzip:!0},[a.path]).pipe(_fs["default"].createWriteStream("".concat(a.path,".gz"))),b&&saveToFile(e,d.map.toString()),c(d.css)})["catch"](function(){return h()})})};exports.writeCSS=writeCSS;
