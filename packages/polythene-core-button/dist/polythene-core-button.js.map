{"version":3,"file":"polythene-core-button.js","sources":["../../polythene-css-classes/button.js","../src/useAnimatedShadow.js","../src/index.js"],"sourcesContent":["\nexport default {\n  component:        \"pe-text-button\",\n  super:            \"pe-button\",\n  row:              \"pe-button-row\",\n      \n  // elements      \n  content:          \"pe-button__content\",\n  label:            \"pe-button__label\",\n  textLabel:        \"pe-button__text-label\",\n  wash:             \"pe-button__wash\",\n  dropdown:         \"pe-button__dropdown\",\n      \n  // states      \n  border:           \"pe-button--border\",\n  contained:        \"pe-button--contained\",\n  disabled:         \"pe-button--disabled\",\n  dropdownClosed:   \"pe-button--dropdown-closed\",\n  dropdownOpen:     \"pe-button--dropdown-open\",\n  extraWide:        \"pe-button--extra-wide\",\n  hasDropdown:      \"pe-button--dropdown\",\n  focus:            \"pe-button--focus\",\n  highLabel:        \"pe-button--high-label\",\n  inactive:         \"pe-button--inactive\",\n  raised:           \"pe-button--raised\",\n  selected:         \"pe-button--selected\",\n  separatorAtStart: \"pe-button--separator-start\",\n};\n","import { isServer, pointerStartMoveEvent, pointerEndMoveEvent } from \"polythene-core\";\n\nconst DEFAULT_SHADOW_DEPTH = 1;\nconst DEFAULT_SHADOW_DEPTH_INCREASE = 1;\nconst MAX_SHADOW_DEPTH = 5;\n\nconst downButtons = [];\n\n/*\nuseRef combined with useState to enforce re-render.\n*/\nconst useStateWithRef = ({ useState, useRef }) => initialValue => {\n  const value = useRef(initialValue);\n  const [, setValue] = useState(value.current);\n  return [\n    value,\n    newValue => (\n      value.current = newValue,\n      setValue(value.current)\n    )\n  ];\n};\n\nconst animateZ = (which, getButtonProps) => {\n  const {\n    shadowDepthBase,\n    shadowDepthRef,\n    setShadowDepth,\n    increase,\n  } = getButtonProps();\n  const newShadowDepth = which === \"down\" && shadowDepthBase < MAX_SHADOW_DEPTH\n    ? Math.min(shadowDepthBase + increase, MAX_SHADOW_DEPTH)\n    : which === \"up\"\n      ? Math.max(shadowDepthRef.current - increase, shadowDepthBase)\n      : shadowDepthRef.current;\n  if (newShadowDepth !== shadowDepthRef.current) {\n    setShadowDepth(newShadowDepth);\n  }\n};\n\nconst tapHandler = ({ which, getButtonProps }) => {\n  if (which === \"down\") {\n    downButtons.push(getButtonProps);\n  }\n  animateZ(which, getButtonProps);\n};\n\nexport const useAnimatedShadow = ({ useState, useEffect, useRef, domElement, ...props }) => {\n  const [shadowDepthBase] = useState(props.shadowDepth !== undefined ? props.shadowDepth : DEFAULT_SHADOW_DEPTH);\n  const [shadowDepthRef, setShadowDepth] = useStateWithRef({ useState, useRef })(shadowDepthBase);\n  const increase = props.increase || DEFAULT_SHADOW_DEPTH_INCREASE;\n  const animateOnTap = props.animateOnTap !== false ? true : false;\n  \n  const getButtonProps = () => ({\n    shadowDepthBase,\n    shadowDepthRef,\n    setShadowDepth,\n    increase,\n  });\n  \n  useEffect(\n    () => {\n      // Init tap events\n      if (isServer || !domElement || !animateOnTap) return;\n      const tapStart = () => tapHandler({ which: \"down\", getButtonProps });\n      const tapEndAll = () => {\n        downButtons.map(getButtonProps =>\n          tapHandler({ which: \"up\", getButtonProps }));\n        downButtons.length = 0;\n      };\n      pointerStartMoveEvent.forEach(evt =>\n        domElement.addEventListener(evt, tapStart));\n      pointerEndMoveEvent.forEach(evt =>\n        document.addEventListener(evt, tapEndAll));\n        \n      // Clear tap events\n      return () => {\n        pointerStartMoveEvent.forEach(evt =>\n          domElement.removeEventListener(evt, tapStart));\n        pointerEndMoveEvent.forEach(evt =>\n          document.removeEventListener(evt, tapEndAll));\n      };\n    },\n    [domElement]\n  );\n\n  const shadowDepth = props.disabled ? 0 : shadowDepthRef.current;\n  return [shadowDepth];\n};\n","import { filterSupportedAttributes, iconDropdownDown } from \"polythene-core\";\nimport classes from \"polythene-css-classes/button\";\nimport { useAnimatedShadow } from \"./useAnimatedShadow\";\n\nexport const _Button = ({ h, a, getRef, useState, useEffect, useRef, Ripple, Shadow, Icon, ...props }) => {\n  const events = props.events || {};\n  const [domElement, setDomElement] = useState();\n  const [isInactive, setIsInactive] = useState(props.inactive);\n  const [hasFocus, setHasFocus] = useState(false);\n  const disabled = props.disabled;\n  const inactive = props.inactive || isInactive;\n  const onClickHandler = events[a.onclick] || (() => {});\n  const onKeyUpHandler = events[a.onkeyup] || onClickHandler;\n  const [shadowDepth] = props.raised\n    ? useAnimatedShadow({ useState, useEffect, useRef, domElement, ...props })\n    : [0];\n\n  const handleInactivate = () => {\n    if (props.inactivate === undefined) {\n      return;\n    }\n    setIsInactive(true);\n    setTimeout(() => (\n      setIsInactive(false)\n    ), props.inactivate * 1000);\n  };\n\n  const componentProps = Object.assign({},\n    filterSupportedAttributes(props, { add: [a.formaction, \"type\"], remove: [\"style\"] }), // Set style on content, not on component\n    getRef(dom => dom && !domElement && (\n      setDomElement(dom),\n      props.getRef && props.getRef(dom)\n    )),\n    props.testId && { \"data-test-id\": props.testId },\n    {\n      className: [\n        classes.super,\n        props.parentClassName || classes.component,\n        props.contained ? classes.contained : null,\n        props.raised ? classes.contained : null,\n        props.raised ? classes.raised : null,\n        hasFocus ? classes.focus : null,\n        props.selected ? classes.selected : null,\n        props.highLabel ? classes.highLabel : null,\n        props.extraWide ? classes.extraWide : null,\n        disabled ? classes.disabled : null,\n        inactive ? classes.inactive : null,\n        props.separatorAtStart ? classes.separatorAtStart : null,\n        (props.border || props.borders) ? classes.border : null,\n        props.dropdown ? classes.hasDropdown : null,\n        props.dropdown\n          ? props.dropdown.open\n            ? classes.dropdownOpen\n            : classes.dropdownClosed\n          : null,\n        props.tone === \"dark\" ? \"pe-dark-tone\" : null,\n        props.tone === \"light\" ? \"pe-light-tone\" : null,\n        props.className || props[a.class],\n      ].join(\" \")\n    },\n    inactive ? null : {\n      [a.tabindex]: disabled || inactive\n        ? -1\n        : props[a.tabindex] || 0,\n      [a.onfocus]: e => (\n        setHasFocus(true),\n        events[a.onfocus] && events[a.onfocus](e)\n      ),\n      [a.onblur]: e => (\n        setHasFocus(false),\n        events[a.onblur] && events[a.onblur](e)\n      ),\n      ...events,\n      [a.onclick]: e => (\n        setHasFocus(false),\n        handleInactivate(e),\n        onClickHandler(e)\n      ),\n      [a.onkeyup]: e => {\n        // With focus, trigger click with ENTER and with SPACE\n        if (hasFocus) {\n          if (e.keyCode === 13 || e.keyCode == 0 || e.keyCode == 32) {\n            setHasFocus(false);\n            onKeyUpHandler(e);\n          }\n        }\n      },\n    },\n    props.url,\n    disabled ? { disabled: true } : null,\n  );\n\n  const noink = props.ink !== undefined && props.ink === false;\n  const buttonContent = props.content\n    ? props.content\n    : props.label !== undefined\n      ? typeof props.label === \"object\"\n        ? props.label\n        : h(\"div\",\n          {\n            className: classes.label,\n            key: \"label\"\n          },\n          h(\"div\",\n            {\n              className: classes.textLabel,\n              style: props.textStyle\n            },\n            props.label\n          )\n        )\n      : props.children;\n  \n  /*\n  Use wash to indicate focus, or hover when not a raised button.\n  */\n  const showWash = !disabled && (\n    (props.raised && (/* hasFocus || */ props.wash === true))\n    || (!props.raised && (/* hasFocus && */ props.wash !== false))\n  );\n\n  return h(props.element || \"div\",\n    componentProps,\n    h(\"div\",\n      {\n        className: classes.content,\n        style: props.style\n      },\n      [\n        h(Shadow, {\n          key: \"shadow\",\n          shadowDepth: shadowDepth !== undefined\n            ? shadowDepth\n            : 0,\n          animated: true\n        }),\n        disabled || noink\n          ? null\n          : h(Ripple, Object.assign({},\n            {\n              key: \"ripple\",\n              target: domElement\n            },\n            props.ripple\n          )),\n        showWash\n          ? h(\"div\", { key: \"wash\", className: classes.wash })\n          : null,\n        props.before,\n        buttonContent,\n        props.after,\n        props.dropdown\n          ? h(Icon,\n            {\n              className: classes.dropdown,\n              key: \"dropdown\",\n              svg: { content: h.trust(iconDropdownDown) }\n            }\n          )\n          : null\n      ]\n    )\n  );\n};\n"],"names":["component","super","row","content","label","textLabel","wash","dropdown","border","contained","disabled","dropdownClosed","dropdownOpen","extraWide","hasDropdown","focus","highLabel","inactive","raised","selected","separatorAtStart","downButtons","tapHandler","which","getButtonProps","push","shadowDepthBase","shadowDepthRef","setShadowDepth","increase","newShadowDepth","Math","min","max","current","animateZ","useAnimatedShadow","useState","useEffect","useRef","domElement","props","undefined","shadowDepth","initialValue","value","setValue","newValue","useStateWithRef","animateOnTap","isServer","tapStart","tapEndAll","map","length","pointerStartMoveEvent","forEach","evt","addEventListener","pointerEndMoveEvent","document","removeEventListener","h","a","getRef","Ripple","Shadow","Icon","events","setDomElement","isInactive","setIsInactive","hasFocus","setHasFocus","onClickHandler","onclick","onKeyUpHandler","onkeyup","componentProps","_extends","filterSupportedAttributes","add","formaction","remove","dom","testId","className","classes","parentClassName","borders","open","tone","class","join","tabindex","onfocus","e","onblur","inactivate","setTimeout","keyCode","url","noink","ink","buttonContent","_typeof","key","style","textStyle","children","showWash","element","animated","target","ripple","before","after","svg","trust","iconDropdownDown"],"mappings":"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"}