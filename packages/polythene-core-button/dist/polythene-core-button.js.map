{"version":3,"file":"polythene-core-button.js","sources":["../../polythene-css-classes/button.js","../src/useAnimatedShadow.js","../src/index.js"],"sourcesContent":["\nexport default {\n  component:        \"pe-text-button\",\n  super:            \"pe-button\",\n  row:              \"pe-button-row\",\n      \n  // elements      \n  content:          \"pe-button__content\",\n  label:            \"pe-button__label\",\n  textLabel:        \"pe-button__text-label\",\n  wash:             \"pe-button__wash\",\n  dropdown:         \"pe-button__dropdown\",\n      \n  // states      \n  border:           \"pe-button--border\",\n  contained:        \"pe-button--contained\",\n  disabled:         \"pe-button--disabled\",\n  dropdownClosed:   \"pe-button--dropdown-closed\",\n  dropdownOpen:     \"pe-button--dropdown-open\",\n  extraWide:        \"pe-button--extra-wide\",\n  hasDropdown:      \"pe-button--dropdown\",\n  highLabel:        \"pe-button--high-label\",\n  inactive:         \"pe-button--inactive\",\n  raised:           \"pe-button--raised\",\n  selected:         \"pe-button--selected\",\n  separatorAtStart: \"pe-button--separator-start\",\n};\n","import { isServer, pointerStartMoveEvent, pointerEndMoveEvent } from \"polythene-core\";\n\nconst DEFAULT_SHADOW_DEPTH = 1;\nconst DEFAULT_SHADOW_DEPTH_INCREASE = 1;\nconst MAX_SHADOW_DEPTH = 5;\n\nconst downButtons = [];\n\n/*\nuseRef combined with useState to enforce re-render.\n*/\nconst useStateWithRef = ({ useState, useRef }) => initialValue => {\n  const value = useRef(initialValue);\n  const [, setValue] = useState(value.current);\n  return [\n    value,\n    newValue => (\n      value.current = newValue,\n      setValue(value.current)\n    )\n  ];\n};\n\nconst animateZ = (which, getButtonProps) => {\n  const {\n    shadowDepthBase,\n    shadowDepthRef,\n    setShadowDepth,\n    increase,\n  } = getButtonProps();\n  const newShadowDepth = which === \"down\" && shadowDepthBase < MAX_SHADOW_DEPTH\n    ? Math.min(shadowDepthBase + increase, MAX_SHADOW_DEPTH)\n    : which === \"up\"\n      ? Math.max(shadowDepthRef.current - increase, shadowDepthBase)\n      : shadowDepthRef.current;\n  if (newShadowDepth !== shadowDepthRef.current) {\n    setShadowDepth(newShadowDepth);\n  }\n};\n\nconst tapHandler = ({ which, getButtonProps }) => {\n  if (which === \"down\") {\n    downButtons.push(getButtonProps);\n  }\n  animateZ(which, getButtonProps);\n};\n\nexport const useAnimatedShadow = ({ useState, useEffect, useRef, domElement, ...props }) => {\n  const [shadowDepthBase] = useState(props.shadowDepth !== undefined ? props.shadowDepth : DEFAULT_SHADOW_DEPTH);\n  const [shadowDepthRef, setShadowDepth] = useStateWithRef({ useState, useRef })(shadowDepthBase);\n  const increase = props.increase || DEFAULT_SHADOW_DEPTH_INCREASE;\n  const animateOnTap = props.animateOnTap !== false ? true : false;\n  \n  const getButtonProps = () => ({\n    shadowDepthBase,\n    shadowDepthRef,\n    setShadowDepth,\n    increase,\n  });\n  \n  useEffect(\n    () => {\n      // Init tap events\n      if (isServer || !domElement || !animateOnTap) return;\n      const tapStart = () => tapHandler({ which: \"down\", getButtonProps });\n      const tapEndAll = () => {\n        downButtons.map(getButtonProps =>\n          tapHandler({ which: \"up\", getButtonProps }));\n        downButtons.length = 0;\n      };\n      pointerStartMoveEvent.forEach(evt =>\n        domElement.addEventListener(evt, tapStart));\n      pointerEndMoveEvent.forEach(evt =>\n        document.addEventListener(evt, tapEndAll));\n      // Clear tap events\n      return () => {\n        pointerStartMoveEvent.forEach(evt =>\n          domElement.removeEventListener(evt, tapStart));\n        pointerEndMoveEvent.forEach(evt =>\n          document.removeEventListener(evt, tapEndAll));\n      };\n    },\n    [domElement]\n  );\n\n  const shadowDepth = props.disabled ? 0 : shadowDepthRef.current;\n  return [shadowDepth];\n};\n","import { filterSupportedAttributes, iconDropdownDown } from \"polythene-core\";\nimport classes from \"polythene-css-classes/button\";\nimport { useAnimatedShadow } from \"./useAnimatedShadow\";\n\nexport const _Button = ({ h, a, getDom, useState, useEffect, useRef, Ripple, Shadow, Icon, ...props }) => {\n  const [domElement, setDomElement] = useState();\n  const [isInactive, setIsInactive] = useState(props.inactive);\n  const [hasFocus, setHasFocus] = useState(false);\n  const [hasMouseOver, setHasMouseOver] = useState(false);\n  const disabled = props.disabled;\n  const inactive = props.inactive || isInactive;\n  const onClickHandler = props.events && props.events[a.onclick];\n  const onKeyUpHandler = (props.events && props.events[a.onkeyup]) || onClickHandler;\n  const [shadowDepth] = props.raised\n    ? useAnimatedShadow({ useState, useEffect, useRef, domElement, ...props })\n    : [0];\n\n  const handleInactivate = () => (\n    setIsInactive(true),\n    setTimeout(() => (\n      setIsInactive(false)\n    ), props.inactivate * 1000)\n  );\n\n  useEffect(\n    () => {\n      if (!domElement || !domElement.addEventListener) return;\n      const onFocus = () => setHasFocus(!hasMouseOver);\n      const onBlur = () => setHasFocus(false);\n      const onMouseOver = () => setHasMouseOver(true);\n      const onMouseOut = () => setHasMouseOver(false);\n      const onClick = handleInactivate;\n\n      domElement.addEventListener(\"focus\", onFocus, false);\n      domElement.addEventListener(\"blur\", onBlur, false);\n      domElement.addEventListener(\"mouseover\", onMouseOver, false);\n      domElement.addEventListener(\"mouseout\", onMouseOut, false);\n      domElement.addEventListener(\"click\", onClick, false);\n\n      return () => {\n        domElement.removeEventListener(\"focus\", onFocus, false);\n        domElement.removeEventListener(\"blur\", onBlur, false);\n        domElement.removeEventListener(\"mouseover\", onBlur, false);\n        domElement.removeEventListener(\"mouseout\", onMouseOut, false);\n        domElement.removeEventListener(\"click\", onClick, false);\n      };\n    },\n    [domElement]\n  );\n\n  const componentProps = Object.assign({},\n    filterSupportedAttributes(props, { add: [a.formaction, \"type\"], remove: [\"style\"] }), // Set style on content, not on component\n    getDom(dom => dom && !domElement && (\n      setDomElement(dom),\n      props.getDom && props.getDom(dom)\n    )),\n    props.testId && { \"data-test-id\": props.testId },\n    {\n      className: [\n        classes.super,\n        props.parentClassName || classes.component,\n        props.contained ? classes.contained : null,\n        props.raised ? classes.contained : null,\n        props.raised ? classes.raised : null,\n        props.selected ? classes.selected : null,\n        props.highLabel ? classes.highLabel : null,\n        props.extraWide ? classes.extraWide : null,\n        disabled ? classes.disabled : null,\n        inactive ? classes.inactive : null,\n        props.separatorAtStart ? classes.separatorAtStart : null,\n        (props.border || props.borders) ? classes.border : null,\n        props.dropdown ? classes.hasDropdown : null,\n        props.dropdown\n          ? props.dropdown.open\n            ? classes.dropdownOpen\n            : classes.dropdownClosed\n          : null,\n        props.tone === \"dark\" ? \"pe-dark-tone\" : null,\n        props.tone === \"light\" ? \"pe-light-tone\" : null,\n        props.className || props[a.class],\n      ].join(\" \")\n    },\n    props.events,\n    inactive ? null : {\n      [a.tabindex]: disabled || inactive\n        ? -1\n        : props[a.tabindex] || 0,\n      [a.onclick]: onClickHandler,\n      [a.onkeyup]: e => {\n        if (e.keyCode === 13 && hasFocus) {\n          setHasFocus(false);\n          if (onKeyUpHandler) {\n            onKeyUpHandler(e);\n          }\n        }\n      }\n    },\n    props.url,\n    disabled ? { disabled: true } : null,\n  );\n  const noink = props.ink !== undefined && props.ink === false;\n  const label = props.content\n    ? props.content\n    : props.label !== undefined\n      ? typeof props.label === \"object\"\n        ? props.label\n        : h(\"div\",\n          { className: classes.label },\n          h(\"div\",\n            {\n              className: classes.textLabel,\n              style: props.textStyle\n            },\n            props.label\n          )\n        )\n      : props.children;\n  const noWash = disabled || (props.raised && props.wash !== true) || (props.wash !== undefined && !props.wash);\n\n  return h(props.element || \"div\",\n    componentProps,\n    h(\"div\",\n      {\n        className: classes.content,\n        style: props.style\n      },\n      [\n        h(Shadow, {\n          key: \"shadow\",\n          shadowDepth: shadowDepth !== undefined\n            ? shadowDepth\n            : 0,\n          animated: true\n        }),\n        disabled || noink\n          ? null\n          : h(Ripple, Object.assign({},\n            {\n              key: \"ripple\",\n              target: domElement\n            },\n            props.ripple\n          )),\n        noWash\n          ? null\n          : h(\"div\", { key: \"wash\", className: classes.wash }),\n        label,\n        props.dropdown\n          ? h(Icon,\n            {\n              className: classes.dropdown,\n              key: \"dropdown\",\n              svg: { content: h.trust(iconDropdownDown) }\n            }\n          )\n          : null\n      ]\n    )\n  );\n};\n"],"names":["component","super","row","content","label","textLabel","wash","dropdown","border","contained","disabled","dropdownClosed","dropdownOpen","extraWide","hasDropdown","highLabel","inactive","raised","selected","separatorAtStart","downButtons","tapHandler","which","getButtonProps","push","shadowDepthBase","shadowDepthRef","setShadowDepth","increase","newShadowDepth","Math","min","max","current","animateZ","useAnimatedShadow","useState","useEffect","useRef","domElement","props","undefined","shadowDepth","initialValue","value","setValue","newValue","useStateWithRef","animateOnTap","isServer","tapStart","tapEndAll","map","length","pointerStartMoveEvent","forEach","evt","addEventListener","pointerEndMoveEvent","document","removeEventListener","h","a","getDom","Ripple","Shadow","Icon","setDomElement","isInactive","setIsInactive","hasFocus","setHasFocus","hasMouseOver","setHasMouseOver","onClickHandler","events","onclick","onKeyUpHandler","onkeyup","handleInactivate","setTimeout","inactivate","onFocus","onBlur","onMouseOut","onClick","componentProps","_extends","filterSupportedAttributes","add","formaction","remove","dom","testId","className","classes","parentClassName","borders","open","tone","class","join","tabindex","e","keyCode","url","noink","ink","_typeof","style","textStyle","children","noWash","element","key","animated","target","ripple","svg","trust","iconDropdownDown"],"mappings":"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"}