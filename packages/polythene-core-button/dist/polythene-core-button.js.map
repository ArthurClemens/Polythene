{"version":3,"file":"polythene-core-button.js","sources":["../../polythene-css-classes/button.js","../src/useAnimatedShadow.js","../src/index.js"],"sourcesContent":["\nexport default {\n  component:        \"pe-text-button\",\n  super:            \"pe-button\",\n  row:              \"pe-button-row\",\n      \n  // elements      \n  content:          \"pe-button__content\",\n  label:            \"pe-button__label\",\n  textLabel:        \"pe-button__text-label\",\n  wash:             \"pe-button__wash\",\n  dropdown:         \"pe-button__dropdown\",\n      \n  // states      \n  border:           \"pe-button--border\",\n  contained:        \"pe-button--contained\",\n  disabled:         \"pe-button--disabled\",\n  dropdownClosed:   \"pe-button--dropdown-closed\",\n  dropdownOpen:     \"pe-button--dropdown-open\",\n  extraWide:        \"pe-button--extra-wide\",\n  hasDropdown:      \"pe-button--dropdown\",\n  highLabel:        \"pe-button--high-label\",\n  inactive:         \"pe-button--inactive\",\n  raised:           \"pe-button--raised\",\n  selected:         \"pe-button--selected\",\n  separatorAtStart: \"pe-button--separator-start\",\n  hasHover:         \"pe-button--has-hover\",\n};\n","import { isServer, pointerStartDownEvent, pointerEndDownEvent } from \"polythene-core\";\n\nconst DEFAULT_SHADOW_DEPTH = 1;\nconst DEFAULT_SHADOW_DEPTH_INCREASE = 1;\nconst MAX_SHADOW_DEPTH = 5;\n\nconst downButtons = [];\n\n/*\nuseRef combined with useState to enforce re-render.\n*/\nconst useStateWithRef = ({ useState, useRef }) => initialValue => {\n  const value = useRef(initialValue);\n  const [, setValue] = useState(value.current);\n  return [\n    value,\n    newValue => (\n      value.current = newValue,\n      setValue(value.current)\n    )\n  ];\n};\n\nconst animateZ = (which, getButtonProps) => {\n  const {\n    shadowDepthBase,\n    shadowDepthRef,\n    setShadowDepth,\n    increase,\n  } = getButtonProps();\n  const newShadowDepth = which === \"down\" && shadowDepthBase < MAX_SHADOW_DEPTH\n    ? Math.min(shadowDepthBase + increase, MAX_SHADOW_DEPTH)\n    : which === \"up\"\n      ? Math.max(shadowDepthRef.current - increase, shadowDepthBase)\n      : shadowDepthRef.current;\n  if (newShadowDepth !== shadowDepthRef.current) {\n    setShadowDepth(newShadowDepth);\n  }\n};\n\nconst tapHandler = ({ which, getButtonProps }) => {\n  if (which === \"down\") {\n    downButtons.push(getButtonProps);\n  }\n  animateZ(which, getButtonProps);\n};\n\nexport const useAnimatedShadow = ({ useState, useEffect, useRef, domElement, ...props }) => {\n  const [shadowDepthBase] = useState(props.shadowDepth !== undefined ? props.shadowDepth : DEFAULT_SHADOW_DEPTH);\n  const [shadowDepthRef, setShadowDepth] = useStateWithRef({ useState, useRef })(shadowDepthBase);\n  const increase = props.increase || DEFAULT_SHADOW_DEPTH_INCREASE;\n  const animateOnTap = props.animateOnTap !== false ? true : false;\n  \n  const getButtonProps = () => ({\n    shadowDepthBase,\n    shadowDepthRef,\n    setShadowDepth,\n    increase,\n  });\n  \n  useEffect(\n    () => {\n      // Init tap events\n      if (isServer || !domElement || !animateOnTap) return;\n      const tapStart = () => tapHandler({ which: \"down\", getButtonProps });\n      const tapEndAll = () => {\n        downButtons.map(getButtonProps =>\n          tapHandler({ which: \"up\", getButtonProps }));\n        downButtons.length = 0;\n      };\n      pointerStartDownEvent.forEach(evt =>\n        domElement.addEventListener(evt, tapStart));\n      pointerEndDownEvent.forEach(evt =>\n        document.addEventListener(evt, tapEndAll));\n        \n      // Clear tap events\n      return () => {\n        pointerStartDownEvent.forEach(evt =>\n          domElement.removeEventListener(evt, tapStart));\n        pointerEndDownEvent.forEach(evt =>\n          document.removeEventListener(evt, tapEndAll));\n      };\n    },\n    [domElement]\n  );\n\n  const shadowDepth = props.disabled ? 0 : shadowDepthRef.current;\n  return [shadowDepth];\n};\n","import { filterSupportedAttributes, iconDropdownDown } from \"polythene-core\";\nimport classes from \"polythene-css-classes/button\";\nimport { useAnimatedShadow } from \"./useAnimatedShadow\";\n\nexport const _Button = ({ h, a, getRef, useState, useEffect, useRef, Ripple, Shadow, Icon, ...props }) => {\n  const events = props.events || {};\n  const [domElement, setDomElement] = useState();\n  const contentElement = useRef();\n  const [isInactive, setIsInactive] = useState(props.inactive);\n  const disabled = props.disabled;\n  const inactive = props.inactive || isInactive;\n  const onClickHandler = events[a.onclick] || (() => {});\n  const onKeyUpHandler = events[a.onkeyup] || onClickHandler;\n  const [shadowDepth] = props.raised\n    ? useAnimatedShadow({ useState, useEffect, useRef, domElement, ...props })\n    : [0];\n\n  const handleInactivate = () => {\n    if (props.inactivate === undefined) {\n      return;\n    }\n    setIsInactive(true);\n    setTimeout(() => (\n      setIsInactive(false)\n    ), props.inactivate * 1000);\n  };\n\n  const hasHover = !disabled && !props.selected && (\n    props.raised\n      ? props.wash\n      : props.wash !== false\n  );\n\n  const componentProps = Object.assign({},\n    filterSupportedAttributes(props, { add: [a.formaction, \"type\"], remove: [\"style\"] }), // Set style on content, not on component\n    getRef(dom => {\n      if (!dom || domElement) {\n        return;\n      }\n      setDomElement(dom);\n      if (dom.querySelector) {\n        contentElement.current = dom.querySelector(`.${classes.content}`);\n      }\n      if (props.getRef) {\n        props.getRef(dom);\n      }\n    }),\n    props.testId && { \"data-test-id\": props.testId },\n    {\n      className: [\n        classes.super,\n        props.parentClassName || classes.component,\n        props.contained ? classes.contained : null,\n        props.raised ? classes.contained : null,\n        props.raised ? classes.raised : null,\n        hasHover ? classes.hasHover : null,\n        props.selected ? classes.selected : null,\n        props.highLabel ? classes.highLabel : null,\n        props.extraWide ? classes.extraWide : null,\n        disabled ? classes.disabled : null,\n        inactive ? classes.inactive : null,\n        props.separatorAtStart ? classes.separatorAtStart : null,\n        (props.border || props.borders) ? classes.border : null,\n        props.dropdown ? classes.hasDropdown : null,\n        props.dropdown\n          ? props.dropdown.open\n            ? classes.dropdownOpen\n            : classes.dropdownClosed\n          : null,\n        props.tone === \"dark\" ? \"pe-dark-tone\" : null,\n        props.tone === \"light\" ? \"pe-light-tone\" : null,\n        props.className || props[a.class],\n      ].join(\" \")\n    },\n    inactive ? null : {\n      [a.tabindex]: disabled || inactive\n        ? -1\n        : props[a.tabindex] || 0,\n      [a.onmouseout]: e => (\n        document.activeElement.blur(),\n        props.events && props.events[a.onmouseout]\n      ),\n      ...events,\n      [a.onclick]: e => (\n        document.activeElement.blur(),\n        handleInactivate(e),\n        onClickHandler(e)\n      ),\n      [a.onkeyup]: e => {\n        if (onKeyUpHandler) {\n          onKeyUpHandler(e);\n        }\n      }\n    },\n    props.url,\n    disabled ? { disabled: true } : null,\n  );\n\n  const noink = props.ink !== undefined && props.ink === false;\n  const buttonContent = props.content\n    ? props.content\n    : props.label !== undefined\n      ? typeof props.label === \"object\"\n        ? props.label\n        : h(\"div\",\n          {\n            className: classes.label,\n            key: \"label\"\n          },\n          h(\"div\",\n            {\n              className: classes.textLabel,\n              style: props.textStyle\n            },\n            props.label\n          )\n        )\n      : props.children;\n  \n\n  return h(props.element || \"a\",\n    componentProps, [\n      props.before,\n      h(\"div\",\n        {\n          className: classes.content,\n          style: props.style\n        },\n        [\n          h(Shadow, {\n            key: \"shadow\",\n            shadowDepth: shadowDepth !== undefined\n              ? shadowDepth\n              : 0,\n            animated: true\n          }),\n          disabled || noink\n            ? null\n            : h(Ripple, Object.assign({},\n              {\n                key: \"ripple\",\n                target: contentElement.current\n              },\n              props.ripple\n            )),\n          h(\"div\", { key: \"wash\", className: classes.wash }),\n          \n          buttonContent,\n          props.dropdown\n            ? h(Icon,\n              {\n                className: classes.dropdown,\n                key: \"dropdown\",\n                svg: { content: h.trust(iconDropdownDown) }\n              }\n            )\n            : null\n        ]\n      ),\n      props.after,\n    ]\n  );\n};\n"],"names":["component","row","content","label","textLabel","wash","dropdown","border","contained","disabled","dropdownClosed","dropdownOpen","extraWide","hasDropdown","highLabel","inactive","raised","selected","separatorAtStart","hasHover","downButtons","tapHandler","which","getButtonProps","push","shadowDepthBase","shadowDepthRef","setShadowDepth","increase","newShadowDepth","Math","min","max","current","animateZ","useAnimatedShadow","useState","useEffect","useRef","domElement","props","undefined","shadowDepth","initialValue","value","setValue","newValue","useStateWithRef","animateOnTap","isServer","tapStart","tapEndAll","map","length","pointerStartDownEvent","forEach","evt","addEventListener","pointerEndDownEvent","document","removeEventListener","h","a","getRef","Ripple","Shadow","Icon","events","setDomElement","contentElement","isInactive","setIsInactive","onClickHandler","onclick","onKeyUpHandler","onkeyup","componentProps","_extends","filterSupportedAttributes","add","formaction","remove","dom","querySelector","classes","testId","className","parentClassName","borders","open","tone","join","tabindex","onmouseout","e","activeElement","blur","inactivate","setTimeout","url","noink","ink","buttonContent","_typeof","key","style","textStyle","children","element","before","animated","target","ripple","svg","trust","iconDropdownDown","after"],"mappings":"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"}