{"version":3,"file":"polythene-core-menu.js","sources":["../../polythene-css-classes/list-tile.js","../../polythene-css-classes/menu.js","../src/menu.js"],"sourcesContent":["\nexport default {\n  component:       \"pe-list-tile\",\n\n  // elements\n  content:         \"pe-list-tile__content\",\n  highSubtitle:    \"pe-list-tile__high-subtitle\",\n  primary:         \"pe-list-tile__primary\",\n  secondary:       \"pe-list-tile__secondary\",\n  subtitle:        \"pe-list-tile__subtitle\",\n  title:           \"pe-list-tile__title\",\n  contentFront:    \"pe-list-tile__content-front\",\n\n  // states\n  compact:         \"pe-list-tile--compact\",\n  compactFront:    \"pe-list-tile--compact-front\",\n  disabled:        \"pe-list-tile--disabled\",\n  hasFront:        \"pe-list-tile--front\",\n  hasHighSubtitle: \"pe-list-tile--high-subtitle\",\n  hasSubtitle:     \"pe-list-tile--subtitle\",\n  header:          \"pe-list-tile--header\",\n  hoverable:       \"pe-list-tile--hoverable\",\n  selectable:      \"pe-list-tile--selectable\",\n  selected:        \"pe-list-tile--selected\",\n  highlight:       \"pe-list-tile--highlight\",\n  sticky:          \"pe-list-tile--sticky\",\n  navigation:      \"pe-list-tile--navigation\",\n};\n","import listTileClasses from \"./list-tile\";\n\nexport default {\n  component:   \"pe-menu\",\n\n  // elements\n  content:     \"pe-menu__content\",\n  placeholder: \"pe-menu__placeholder\",\n  target:      \"pe-menu__target\",\n\n  // states\n  permanent:   \"pe-menu--permanent\",\n  floating:    \"pe-menu--floating\",\n  visible:     \"pe-menu--visible\",\n  width_auto:  \"pe-menu--width-auto\",\n  width_n:     \"pe-menu--width-\",\n  origin:      \"pe-menu--origin\",\n\n  // lookup\n  listTile:         listTileClasses.component,\n  selectedListTile: listTileClasses.selected,\n};","import { filterSupportedAttributes, subscribe, unsubscribe, transitionComponent, isServer, pointerEndMoveEvent, deprecation } from \"polythene-core\";\nimport classes from \"polythene-css-classes/menu\";\n\nexport const getElement = vnode =>\n  vnode.attrs.element || \"div\";\n\nconst DEFAULT_OFFSET_H           = 0;\nconst DEFAULT_OFFSET_V           = \"79%\";\nconst DEFAULT_TYPE               = \"floating\";\nconst MIN_SIZE                   = 1.5;\nconst SHADOW_Z                   = 1;\n\nconst positionMenu = (state, attrs) => {\n  if (isServer) {\n    return;\n  }\n  if (!attrs.target) {\n    return;\n  }\n  const targetEl = document.querySelector(attrs.target);\n  if (!targetEl) {\n    return;\n  }\n  const menuEl = state.dom();\n  if (!menuEl) {\n    return;\n  }\n\n  const contentEl = state.dom().querySelector(\".\" + classes.content);\n  const parentRect = menuEl.parentNode.getBoundingClientRect();\n  const targetRect = targetEl.getBoundingClientRect();\n  const attrsOffsetH = attrs.offsetH !== undefined\n    ? attrs.offsetH\n    : attrs.offset !== undefined\n      ? attrs.offset // deprecated\n      : DEFAULT_OFFSET_H;\n  const attrsOffsetV = attrs.offsetV !== undefined\n    ? attrs.offsetV\n    : DEFAULT_OFFSET_V;\n  const offsetH = attrsOffsetH.toString().indexOf(\"%\") !== -1\n    ? Math.round(parseFloat(attrsOffsetH) * 0.01 * targetRect.width)\n    : Math.round(parseFloat(attrsOffsetH));\n  const offsetV = attrsOffsetV.toString().indexOf(\"%\") !== -1\n    ? Math.round(parseFloat(attrsOffsetV) * 0.01 * targetRect.height)\n    : Math.round(parseFloat(attrsOffsetV));\n  let positionOffsetV = offsetV;\n\n  const attrsOrigin = attrs.origin || \"top\";\n  const origin = attrsOrigin.split(/\\W+/).reduce((acc, curr) => (\n    acc[curr] = true,\n    acc\n  ), {});\n\n  const firstItem = contentEl.querySelectorAll(\".\" + classes.listTile)[0];\n\n  if (attrs.reposition) {\n    // get the first List Tile to calculate the top position  \n    const selectedItem = contentEl.querySelector(\".\" + classes.selectedListTile);\n    if (firstItem && selectedItem) {\n      // calculate v position: menu should shift upward relative to the first item\n      const firstItemRect = firstItem.getBoundingClientRect();\n      const selectedItemRect = selectedItem.getBoundingClientRect();\n      positionOffsetV = firstItemRect.top - selectedItemRect.top;\n    }\n    // align to middle of target\n    const alignEl = selectedItem || firstItem;\n    const alignRect = alignEl.getBoundingClientRect();\n    const targetRect = targetEl.getBoundingClientRect();\n    const heightDiff = targetRect.height - alignRect.height;\n    positionOffsetV += Math.abs(heightDiff) / 2;\n  } else if (attrs.origin) {\n    if (origin.top) {\n      positionOffsetV += targetRect.top - parentRect.top;\n    } else if (origin.bottom) {\n      positionOffsetV += parentRect.bottom - targetRect.bottom;\n    }\n  }\n\n  if (attrs.height) {\n    const firstItemHeight = firstItem\n      ? firstItem.clientHeight\n      : 48; // default List Tile height\n    if (attrs.height === \"max\") {\n      const topMargin = positionOffsetV;\n      const bottomMargin = firstItemHeight;\n      menuEl.style.height = `calc(100% - ${topMargin + bottomMargin}px)`;\n    } else {\n      const height = attrs.height.toString().indexOf(\"%\") !== -1\n        ? attrs.height\n        : attrs.height.toString().indexOf(\"px\") !== -1\n          ? attrs.height\n          : `${attrs.height}px`;\n      menuEl.style.height = height;\n    }\n  }\n\n  // prevent animated changes\n  const transitionDuration = menuEl.style.transitionDuration;\n  menuEl.style.transitionDuration = \"0ms\";\n\n  if (menuEl.parentNode) {\n    if (origin.right) {\n      menuEl.style.right = targetRect.right - parentRect.right + offsetH + \"px\";\n    } else {\n      menuEl.style.left = targetRect.left - parentRect.left + offsetH + \"px\";\n    }\n    if (origin.bottom) {\n      menuEl.style.bottom = positionOffsetV + \"px\";\n    } else {\n      menuEl.style.top = positionOffsetV + \"px\";\n    }\n    menuEl.style.transformOrigin = attrsOrigin.split(/\\W+/).join(\" \");\n  }\n\n  menuEl.offsetHeight; // force reflow\n  menuEl.style.transitionDuration = transitionDuration;\n};\n\nconst scrollContent = (state, attrs) => {\n  if (isServer) {\n    return;\n  }\n  if (!attrs.scrollTarget) {\n    return;\n  }\n  const scrollTargetEl = document.querySelector(attrs.scrollTarget);\n  if (!scrollTargetEl) {\n    return;\n  }\n  const contentEl = state.dom().querySelector(\".\" + classes.content);\n  contentEl.scrollTop = scrollTargetEl.offsetTop;\n};\n\nconst transitionOptions = (state, attrs, isShow) => ({\n  state,\n  attrs,\n  isShow,\n  beforeTransition: isShow\n    ? () => state.update()\n    : null,\n  domElements: {\n    el: state.dom()\n  },\n  showClass: classes.visible,\n});\n\nconst showMenu = (state, attrs) =>\n  transitionComponent(transitionOptions(state, attrs, true));\n\nconst hideMenu = (state, attrs) =>\n  transitionComponent(transitionOptions(state, attrs, false));\n\nconst unifySize = size =>\n  size < MIN_SIZE ? MIN_SIZE : size;\n\nconst widthClass = size =>\n  classes.width_n + size.toString().replace(\".\", \"-\");\n\nconst handleSubscriptions = (vnode, which) => {\n  const state = vnode.state;\n  const attrs = vnode.attrs;\n\n  if (which === \"mount\") {\n    subscribe(\"resize\", state.update);\n    subscribe(\"keydown\", state.handleEscape);\n    setTimeout(() => {\n      state.activateDismissTap();\n      showMenu(state, attrs);\n    }, 0);\n  } else {\n    unsubscribe(\"resize\", state.update);\n    unsubscribe(\"keydown\", state.handleEscape);\n    state.deActivateDismissTap();\n  }\n};\n\nexport const getInitialState = (vnode, createStream) => {\n  const dom = createStream(null);\n  const attrs = vnode.attrs;\n  if (attrs.offset) {\n    deprecation(\"Menu\", \"offset\", \"offsetH\");\n  }\n  const visible = createStream(false);\n  const transitioning = createStream(false);\n  return {\n    dom,\n    visible,\n    transitioning,\n    activateDismissTap: undefined, // set in onMount\n    deActivateDismissTap: undefined, // set in onMount\n    handleDismissTap: undefined, // set in onMount\n    handleEscape: undefined, // set in onMount\n    update: undefined, // set in onMount\n    redrawOnUpdate: createStream.merge([transitioning])\n  };\n};\n\nexport const onMount = vnode => {\n  if (!vnode.dom) {\n    return;\n  }\n  const state = vnode.state;\n  const attrs = vnode.attrs;\n  state.dom(vnode.dom);\n\n  if (!attrs.permanent) {\n    state.handleDismissTap = e => {\n      if (e.target === state.dom()) {\n        return;\n      }\n      hideMenu(state, attrs);\n    };\n\n    state.update = () => {\n      positionMenu(state, attrs);\n      scrollContent(state, attrs);\n    };\n\n    state.activateDismissTap = () => {\n      pointerEndMoveEvent.forEach(evt =>\n        document.addEventListener(evt, state.handleDismissTap));\n    };\n\n    state.deActivateDismissTap = () => {\n      pointerEndMoveEvent.forEach(evt =>\n        document.removeEventListener(evt, state.handleDismissTap));\n    };\n\n    state.handleEscape = e => {\n      if (e.key === \"Escape\" || e.key === \"Esc\") {\n        hideMenu(state, Object.assign(\n          {},\n          attrs,\n          { hideDelay: 0 }\n        ));\n      }\n    };\n\n    handleSubscriptions(vnode, \"mount\");\n  }\n};\n\nexport const onUnMount = vnode => {\n  const attrs = vnode.attrs;\n  if (!attrs.permanent) {\n    handleSubscriptions(vnode, \"unmount\");\n  }\n};\n\nexport const createProps = (vnode, { keys: k }) => {\n  const attrs = vnode.attrs;\n  const type = attrs.type || DEFAULT_TYPE;\n  return Object.assign(\n    {}, \n    filterSupportedAttributes(attrs),\n    {\n      className: [\n        classes.component,\n        attrs.permanent ? classes.permanent : null,\n        attrs.origin ? classes.origin : null,\n        type === \"floating\" ? classes.floating : null,\n        attrs.target ? classes.target : null,\n        attrs.size ? widthClass(unifySize(attrs.size)) : null,\n        attrs.tone === \"dark\" ? \"pe-dark-tone\" : null,\n        attrs.tone === \"light\" ? \"pe-light-tone\" : null,\n        attrs.className || attrs[k.class],\n      ].join(\" \")\n    }\n  );\n};\n\nexport const createContent = (vnode, { renderer: h, Shadow }) => {\n  const attrs = vnode.attrs;\n  const z = attrs.z !== undefined ? attrs.z : SHADOW_Z;\n  return h(\"div\",\n    {\n      className: classes.content,\n      style: attrs.style\n    },\n    [\n      z > 0 && h(Shadow, {\n        z,\n        animated: true\n      }),\n      attrs.content\n        ? attrs.content\n        : vnode.children\n    ]\n  );\n};"],"names":["component","content","highSubtitle","primary","secondary","subtitle","title","contentFront","compact","compactFront","disabled","hasFront","hasHighSubtitle","hasSubtitle","header","hoverable","selectable","selected","highlight","sticky","navigation","placeholder","target","permanent","floating","visible","width_auto","width_n","origin","listTile","listTileClasses","selectedListTile","getElement","vnode","attrs","element","DEFAULT_OFFSET_H","DEFAULT_OFFSET_V","DEFAULT_TYPE","MIN_SIZE","SHADOW_Z","positionMenu","state","isServer","targetEl","document","querySelector","menuEl","dom","contentEl","classes","parentRect","parentNode","getBoundingClientRect","targetRect","attrsOffsetH","offsetH","undefined","offset","attrsOffsetV","offsetV","toString","indexOf","Math","round","parseFloat","width","height","positionOffsetV","attrsOrigin","split","reduce","acc","curr","firstItem","querySelectorAll","reposition","selectedItem","firstItemRect","selectedItemRect","top","alignEl","alignRect","heightDiff","abs","bottom","firstItemHeight","clientHeight","topMargin","bottomMargin","style","transitionDuration","right","left","transformOrigin","join","offsetHeight","scrollContent","scrollTarget","scrollTargetEl","scrollTop","offsetTop","transitionOptions","isShow","beforeTransition","update","domElements","el","showClass","showMenu","transitionComponent","hideMenu","unifySize","size","widthClass","replace","handleSubscriptions","which","subscribe","handleEscape","setTimeout","activateDismissTap","unsubscribe","deActivateDismissTap","getInitialState","createStream","deprecation","transitioning","handleDismissTap","redrawOnUpdate","merge","onMount","e","pointerEndMoveEvent","forEach","addEventListener","evt","removeEventListener","key","hideDelay","onUnMount","createProps","k","keys","type","filterSupportedAttributes","className","tone","class","createContent","h","renderer","Shadow","z","animated","children"],"mappings":"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"}