{"version":3,"file":"polythene-core-menu.js","sources":["../../polythene-css-classes/list-tile.js","../../polythene-css-classes/menu.js","../src/menu.js"],"sourcesContent":["\nexport default {\n  component:       \"pe-list-tile\",\n\n  // elements\n  content:         \"pe-list-tile__content\",\n  highSubtitle:    \"pe-list-tile__high-subtitle\",\n  primary:         \"pe-list-tile__primary\",\n  secondary:       \"pe-list-tile__secondary\",\n  subtitle:        \"pe-list-tile__subtitle\",\n  title:           \"pe-list-tile__title\",\n  contentFront:    \"pe-list-tile__content-front\",\n\n  // states\n  compact:         \"pe-list-tile--compact\",\n  compactFront:    \"pe-list-tile--compact-front\",\n  disabled:        \"pe-list-tile--disabled\",\n  hasFront:        \"pe-list-tile--front\",\n  hasHighSubtitle: \"pe-list-tile--high-subtitle\",\n  hasSubtitle:     \"pe-list-tile--subtitle\",\n  header:          \"pe-list-tile--header\",\n  hoverable:       \"pe-list-tile--hoverable\",\n  selectable:      \"pe-list-tile--selectable\",\n  selected:        \"pe-list-tile--selected\",\n  highlight:       \"pe-list-tile--highlight\",\n  sticky:          \"pe-list-tile--sticky\",\n  navigation:      \"pe-list-tile--navigation\",\n};\n","import listTileClasses from \"./list-tile\";\n\nexport default {\n  component:   \"pe-menu\",\n\n  // elements\n  panel:       \"pe-menu__panel\",\n  content:     \"pe-menu__content\",\n  placeholder: \"pe-menu__placeholder\",\n  backdrop:    \"pe-menu__backdrop\",\n\n  // states\n  floating:     \"pe-menu--floating\",\n  origin:       \"pe-menu--origin\",\n  permanent:    \"pe-menu--permanent\",\n  showBackdrop: \"pe-menu--backdrop\",\n  visible:      \"pe-menu--visible\",\n  width_auto:   \"pe-menu--width-auto\",\n  width_n:      \"pe-menu--width-\",\n  isTopMenu:    \"pe-menu--top-menu\",\n\n  // lookup\n  listTile:         listTileClasses.component,\n  selectedListTile: listTileClasses.selected,\n};","import { filterSupportedAttributes, subscribe, unsubscribe, transitionComponent, isServer, pointerEndMoveEvent, deprecation, stylePropCompare } from \"polythene-core\";\nimport classes from \"polythene-css-classes/menu\";\n\nexport const getElement = vnode =>\n  vnode.attrs.element || \"div\";\n\nconst DEFAULT_OFFSET_H           = 0;\nconst DEFAULT_OFFSET_V           = \"79%\";\nconst DEFAULT_TYPE               = \"floating\";\nconst MIN_WIDTH                   = 1.5;\nconst DEFAULT_SHADOW_DEPTH                   = 1;\n\nconst isTopMenu = ({ state, attrs }) =>\n  attrs.topMenu || stylePropCompare({\n    element: state.dom(),\n    pseudoSelector: \":before\",\n    prop: \"content\",\n    contains: `\"${\"top_menu\"}\"`\n  });\n\nconst positionMenu = (state, attrs) => {\n  if (isServer) {\n    return;\n  }\n  if (!attrs.target) {\n    return;\n  }\n  const targetEl = document.querySelector(attrs.target);\n  if (!targetEl) {\n    return;\n  }\n  const panelEl = state.panelEl;\n  if (!panelEl) {\n    return;\n  }\n\n  // Don't set the position or top offset if the menu position is fixed\n  const hasStylePositionFixed = stylePropCompare({\n    element: panelEl,\n    prop: \"position\",\n    equals: \"fixed\"\n  });\n\n  if (hasStylePositionFixed && !isTopMenu({ state, attrs })) {\n    Object.assign(panelEl.style, {});\n    panelEl.offsetHeight; // force reflow\n    return;\n  }\n\n  const contentEl = state.contentEl;\n  const parentRect = panelEl.parentNode.getBoundingClientRect();\n  const targetRect = targetEl.getBoundingClientRect();\n  const attrsOffsetH = attrs.offsetH !== undefined\n    ? attrs.offsetH\n    : attrs.offset !== undefined\n      ? attrs.offset // deprecated\n      : DEFAULT_OFFSET_H;\n  const attrsOffsetV = attrs.offsetV !== undefined\n    ? attrs.offsetV\n    : DEFAULT_OFFSET_V;\n  const offsetH = attrsOffsetH.toString().indexOf(\"%\") !== -1\n    ? Math.round(parseFloat(attrsOffsetH) * 0.01 * targetRect.width)\n    : Math.round(parseFloat(attrsOffsetH));\n  const offsetV = attrsOffsetV.toString().indexOf(\"%\") !== -1\n    ? Math.round(parseFloat(attrsOffsetV) * 0.01 * targetRect.height)\n    : Math.round(parseFloat(attrsOffsetV));\n  let positionOffsetV = offsetV;\n\n  const attrsOrigin = attrs.origin || \"top\";\n  const origin = attrsOrigin.split(/\\W+/).reduce((acc, curr) => (\n    acc[curr] = true,\n    acc\n  ), {});\n\n  const firstItem = contentEl.querySelectorAll(\".\" + classes.listTile)[0];\n\n  if (attrs.reposition) {\n    // get the first List Tile to calculate the top position  \n    const selectedItem = contentEl.querySelector(\".\" + classes.selectedListTile);\n    if (firstItem && selectedItem) {\n      // calculate v position: menu should shift upward relative to the first item\n      const firstItemRect = firstItem.getBoundingClientRect();\n      const selectedItemRect = selectedItem.getBoundingClientRect();\n      positionOffsetV = firstItemRect.top - selectedItemRect.top;\n    }\n    // align to middle of target\n    const alignEl = selectedItem || firstItem;\n    const alignRect = alignEl.getBoundingClientRect();\n    const targetRect = targetEl.getBoundingClientRect();\n    const heightDiff = targetRect.height - alignRect.height;\n    positionOffsetV += Math.abs(heightDiff) / 2;\n  } else if (attrs.origin && !hasStylePositionFixed) {\n    if (origin.top) {\n      positionOffsetV += targetRect.top - parentRect.top;\n    } else if (origin.bottom) {\n      positionOffsetV += targetRect.top - parentRect.bottom;\n    }\n  }\n\n  if (attrs.height) {\n    const firstItemHeight = firstItem\n      ? firstItem.clientHeight\n      : 48; // default List Tile height\n    if (attrs.height === \"max\") {\n      const topMargin = positionOffsetV;\n      const bottomMargin = firstItemHeight;\n      panelEl.style.height = `calc(100% - ${topMargin + bottomMargin}px)`;\n    } else {\n      const height = /^\\d+$/.test(attrs.height.toString())\n        ? `${attrs.height}px`\n        : attrs.height;\n      panelEl.style.height = height;\n    }\n  }\n\n  // prevent animated changes\n  const transitionDuration = panelEl.style.transitionDuration;\n  panelEl.style.transitionDuration = \"0ms\";\n\n  if (panelEl.parentNode && !hasStylePositionFixed) {\n    if (origin.right) {\n      panelEl.style.right = targetRect.right - parentRect.right + offsetH + \"px\";\n    } else {\n      panelEl.style.left = targetRect.left - parentRect.left + offsetH + \"px\";\n    }\n    if (origin.bottom) {\n      panelEl.style.bottom = positionOffsetV + \"px\";\n    } else {\n      panelEl.style.top = positionOffsetV + \"px\";\n    }\n    panelEl.style.transformOrigin = attrsOrigin.split(/\\W+/).join(\" \");\n  }\n\n  panelEl.offsetHeight; // force reflow\n  panelEl.style.transitionDuration = transitionDuration;\n};\n\nconst scrollContent = (state, attrs) => {\n  if (isServer) {\n    return;\n  }\n  if (!attrs.scrollTarget) {\n    return;\n  }\n  const scrollTargetEl = document.querySelector(attrs.scrollTarget);\n  if (!scrollTargetEl) {\n    return;\n  }\n  state.contentEl.scrollTop = scrollTargetEl.offsetTop;\n};\n\nconst transitionOptions = (state, attrs, isShow) => ({\n  state,\n  attrs,\n  isShow,\n  beforeTransition: isShow\n    ? () => state.update()\n    : null,\n  domElements: {\n    el: state.panelEl,\n    showClassElement: state.dom(),\n  },\n  showClass: classes.visible,\n});\n\nconst showMenu = (state, attrs) =>\n  transitionComponent(transitionOptions(state, attrs, true));\n\nconst hideMenu = (state, attrs) =>\n  transitionComponent(transitionOptions(state, attrs, false));\n\nconst unifyWidth = width =>\n  width < MIN_WIDTH ? MIN_WIDTH : width;\n\nconst widthClass = size =>\n  classes.width_n + size.toString().replace(\".\", \"-\");\n\nconst handleSubscriptions = (vnode, which) => {\n  const state = vnode.state;\n  const attrs = vnode.attrs;\n\n  if (which === \"mount\") {\n    subscribe(\"resize\", state.update);\n    subscribe(\"keydown\", state.handleEscape);\n    setTimeout(() => {\n      state.activateDismissTap();\n      showMenu(state, attrs);\n    }, 0);\n  } else {\n    unsubscribe(\"resize\", state.update);\n    unsubscribe(\"keydown\", state.handleEscape);\n    state.deActivateDismissTap();\n  }\n};\n\nexport const getInitialState = (vnode, createStream) => {\n  const dom = createStream(null);\n  const attrs = vnode.attrs;\n  if (attrs.offset !== undefined) {\n    deprecation(\"Menu\", { option: \"offset\", newOption: \"offsetH\" });\n  }\n  if (attrs.size !== undefined) {\n    deprecation(\"Menu\", { option: \"size\", newOption: \"width\" });\n  }\n  const visible = createStream(false);\n  const transitioning = createStream(false);\n  return {\n    dom,\n    visible,\n    transitioning,\n    activateDismissTap: undefined, // set in onMount\n    contentEl: undefined, // set in onMount\n    deActivateDismissTap: undefined, // set in onMount\n    handleDismissTap: undefined, // set in onMount\n    handleEscape: undefined, // set in onMount\n    panelEl: undefined, // set in onMount\n    update: undefined, // set in onMount\n    redrawOnUpdate: createStream.merge([transitioning])\n  };\n};\n\nexport const onMount = vnode => {\n  if (!vnode.dom) {\n    return;\n  }\n  const state = vnode.state;\n  const attrs = vnode.attrs;\n  state.dom(vnode.dom);\n  state.panelEl = vnode.dom.querySelector(`.${classes.panel}`);\n  state.contentEl = vnode.dom.querySelector(`.${classes.content}`);\n\n  if (!attrs.permanent) {\n    state.handleDismissTap = e => {\n      if (e.target === state.panelEl) {\n        return;\n      }\n      hideMenu(state, attrs);\n    };\n\n    state.update = () => {\n      positionMenu(state, attrs);\n      scrollContent(state, attrs);\n    };\n\n    state.activateDismissTap = () => {\n      pointerEndMoveEvent.forEach(evt =>\n        document.addEventListener(evt, state.handleDismissTap));\n    };\n\n    state.deActivateDismissTap = () => {\n      pointerEndMoveEvent.forEach(evt =>\n        document.removeEventListener(evt, state.handleDismissTap));\n    };\n\n    state.handleEscape = e => {\n      if (e.key === \"Escape\" || e.key === \"Esc\") {\n        hideMenu(state, Object.assign(\n          {},\n          attrs,\n          { hideDelay: 0 }\n        ));\n      }\n    };\n\n    handleSubscriptions(vnode, \"mount\");\n  }\n};\n\nexport const onUnMount = vnode => {\n  const attrs = vnode.attrs;\n  if (!attrs.permanent) {\n    handleSubscriptions(vnode, \"unmount\");\n  }\n};\n\nexport const createProps = (vnode, { keys: k }) => {\n  const attrs = vnode.attrs;\n  const type = attrs.type || DEFAULT_TYPE;\n  return Object.assign(\n    {}, \n    filterSupportedAttributes(attrs),\n    {\n      className: [\n        classes.component,\n        attrs.permanent ? classes.permanent : null,\n        attrs.origin ? classes.origin : null,\n        attrs.backdrop ? classes.showBackdrop : null,\n        attrs.topMenu ? classes.isTopMenu : null,\n        type === \"floating\" && !attrs.permanent ? classes.floating : null,\n        attrs.width || attrs.size ? widthClass(unifyWidth(attrs.width || attrs.size)) : null,\n        attrs.tone === \"dark\" ? \"pe-dark-tone\" : null,\n        attrs.tone === \"light\" ? \"pe-light-tone\" : null,\n        attrs.className || attrs[k.class],\n      ].join(\" \")\n    }\n  );\n};\n\nexport const createContent = (vnode, { renderer: h, Shadow }) => {\n  const attrs = vnode.attrs;\n  const shadowDepth = attrs.shadowDepth !== undefined\n    ? attrs.shadowDepth\n    : attrs.z !== undefined \n      ? attrs.z // deprecated\n      : DEFAULT_SHADOW_DEPTH; \n  return [\n    h(\"div\",\n      {\n        key: \"backdrop\",\n        className: classes.backdrop,\n      }\n    ),\n    h(\"div\",\n      {\n        className: classes.panel,\n        key: \"panel\",\n      },\n      [\n        h(Shadow, {\n          shadowDepth,\n          animated: true,\n          key: \"shadow\",\n        }),\n        h(\"div\", \n          {\n            className: classes.content,\n            style: attrs.style,\n            key: \"content\",\n          },\n          attrs.content\n            ? attrs.content\n            : vnode.children\n        )\n      ]\n    )\n  ];\n};"],"names":["component","content","highSubtitle","primary","secondary","subtitle","title","contentFront","compact","compactFront","disabled","hasFront","hasHighSubtitle","hasSubtitle","header","hoverable","selectable","selected","highlight","sticky","navigation","panel","placeholder","backdrop","floating","origin","permanent","showBackdrop","visible","width_auto","width_n","isTopMenu","listTile","listTileClasses","selectedListTile","getElement","vnode","attrs","element","DEFAULT_OFFSET_H","DEFAULT_OFFSET_V","DEFAULT_TYPE","MIN_WIDTH","DEFAULT_SHADOW_DEPTH","state","topMenu","stylePropCompare","dom","pseudoSelector","prop","contains","positionMenu","isServer","target","targetEl","document","querySelector","panelEl","hasStylePositionFixed","equals","Object","assign","style","offsetHeight","contentEl","parentRect","parentNode","getBoundingClientRect","targetRect","attrsOffsetH","offsetH","undefined","offset","attrsOffsetV","offsetV","toString","indexOf","Math","round","parseFloat","width","height","positionOffsetV","attrsOrigin","split","reduce","acc","curr","firstItem","querySelectorAll","classes","reposition","selectedItem","firstItemRect","selectedItemRect","top","alignEl","alignRect","heightDiff","abs","bottom","firstItemHeight","clientHeight","topMargin","bottomMargin","test","transitionDuration","right","left","transformOrigin","join","scrollContent","scrollTarget","scrollTargetEl","scrollTop","offsetTop","transitionOptions","isShow","beforeTransition","update","domElements","el","showClassElement","showClass","showMenu","transitionComponent","hideMenu","unifyWidth","widthClass","size","replace","handleSubscriptions","which","subscribe","handleEscape","setTimeout","activateDismissTap","unsubscribe","deActivateDismissTap","getInitialState","createStream","deprecation","option","newOption","transitioning","handleDismissTap","redrawOnUpdate","merge","onMount","e","pointerEndMoveEvent","forEach","evt","addEventListener","removeEventListener","key","hideDelay","onUnMount","createProps","keys","k","type","filterSupportedAttributes","className","tone","class","createContent","renderer","h","Shadow","shadowDepth","z","animated","children"],"mappings":"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"}