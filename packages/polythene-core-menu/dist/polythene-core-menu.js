!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("polythene-core")):"function"==typeof define&&define.amd?define(["exports","polythene-core"],t):t((e=e||self).polythene={},e["polythene-core"])}(this,function(e,t){"use strict";var n={component:"pe-menu",panel:"pe-menu__panel",content:"pe-menu__content",placeholder:"pe-menu__placeholder",backdrop:"pe-menu__backdrop",floating:"pe-menu--floating",origin:"pe-menu--origin",permanent:"pe-menu--permanent",showBackdrop:"pe-menu--backdrop",visible:"pe-menu--visible",width_auto:"pe-menu--width-auto",width_n:"pe-menu--width-",isTopMenu:"pe-menu--top-menu",listTile:"pe-list-tile",selectedListTile:"pe-list-tile--selected"};const o=(e,o)=>{if(t.isServer)return;if(!o.target)return;const i=document.querySelector(o.target);if(!i)return;const s=e.panelEl;if(!s)return;const r=t.stylePropCompare({element:s,prop:"position",equals:"fixed"});if(r&&!(({state:e,attrs:n})=>n.topMenu||t.stylePropCompare({element:e.dom(),pseudoSelector:":before",prop:"content",contains:'"top_menu"'}))({state:e,attrs:o}))return Object.assign(s.style,{}),void s.offsetHeight;const a=e.contentEl,l=s.parentNode.getBoundingClientRect(),p=i.getBoundingClientRect(),d=void 0!==o.offsetH?o.offsetH:void 0!==o.offset?o.offset:0,c=void 0!==o.offsetV?o.offsetV:"79%",u=-1!==d.toString().indexOf("%")?Math.round(.01*parseFloat(d)*p.width):Math.round(parseFloat(d));let m=-1!==c.toString().indexOf("%")?Math.round(.01*parseFloat(c)*p.height):Math.round(parseFloat(c));const h=o.origin||"top",f=h.split(/\W+/).reduce((e,t)=>(e[t]=!0,e),{}),g=a.querySelectorAll("."+n.listTile)[0];if(o.reposition){const e=a.querySelector("."+n.selectedListTile);if(g&&e){const t=g.getBoundingClientRect(),n=e.getBoundingClientRect();m=t.top-n.top}const t=(e||g).getBoundingClientRect(),o=i.getBoundingClientRect().height-t.height;m+=Math.abs(o)/2}else o.origin&&!r&&(f.top?m+=p.top-l.top:f.bottom&&(m+=p.top-l.bottom));if(o.height){const e=g?g.clientHeight:48;if("max"===o.height){const t=m,n=e;s.style.height=`calc(100% - ${t+n}px)`}else{const e=/^\d+$/.test(o.height.toString())?`${o.height}px`:o.height;s.style.height=e}}const v=s.style.transitionDuration;s.style.transitionDuration="0ms",s.parentNode&&!r&&(f.right?s.style.right=p.right-l.right+u+"px":s.style.left=p.left-l.left+u+"px",f.bottom?s.style.bottom=m+"px":s.style.top=m+"px",s.style.transformOrigin=h.split(/\W+/).join(" ")),s.offsetHeight,s.style.transitionDuration=v},i=(e,t,o)=>({state:e,attrs:t,isShow:o,beforeTransition:o?()=>e.update():null,domElements:{el:e.panelEl,showClassElement:e.dom()},showClass:n.visible}),s=(e,n)=>t.transitionComponent(i(e,n,!1)),r=e=>e<1.5?1.5:e,a=e=>n.width_n+e.toString().replace(".","-"),l=(e,n)=>{const o=e.state,s=e.attrs;"mount"===n?(t.subscribe("resize",o.update),t.subscribe("keydown",o.handleEscape),setTimeout(()=>{o.activateDismissTap(),((e,n)=>t.transitionComponent(i(e,n,!0)))(o,s)},0)):(t.unsubscribe("resize",o.update),t.unsubscribe("keydown",o.handleEscape),o.deActivateDismissTap())};var p=Object.freeze({getElement:e=>e.attrs.element||"div",getInitialState:(e,n)=>{const o=n(null),i=e.attrs;void 0!==i.offset&&t.deprecation("Menu",{option:"offset",newOption:"offsetH"}),void 0!==i.size&&t.deprecation("Menu",{option:"size",newOption:"width"});const s=n(!1),r=n(!1);return{dom:o,visible:s,transitioning:r,activateDismissTap:void 0,contentEl:void 0,deActivateDismissTap:void 0,handleDismissTap:void 0,handleEscape:void 0,panelEl:void 0,update:void 0,redrawOnUpdate:n.merge([r])}},onMount:e=>{if(!e.dom)return;const i=e.state,r=e.attrs;i.dom(e.dom),i.panelEl=e.dom.querySelector(`.${n.panel}`),i.contentEl=e.dom.querySelector(`.${n.content}`),r.permanent||(i.handleDismissTap=(e=>{e.target!==i.panelEl&&s(i,r)}),i.update=(()=>{o(i,r),((e,n)=>{if(t.isServer)return;if(!n.scrollTarget)return;const o=document.querySelector(n.scrollTarget);o&&(e.contentEl.scrollTop=o.offsetTop)})(i,r)}),i.activateDismissTap=(()=>{t.pointerEndMoveEvent.forEach(e=>document.addEventListener(e,i.handleDismissTap))}),i.deActivateDismissTap=(()=>{t.pointerEndMoveEvent.forEach(e=>document.removeEventListener(e,i.handleDismissTap))}),i.handleEscape=(e=>{"Escape"!==e.key&&"Esc"!==e.key||s(i,Object.assign({},r,{hideDelay:0}))}),l(e,"mount"))},onUnMount:e=>{e.attrs.permanent||l(e,"unmount")},createProps:(e,{keys:o})=>{const i=e.attrs,s=i.type||"floating";return Object.assign({},t.filterSupportedAttributes(i),{className:[n.component,i.permanent?n.permanent:null,i.origin?n.origin:null,i.backdrop?n.showBackdrop:null,i.topMenu?n.isTopMenu:null,"floating"!==s||i.permanent?null:n.floating,i.width||i.size?a(r(i.width||i.size)):null,"dark"===i.tone?"pe-dark-tone":null,"light"===i.tone?"pe-light-tone":null,i.className||i[o.class]].join(" ")})},createContent:(e,{renderer:t,Shadow:o})=>{const i=e.attrs,s=void 0!==i.shadowDepth?i.shadowDepth:void 0!==i.z?i.z:1;return[t("div",{key:"backdrop",className:n.backdrop}),t("div",{className:n.panel,key:"panel"},[t(o,{shadowDepth:s,animated:!0,key:"shadow"}),t("div",{className:n.content,style:i.style,key:"content"},i.content?i.content:e.children)])]}});e.coreMenu=p,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=polythene-core-menu.js.map
