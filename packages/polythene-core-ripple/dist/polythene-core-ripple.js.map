{"version":3,"file":"polythene-core-ripple.js","sources":["../src/animation.js","../../polythene-css-classes/ripple.js","../src/ripple.js"],"sourcesContent":["import { isTouch, getAnimationEndEvent, isServer } from \"polythene-core\";\nimport { vars } from \"polythene-theme\";\n\nconst ANIMATION_END_EVENT =    getAnimationEndEvent();\nconst DEFAULT_START_OPACITY =  0.2;\nconst DEFAULT_END_OPACITY =    0.0;\nconst DEFAULT_START_SCALE =    0.1;\nconst DEFAULT_END_SCALE =      2.0;\nconst OPACITY_DECAY_VELOCITY = 0.35;\n\nconst addStyleToHead = (id, stylesheet) => {\n  if (isServer) return;\n  const documentRef = window.document;\n  const styleEl = documentRef.createElement(\"style\");\n  styleEl.setAttribute(\"id\", id);\n  styleEl.appendChild(documentRef.createTextNode(stylesheet));\n  documentRef.head.appendChild(styleEl);\n};\n\nconst removeStyleFromHead = id => {\n  if (isServer) return;\n  const el = document.getElementById(id);\n  if (el && el.parentNode) {\n    el.parentNode.removeChild(el);\n  }\n};\n\nexport default ({ e, id, el, attrs, classes }) => {\n  return new Promise(resolve => {\n    const container = document.createElement(\"div\");\n    container.setAttribute(\"class\", classes.mask);\n    el.appendChild(container);\n    const waves = document.createElement(\"div\");\n    waves.setAttribute(\"class\", classes.waves);\n    container.appendChild(waves);\n    const rect = el.getBoundingClientRect();\n    const x = (isTouch && e.touches) ? e.touches[0].pageX : e.clientX;\n    const y = (isTouch && e.touches) ? e.touches[0].pageY : e.clientY;  \n    const w = el.offsetWidth;\n    const h = el.offsetHeight;\n    const waveRadius = Math.sqrt(w * w + h * h);\n    const mx = (attrs.center) ? (rect.left + rect.width / 2) : x;\n    const my = (attrs.center) ? (rect.top + rect.height / 2) : y;\n    const rx = mx - rect.left - waveRadius / 2;\n    const ry = my - rect.top - waveRadius / 2;\n    const startOpacity = attrs.startOpacity !== undefined\n      ? attrs.startOpacity\n      : DEFAULT_START_OPACITY;\n    const opacityDecayVelocity = attrs.opacityDecayVelocity !== undefined\n      ? attrs.opacityDecayVelocity\n      : OPACITY_DECAY_VELOCITY;\n    const endOpacity = attrs.endOpacity || DEFAULT_END_OPACITY;\n    const startScale = attrs.startScale || DEFAULT_START_SCALE;\n    const endScale = attrs.endScale || DEFAULT_END_SCALE;\n    const duration = attrs.duration\n      ? attrs.duration\n      : 1 / opacityDecayVelocity * 0.2;\n    const color = window.getComputedStyle(el).color;\n    \n    const style = waves.style;\n    style.width = style.height = waveRadius + \"px\";\n    style.top = ry + \"px\";\n    style.left = rx + \"px\";\n    style[\"animation-duration\"] =\n      style[\"-webkit-animation-duration\"] =\n      style[\"-moz-animation-duration\"] =\n      style[\"-o-animation-duration\"] = duration + \"s\";\n    style.backgroundColor = color;\n    style.opacity = startOpacity;\n    style.animationName = id;\n    style.animationTimingFunction = attrs.animationTimingFunction || vars.animation_curve_default;\n\n    const rippleStyleSheet = `@keyframes ${id} {\n      0% {\n        transform:scale(${startScale});\n        opacity: ${startOpacity}\n      }\n      100% {\n        transform:scale(${endScale});\n        opacity: ${endOpacity};\n      }\n    }`;\n    addStyleToHead(id, rippleStyleSheet);\n\n    const animationDone = evt => {\n      removeStyleFromHead(id);\n      waves.removeEventListener(ANIMATION_END_EVENT, animationDone, false);\n      if (attrs.persistent) {\n        style.opacity = endOpacity;\n        style.transform = \"scale(\" + endScale + \")\";\n      } else {\n        waves.classList.remove(classes.wavesAnimating);\n        container.removeChild(waves);\n        el.removeChild(container);\n      }\n      resolve(evt);\n    };\n\n    waves.addEventListener(ANIMATION_END_EVENT, animationDone, false);\n    waves.classList.add(classes.wavesAnimating);\n  });\n};\n","\nexport default {\n  component:      \"pe-ripple\",\n\n  // elements\n  mask:           \"pe-ripple__mask\",\n  waves:          \"pe-ripple__waves\",\n\n  // states\n  unconstrained:  \"pe-ripple--unconstrained\",\n  wavesAnimating: \"pe-ripple__waves--animating\",\n};\n","import { pointerEndEvent, filterSupportedAttributes, isServer } from \"polythene-core\";\nimport animation from \"./animation\";\nimport classes from \"polythene-css-classes/ripple\";\n\nexport const getElement = vnode =>\n  vnode.attrs.element || \"div\";\n\nexport const getInitialState = () => {\n  return {\n    animations: {},\n    animating: false,\n    cleanUp: undefined\n  };\n};\n\nexport const createProps = (vnode, { keys: k }) => {\n  const attrs = vnode.attrs;\n  return Object.assign(\n    {},\n    filterSupportedAttributes(attrs),\n    {\n      className: [\n        classes.component,\n        attrs.unconstrained ? classes.unconstrained : null,\n        attrs.tone === \"dark\" ? \"pe-dark-tone\" : null,\n        attrs.tone === \"light\" ? \"pe-light-tone\" : null,\n        attrs.className || attrs[k.class],\n      ].join(\" \")\n    }\n  );\n};\n\nconst updateAnimationState = state =>\n  state.animating = Object.keys(state.animations).length > 0;\n\nexport const onMount = vnode => {\n  if (!vnode.dom) {\n    return;\n  }\n  if (isServer) {\n    return;\n  }\n  const state = vnode.state;\n  const attrs = vnode.attrs;\n\n  const tap = e => {\n    if (attrs.disabled || (!attrs.multi && state.animating)) {\n      return;\n    }\n    if (attrs.start) {\n      attrs.start(e);\n    }\n    const id = `ripple_animation_${new Date().getTime()}`;\n    state.animations[id] = animation({ e, id, el: vnode.dom, attrs, classes })\n      .then(evt => {\n        if (attrs.end) {\n          attrs.end(evt);\n        }\n        delete state.animations[id];\n        updateAnimationState(state);\n      });\n    updateAnimationState(state);\n  };\n  const triggerEl = attrs.target\n    ? attrs.target\n    : vnode.dom && vnode.dom.parentElement;\n\n  if (triggerEl) {\n    pointerEndEvent.forEach(evt =>\n      triggerEl.addEventListener(evt, tap, false));\n  }\n  state.cleanUp = () => {\n    if (triggerEl) {\n      pointerEndEvent.forEach(evt =>\n        triggerEl.removeEventListener(evt, tap, false));\n    }\n  };\n};\n\nexport const onUnMount = ({ state }) =>\n  state.cleanUp && state.cleanUp();\n"],"names":["ANIMATION_END_EVENT","getAnimationEndEvent","DEFAULT_START_OPACITY","DEFAULT_END_OPACITY","DEFAULT_START_SCALE","DEFAULT_END_SCALE","OPACITY_DECAY_VELOCITY","addStyleToHead","id","stylesheet","isServer","documentRef","window","document","styleEl","createElement","setAttribute","appendChild","createTextNode","head","removeStyleFromHead","el","getElementById","parentNode","removeChild","e","attrs","classes","Promise","resolve","container","mask","waves","rect","getBoundingClientRect","x","isTouch","touches","pageX","clientX","y","pageY","clientY","w","offsetWidth","h","offsetHeight","waveRadius","Math","sqrt","mx","center","left","width","my","top","height","rx","ry","startOpacity","undefined","opacityDecayVelocity","endOpacity","startScale","endScale","duration","color","getComputedStyle","style","backgroundColor","opacity","animationName","animationTimingFunction","vars","animation_curve_default","rippleStyleSheet","animationDone","evt","removeEventListener","persistent","transform","classList","remove","wavesAnimating","addEventListener","add","component","unconstrained","getElement","vnode","element","getInitialState","animations","animating","cleanUp","createProps","keys","k","Object","assign","filterSupportedAttributes","className","tone","class","join","updateAnimationState","state","length","onMount","dom","tap","disabled","multi","start","Date","getTime","animation","then","end","triggerEl","target","parentElement","pointerEndEvent","forEach","onUnMount"],"mappings":"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"}