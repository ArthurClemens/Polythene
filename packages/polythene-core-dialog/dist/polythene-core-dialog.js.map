{"version":3,"file":"polythene-core-dialog.js","sources":["../../polythene-css-classes/dialog.js","../../polythene-css-classes/menu.js","../src/index.js"],"sourcesContent":["import menuClasses from \"./menu\";\n\nexport default {\n  component:         \"pe-dialog\",\n\n  // elements\n  placeholder:       \"pe-dialog__placeholder\",\n  holder:            \"pe-dialog__holder\",\n  content:           \"pe-dialog__content\",\n  backdrop:          \"pe-dialog__backdrop\",\n  touch:             \"pe-dialog__touch\",\n\n  // states\n  fullScreen:        \"pe-dialog--full-screen\",\n  modal:             \"pe-dialog--modal\",\n  open:              \"pe-dialog--open\",    // class set to html element\n  visible:           \"pe-dialog--visible\", // class set to dialog element\n  showBackdrop:      \"pe-dialog--backdrop\",\n  transition:        \"pe-dialog--transition\",\n\n  // lookup\n  menuContent:       menuClasses.content,\n};\n","import listTileClasses from \"./list-tile\";\n\nexport default {\n  component:   \"pe-menu\",\n\n  // elements\n  panel:       \"pe-menu__panel\",\n  content:     \"pe-menu__content\",\n  placeholder: \"pe-menu__placeholder\",\n  backdrop:    \"pe-menu__backdrop\",\n\n  // states\n  floating:     \"pe-menu--floating\",\n  origin:       \"pe-menu--origin\",\n  permanent:    \"pe-menu--permanent\",\n  showBackdrop: \"pe-menu--backdrop\",\n  visible:      \"pe-menu--visible\",\n  width_auto:   \"pe-menu--width-auto\",\n  width_n:      \"pe-menu--width-\",\n  isTopMenu:    \"pe-menu--top-menu\",\n\n  // lookup\n  listTile:         listTileClasses.component,\n  selectedListTile: listTileClasses.selected,\n};","import { filterSupportedAttributes, subscribe, unsubscribe, transitionComponent, stylePropCompare, transitionStateReducer, initialTransitionState, createDialogicStyles } from \"polythene-core\";\nimport classes from \"polythene-css-classes/dialog\";\nimport { dialog, Dialog as _Dialog } from \"dialogic-mithril\";\n\nconst DEFAULT_SHADOW_DEPTH = 3;\n\nexport const openDialogsSelector =\n  `.${classes.component}`;\n\nconst createPane = ({ h, Pane, props }) =>\n  h(Pane, {\n    body: props.content || props.body || props.menu || props.children,\n    element: props.element,\n    borders: props.borders,\n    className: props.className,\n    footer: props.footer,\n    footerButtons: props.footerButtons,\n    formOptions: props.formOptions,\n    fullBleed: props.fullBleed,\n    header: props.header,\n    style: props.style,\n    title: props.title,\n  });\n\nexport const _DialogComponent = ({ h, a, useState, useEffect, useRef, getRef, useReducer, Pane, Shadow, openDialogsSelector, ...props }) => {\n  const [domElement, setDomElement] = useState();\n  const dialogElRef = useRef();\n  const backdropElRef = useRef();\n  const touchElRef = useRef();\n  const contentElRef = useRef();\n\n  const hideDialog = () => {\n    dialog.hide({\n      dialogic: {\n        spawn: props.spawnId,\n        id: props.instanceId\n      }\n    });\n  };\n  \n  const isModal = () =>\n    props.modal\n    || (dialogElRef.current && dialogElRef.current.classList.contains(classes.modal))\n    || stylePropCompare({\n      element: domElement,\n      pseudoSelector: \":before\",\n      prop: \"content\",\n      contains: `\"${\"modal\"}\"`\n    });\n\n  console.log(\"domElement\", domElement);\n  console.log(\"dialogElRef.current\", dialogElRef.current);\n\n  const isFullScreen = () =>\n    props.fullScreen\n    || (dialogElRef.current && dialogElRef.current.classList.contains(classes.fullScreen))\n    || stylePropCompare({\n      element: domElement,\n      pseudoSelector: \":before\",\n      prop: \"content\",\n      contains: `\"${\"full_screen\"}\"`\n    });\n\n  // DOM elements\n  useEffect(\n    () => {\n      if (!domElement) {\n        return;\n      }\n      backdropElRef.current = domElement.querySelector(`.${classes.backdrop}`);\n      touchElRef.current = domElement.querySelector(`.${classes.touch}`);\n      contentElRef.current = domElement.querySelector(`.${classes.content}`);\n      dialogElRef.current = domElement.parentNode;\n      \n      const handleClick = e => {\n        if (e.target !== dialogElRef.current && e.target !== backdropElRef.current && e.target !== touchElRef.current) {\n          return;\n        }\n        if (isModal()) {\n          // not allowed\n          return;\n        }\n        hideDialog();\n      };\n      dialogElRef.current.addEventListener(\"click\", handleClick);\n\n      const fullScreen = isFullScreen();\n      const modal = isModal();\n\n      const classNames = [\n        props.parentClassName/* || classes.component*/,\n        props.fromMultipleClassName,\n        fullScreen ? classes.fullScreen : null,\n        modal ? classes.modal : null,\n        props.backdrop ? classes.showBackdrop : null,\n        // classes.visible is set in showDialog though transition\n        props.tone === \"dark\" ? \"pe-dark-tone\" : null,\n        props.tone === \"light\" ? \"pe-light-tone\" : null,\n        props.className || props[a.class],\n      ].filter(Boolean);\n      if (classNames.length) {\n        dialogElRef.current.classList.add(...classNames);\n      }\n      \n      return () => {\n        dialogElRef.current.removeEventListener(\"click\", handleClick);\n      }\n    },\n    [domElement]\n  );\n\n  // Handle Escape key\n  useEffect(\n    () => {\n      if (!dialogElRef.current || props.inactive) {\n        return;\n      }\n      const handleEscape = e => {\n        if (props.disableEscape && (isFullScreen() || isModal())) return;\n        if (e.key === \"Escape\" || e.key === \"Esc\") { // \"Esc\" for IE11\n          const openDialogs = document.querySelectorAll(openDialogsSelector);\n          if (openDialogs[openDialogs.length - 1] === dialogElRef.current) {\n            hideDialog();\n            unsubscribe(\"keydown\", handleEscape);\n          }\n        }\n      };\n      subscribe(\"keydown\", handleEscape);\n\n      return () => {\n        unsubscribe(\"keydown\", handleEscape);\n      };\n    },\n    [domElement, props.inactive]\n  );\n  \n  const componentProps = Object.assign(\n    {}, \n    filterSupportedAttributes(props, { remove: [\"style\"] }), // style set in content, and set by show/hide transition\n    getRef(dom => dom && !domElement && (\n      setDomElement(dom),\n      props.ref && props.ref(dom)\n    )),\n    {\n      \"data-spawn-id\": props.spawnId,\n      \"data-instance-id\": props.instanceId,\n    }\n  );\n\n  const pane = props.panesOptions && props.panesOptions.length\n    ? h(Pane, props.panesOptions[0])\n    : props.panes && props.panes.length\n      ? props.panes[0]\n      : createPane({ h, Pane, props });\n  const shadowDepth = props.shadowDepth;\n\n  const content = [\n    h(\"div\",\n      {\n        className: classes.backdrop\n      }\n    ),\n    h(\"div\",\n      {\n        className: classes.touch\n      }\n    ),\n    h(\"div\",\n      {\n        className: [\n          classes.content,\n          props.menu ? classes.menuContent : null\n        ].join(\" \"),\n      },\n      [\n        props.fullScreen\n          ? null\n          : h(Shadow, {\n            shadowDepth: shadowDepth !== undefined\n              ? shadowDepth\n              : DEFAULT_SHADOW_DEPTH,\n            animated: true,\n          }),\n        props.before,\n        pane,\n        props.after,\n      ]\n    )\n  ];\n\n  return h(\"div\", componentProps, content);\n};\n\nexport { _Dialog };\n\nexport const _show = ({ DialogComponent }) => (props = {}, spawnProps = {}) => {\n  const { styles, otherProps: componentProps } = createDialogicStyles(props);\n  const { spawn, id } = spawnProps;\n  return dialog.show({\n    dialogic: {\n      className: classes.component,\n      component: DialogComponent,\n      styles,\n      spawn,\n      id,\n    },\n    ...componentProps,\n    spawnId: spawn,\n    instanceId: id\n  })\n};\n\nexport const _hide = ({ spawn, id } = {}) => {\n  return dialog.hide({\n    dialogic: {\n      spawn,\n      id,\n    },\n    spawnId: spawn,\n    instanceId: id\n  })\n};\n"],"names":["component","placeholder","holder","content","backdrop","touch","fullScreen","modal","open","visible","showBackdrop","transition","menuContent","openDialogsSelector","classes","h","a","useState","useEffect","useRef","getRef","Pane","useReducer","Shadow","props","domElement","setDomElement","dialogElRef","backdropElRef","touchElRef","contentElRef","hideDialog","dialog","hide","dialogic","spawn","spawnId","id","instanceId","isModal","current","classList","contains","stylePropCompare","element","pseudoSelector","prop","console","log","isFullScreen","querySelector","parentNode","handleClick","e","target","addEventListener","classNames","parentClassName","fromMultipleClassName","tone","className","filter","Boolean","length","add","removeEventListener","inactive","handleEscape","disableEscape","key","openDialogs","document","querySelectorAll","unsubscribe","subscribe","componentProps","_extends","filterSupportedAttributes","remove","dom","ref","pane","panesOptions","panes","body","menu","children","borders","footer","footerButtons","formOptions","fullBleed","header","style","title","createPane","shadowDepth","join","undefined","animated","before","after","DialogComponent","spawnProps","createDialogicStyles","styles","otherProps","show"],"mappings":"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"}