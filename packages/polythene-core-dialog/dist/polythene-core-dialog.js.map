{"version":3,"file":"polythene-core-dialog.js","sources":["../../polythene-css-classes/dialog.js","../../polythene-css-classes/menu.js","../src/dialog.js"],"sourcesContent":["import menuClasses from \"./menu\";\n\nexport default {\n  component:         \"pe-dialog\",\n\n  // elements\n  placeholder:       \"pe-dialog__placeholder\",\n  holder:            \"pe-dialog__holder\",\n  content:           \"pe-dialog__content\",\n  backdrop:          \"pe-dialog__backdrop\",\n  touch:             \"pe-dialog__touch\",\n\n  // states\n  fullScreen:        \"pe-dialog--full-screen\",\n  modal:             \"pe-dialog--modal\",\n  open:              \"pe-dialog--open\",    // class set to html element\n  visible:           \"pe-dialog--visible\", // class set to dialog element\n  showBackdrop:      \"pe-dialog--backdrop\",\n  transition:        \"pe-dialog--transition\",\n\n  // lookup\n  menuContent:       menuClasses.content,\n};\n","import listTileClasses from \"./list-tile\";\n\nexport default {\n  component:   \"pe-menu\",\n\n  // elements\n  panel:       \"pe-menu__panel\",\n  content:     \"pe-menu__content\",\n  placeholder: \"pe-menu__placeholder\",\n  backdrop:    \"pe-menu__backdrop\",\n\n  // states\n  floating:     \"pe-menu--floating\",\n  origin:       \"pe-menu--origin\",\n  permanent:    \"pe-menu--permanent\",\n  showBackdrop: \"pe-menu--backdrop\",\n  visible:      \"pe-menu--visible\",\n  width_auto:   \"pe-menu--width-auto\",\n  width_n:      \"pe-menu--width-\",\n  isTopMenu:    \"pe-menu--top-menu\",\n\n  // lookup\n  listTile:         listTileClasses.component,\n  selectedListTile: listTileClasses.selected,\n};","import { filterSupportedAttributes, subscribe, unsubscribe, transitionComponent, stylePropCompare, deprecation } from \"polythene-core\";\nimport classes from \"polythene-css-classes/dialog\";\n\nconst DEFAULT_SHADOW_DEPTH    = 3;\n\nexport const getElement = vnode =>\n  vnode.attrs.element || \"div\";\n\nconst isFullScreen = ({ state, attrs }) =>\n  attrs.fullScreen || stylePropCompare({\n    element: state.el,\n    pseudoSelector: \":before\",\n    prop: \"content\",\n    contains: `\"${\"full_screen\"}\"`\n  });\n\nconst isModal = ({ state, attrs }) =>\n  attrs.modal || stylePropCompare({\n    element: state.el,\n    pseudoSelector: \":before\",\n    prop: \"content\",\n    contains: `\"${\"modal\"}\"`\n  });\n\nconst transitionOptions = (state, attrs, isShow) => ({\n  isTransitioning: state.transitioning(),\n  setIsTransitioning: state.transitioning,\n  setIsVisible: state.visible,\n  instanceId: state.instanceId,\n  attrs,\n  isShow,\n  domElements: {\n    el: state.el,\n    contentEl: state.contentEl,\n    backdropEl: state.backdropEl,\n  },\n  showClass: classes.visible,\n  transitionClass: classes.transition,\n});\n\nconst showDialog = (state, attrs) =>\n  transitionComponent(transitionOptions(state, attrs, true));\n\nconst hideDialog = (state, attrs) =>\n  transitionComponent(transitionOptions(state, attrs, false));\n\nexport const getInitialState = (vnode, createStream) => {\n  const transitioning = createStream(false);\n  const visible = createStream(false);\n  return {\n    backdropEl: undefined,\n    touchEl:    undefined,\n    cleanUp:    undefined,\n    el:         undefined,\n    contentEl:  undefined,\n    transitioning,\n    visible,\n    redrawOnUpdate: createStream.merge([transitioning])\n  };\n};\n\nexport const onMount = vnode => {\n  if (!vnode.dom) {\n    return;\n  }\n  const state = vnode.state;\n  const attrs = vnode.attrs;\n\n  if (attrs.z !== undefined) {\n    deprecation(\"Dialog\", { option: \"z\", newOption: \"shadowDepth\" });\n  }\n\n  const dom = vnode.dom;\n  state.el = dom;\n  state.backdropEl = dom.querySelector(`.${classes.backdrop}`);\n  state.touchEl = dom.querySelector(`.${classes.touch}`);\n  state.contentEl = dom.querySelector(`.${classes.content}`);\n\n  if (!attrs.inactive) { // used by Drawer\n\n    const handleEscape = e => {\n      if (isFullScreen(vnode) || isModal(vnode)) return;\n      if (e.key === \"Escape\" || e.key === \"Esc\") { // \"Esc\" for IE11\n        const openDialogs = document.querySelectorAll(`.${classes.component}`);\n        if (openDialogs[openDialogs.length - 1] === state.el) {\n          hideDialog(state, Object.assign({}, attrs, {\n            hideDelay: 0\n          }));\n        }\n      }\n    };\n\n    state.cleanUp = () => (\n      unsubscribe(\"keydown\", handleEscape)\n    );\n\n    subscribe(\"keydown\", handleEscape);\n\n    if (attrs.show) {\n      showDialog(state, attrs);\n    }\n  }\n};\n\nexport const onUnMount = vnode => (\n  vnode.state.cleanUp && vnode.state.cleanUp()\n);\n\nexport const createProps = (vnode, { keys: k }) => {\n  const state = vnode.state;\n  const attrs = vnode.attrs;\n  return Object.assign(\n    {},\n    filterSupportedAttributes(attrs, { remove: [\"style\"] }), // style set in content, and set by show/hide transition\n    attrs.testId && { \"data-test-id\": attrs.testId },\n    {\n      className: [\n        attrs.parentClassName || classes.component,\n        attrs.fromMultipleClassName,\n        attrs.fullScreen ? classes.fullScreen : null,\n        attrs.modal ? classes.modal : null,\n        attrs.backdrop ? classes.showBackdrop : null,\n        // classes.visible is set in showDialog though transition\n        attrs.tone === \"dark\" ? \"pe-dark-tone\" : null,\n        attrs.tone === \"light\" ? \"pe-light-tone\" : null,\n        attrs.className || attrs[k.class],\n      ].join(\" \"),\n      \"data-spawn-id\": attrs.spawnId,       // received from Multi\n      \"data-instance-id\": attrs.instanceId, // received from Multi\n      // click backdrop: close dialog\n      [k.onclick]: e => {\n        if (e.target !== state.el && e.target !== state.backdropEl && e.target !== state.touchEl) {\n          return;\n        }\n        if (isModal(vnode)) {\n          // not allowed\n          return;\n        }\n        hideDialog(state, attrs);\n      }\n    }\n  );\n};\n\nexport const createPane = (vnode, { renderer: h, Pane }) => {\n  const attrs = vnode.attrs;\n  return h(Pane, {\n    body: attrs.content || attrs.body || attrs.menu || vnode.children,\n    borders: attrs.borders,\n    className: attrs.className,\n    footer: attrs.footer,\n    footerButtons: attrs.footerButtons,\n    formOptions: attrs.formOptions,\n    fullBleed: attrs.fullBleed,\n    header: attrs.header,\n    style: attrs.style,\n    title: attrs.title,\n  });\n};\n\nexport const createContent = (vnode, { renderer, Shadow, createPane, Pane }) => {\n  const state = vnode.state;\n  const attrs = vnode.attrs;\n  const h = renderer;\n\n  if (state.el) {\n    const visible = state.visible();\n    const transitioning = state.transitioning();\n    if (!transitioning) {\n      if (attrs.hide && visible) {\n        // Use setTimeout to play nice with React's lifecycle functions\n        setTimeout(() => hideDialog(state, attrs), 0);\n      } else if (attrs.show && !visible) {\n        setTimeout(() => showDialog(state, attrs), 0);\n      }\n    }\n  }\n  const pane = attrs.panesOptions && attrs.panesOptions.length\n    ? h(Pane, attrs.panesOptions[0])\n    : attrs.panes && attrs.panes.length\n      ? attrs.panes[0]\n      : createPane(vnode, { renderer, Pane } );\n  const shadowDepth = attrs.shadowDepth !== undefined\n    ? attrs.shadowDepth\n    : attrs.z; // deprecated\n  return [\n    h(\"div\",\n      {\n        key: \"backdrop\",\n        className: classes.backdrop\n      }\n    ),\n    h(\"div\",\n      {\n        key: \"touch\",\n        className: classes.touch\n      }\n    ),\n    h(\"div\",\n      {\n        className: [\n          classes.content,\n          attrs.menu ? classes.menuContent : null\n        ].join(\" \"),\n        key: \"content\"\n      },\n      [\n        attrs.fullScreen\n          ? null\n          : h(Shadow, {\n            shadowDepth: shadowDepth !== undefined\n              ? shadowDepth\n              : DEFAULT_SHADOW_DEPTH,\n            animated: true,\n            key: \"shadow\"\n          }),\n        pane\n      ]\n    )\n  ];\n};\n"],"names":["component","placeholder","holder","content","backdrop","touch","fullScreen","modal","open","visible","showBackdrop","transition","menuContent","isModal","state","attrs","stylePropCompare","element","el","pseudoSelector","prop","contains","transitionOptions","isShow","isTransitioning","transitioning","setIsTransitioning","setIsVisible","instanceId","domElements","contentEl","backdropEl","showClass","classes","transitionClass","showDialog","transitionComponent","hideDialog","vnode","createStream","undefined","touchEl","cleanUp","redrawOnUpdate","merge","dom","z","deprecation","option","newOption","querySelector","inactive","handleEscape","e","isFullScreen","key","openDialogs","document","querySelectorAll","length","_extends","hideDelay","unsubscribe","subscribe","show","k","keys","filterSupportedAttributes","remove","testId","className","parentClassName","fromMultipleClassName","tone","class","join","spawnId","onclick","target","h","renderer","Pane","body","menu","children","borders","footer","footerButtons","formOptions","fullBleed","header","style","title","Shadow","createPane","hide","setTimeout","pane","panesOptions","panes","shadowDepth","animated"],"mappings":"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"}