{"version":3,"file":"polythene-core-dialog.js","sources":["../../polythene-css-classes/dialog.js","../../polythene-css-classes/menu.js","../src/dialog.js"],"sourcesContent":["import menuClasses from \"./menu\";\n\nexport default {\n  component:         \"pe-dialog\",\n\n  // elements\n  placeholder:       \"pe-dialog__placeholder\",\n  holder:            \"pe-dialog__holder\",\n  content:           \"pe-dialog__content\",\n  backdrop:          \"pe-dialog__backdrop\",\n  touch:             \"pe-dialog__touch\",\n\n  // states\n  fullScreen:        \"pe-dialog--full-screen\",\n  modal:             \"pe-dialog--modal\",\n  open:              \"pe-dialog--open\",    // class set to html element\n  visible:           \"pe-dialog--visible\", // class set to dialog element\n  showBackdrop:      \"pe-dialog--backdrop\",\n  transition:        \"pe-dialog--transition\",\n\n  // lookup\n  menuContent:       menuClasses.content,\n};\n","import listTileClasses from \"./list-tile\";\n\nexport default {\n  component:   \"pe-menu\",\n\n  // elements\n  panel:       \"pe-menu__panel\",\n  content:     \"pe-menu__content\",\n  placeholder: \"pe-menu__placeholder\",\n  backdrop:    \"pe-menu__backdrop\",\n\n  // states\n  floating:     \"pe-menu--floating\",\n  origin:       \"pe-menu--origin\",\n  permanent:    \"pe-menu--permanent\",\n  showBackdrop: \"pe-menu--backdrop\",\n  visible:      \"pe-menu--visible\",\n  width_auto:   \"pe-menu--width-auto\",\n  width_n:      \"pe-menu--width-\",\n  isTopMenu:    \"pe-menu--top-menu\",\n\n  // lookup\n  listTile:         listTileClasses.component,\n  selectedListTile: listTileClasses.selected,\n};","import { filterSupportedAttributes, subscribe, unsubscribe, transitionComponent, stylePropCompare, deprecation } from \"polythene-core\";\nimport classes from \"polythene-css-classes/dialog\";\n\nconst DEFAULT_SHADOW_DEPTH    = 3;\n\nexport const getElement = vnode =>\n  vnode.attrs.element || \"div\";\n\nconst isFullScreen = ({ state, attrs }) =>\n  attrs.fullScreen || stylePropCompare({\n    element: state.el,\n    pseudoSelector: \":before\",\n    prop: \"content\",\n    contains: `\"${\"full_screen\"}\"`\n  });\n\nconst isModal = ({ state, attrs }) =>\n  attrs.modal || stylePropCompare({\n    element: state.el,\n    pseudoSelector: \":before\",\n    prop: \"content\",\n    contains: `\"${\"modal\"}\"`\n  });\n\nconst transitionOptions = (state, attrs, isShow) => ({\n  state,\n  attrs,\n  isShow,\n  domElements: {\n    el: state.el,\n    contentEl: state.contentEl,\n    backdropEl: state.backdropEl,\n  },\n  showClass: classes.visible,\n  transitionClass: classes.transition,\n});\n\nconst showDialog = (state, attrs) =>\n  transitionComponent(transitionOptions(state, attrs, true));\n\nconst hideDialog = (state, attrs) =>\n  transitionComponent(transitionOptions(state, attrs, false));\n\nexport const getInitialState = (vnode, createStream) => {\n  const transitioning = createStream(false);\n  const visible = createStream(false);\n  return {\n    backdropEl: undefined,\n    touchEl:    undefined,\n    cleanUp:    undefined,\n    el:         undefined,\n    contentEl:  undefined,\n    transitioning,\n    visible,\n    redrawOnUpdate: createStream.merge([transitioning])\n  };\n};\n\nexport const onMount = vnode => {\n  if (!vnode.dom) {\n    return;\n  }\n  const state = vnode.state;\n  const attrs = vnode.attrs;\n\n  if (attrs.z !== undefined) {\n    deprecation(\"Dialog\", { option: \"z\", newOption: \"shadowDepth\" });\n  }\n\n  const dom = vnode.dom;\n  state.el = dom;\n  state.backdropEl = dom.querySelector(`.${classes.backdrop}`);\n  state.touchEl = dom.querySelector(`.${classes.touch}`);\n  state.contentEl = dom.querySelector(`.${classes.content}`);\n\n  if (!attrs.inactive) {\n\n    const handleEscape = e => {\n      if (isFullScreen(vnode) || isModal(vnode)) return;\n      if (e.key === \"Escape\" || e.key === \"Esc\") { // \"Esc\" for IE11\n        const openDialogs = document.querySelectorAll(`.${classes.component}`);\n        if (openDialogs[openDialogs.length - 1] === state.el) {\n          hideDialog(state, Object.assign({}, attrs, {\n            hideDelay: 0\n          }));\n        }\n      }\n    };\n\n    state.cleanUp = () => (\n      unsubscribe(\"keydown\", handleEscape)\n    );\n\n    subscribe(\"keydown\", handleEscape);\n\n    if (attrs.show) {\n      showDialog(state, attrs);\n    }\n  }\n};\n\nexport const onUnMount = vnode => (\n  vnode.state.cleanUp && vnode.state.cleanUp()\n);\n\nexport const createProps = (vnode, { keys: k }) => {\n  const state = vnode.state;\n  const attrs = vnode.attrs;\n  return Object.assign(\n    {},\n    filterSupportedAttributes(attrs, { remove: [\"style\"] }), // style set in content, and set by show/hide transition\n    {\n      className: [\n        attrs.parentClassName || classes.component,\n        attrs.fromMultipleClassName,\n        attrs.fullScreen ? classes.fullScreen : null,\n        attrs.modal ? classes.modal : null,\n        attrs.backdrop ? classes.showBackdrop : null,\n        // classes.visible is set in showDialog though transition\n        attrs.tone === \"dark\" ? \"pe-dark-tone\" : null,\n        attrs.tone === \"light\" ? \"pe-light-tone\" : null,\n        attrs.className || attrs[k.class],\n      ].join(\" \"),\n      \"data-spawn-id\": attrs.spawnId,\n      \"data-instance-id\": attrs.instanceId,\n      // click backdrop: close dialog\n      [k.onclick]: e => {\n        if (e.target !== state.el && e.target !== state.backdropEl && e.target !== state.touchEl) {\n          return;\n        }\n        if (isModal(vnode)) {\n          // not allowed\n          return;\n        }\n        hideDialog(state, attrs);\n      }\n    }\n  );\n};\n\nexport const createPane = (vnode, { renderer: h, Pane }) => {\n  const attrs = vnode.attrs;\n  return h(Pane, {\n    body: attrs.content || attrs.body || attrs.menu || vnode.children,\n    borders: attrs.borders,\n    className: attrs.className,\n    footer: attrs.footer,\n    footerButtons: attrs.footerButtons,\n    formOptions: attrs.formOptions,\n    fullBleed: attrs.fullBleed,\n    header: attrs.header,\n    style: attrs.style,\n    title: attrs.title,\n  });\n};\n\nexport const createContent = (vnode, { renderer, Shadow, createPane, Pane }) => {\n  const state = vnode.state;\n  const attrs = vnode.attrs;\n  const h = renderer;\n\n  if (state.el) {\n    const visible = state.visible();\n    const transitioning = state.transitioning();\n    if (!transitioning) {\n      if (attrs.hide && visible) {\n        // Use setTimeout to play nice with React's lifecycle functions\n        setTimeout(() => hideDialog(state, attrs), 0);\n      } else if (attrs.show && !visible) {\n        setTimeout(() => showDialog(state, attrs), 0);\n      }\n    }\n  }\n  const pane = attrs.panesOptions && attrs.panesOptions.length\n    ? h(Pane, attrs.panesOptions[0])\n    : attrs.panes && attrs.panes.length\n      ? attrs.panes[0]\n      : createPane(vnode, { renderer, Pane } );\n  const shadowDepth = attrs.shadowDepth !== undefined\n    ? attrs.shadowDepth\n    : attrs.z; // deprecated\n  return [\n    h(\"div\",\n      {\n        key: \"backdrop\",\n        className: classes.backdrop\n      }\n    ),\n    h(\"div\",\n      {\n        key: \"touch\",\n        className: classes.touch\n      }\n    ),\n    h(\"div\",\n      {\n        className: [\n          classes.content,\n          attrs.menu ? classes.menuContent : null\n        ].join(\" \"),\n        key: \"content\"\n      },\n      [\n        attrs.fullScreen\n          ? null\n          : h(Shadow, {\n            shadowDepth: shadowDepth !== undefined\n              ? shadowDepth\n              : DEFAULT_SHADOW_DEPTH,\n            animated: true,\n            key: \"shadow\"\n          }),\n        pane\n      ]\n    )\n  ];\n};\n"],"names":["component","placeholder","holder","content","backdrop","touch","fullScreen","modal","open","visible","showBackdrop","transition","menuContent","isModal","state","attrs","stylePropCompare","element","el","pseudoSelector","prop","contains","transitionOptions","isShow","domElements","contentEl","backdropEl","showClass","classes","transitionClass","showDialog","transitionComponent","hideDialog","vnode","createStream","transitioning","undefined","touchEl","cleanUp","redrawOnUpdate","merge","dom","z","deprecation","option","newOption","querySelector","inactive","handleEscape","e","isFullScreen","key","openDialogs","document","querySelectorAll","length","Object","assign","hideDelay","unsubscribe","subscribe","show","keys","k","filterSupportedAttributes","remove","className","parentClassName","fromMultipleClassName","tone","class","join","spawnId","instanceId","onclick","target","renderer","h","Pane","body","menu","children","borders","footer","footerButtons","formOptions","fullBleed","header","style","title","Shadow","createPane","hide","setTimeout","pane","panesOptions","panes","shadowDepth","animated"],"mappings":"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"}