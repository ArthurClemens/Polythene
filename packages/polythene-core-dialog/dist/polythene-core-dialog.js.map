{"version":3,"file":"polythene-core-dialog.js","sources":["../../polythene-css-classes/dialog.js","../../polythene-css-classes/menu.js","../src/dialog.js"],"sourcesContent":["import menuClasses from \"./menu\";\n\nexport default {\n  component:         \"pe-dialog\",\n\n  // elements\n  placeholder:       \"pe-dialog__placeholder\",\n  holder:            \"pe-dialog__holder\",\n  content:           \"pe-dialog__content\",\n  backdrop:          \"pe-dialog__backdrop\",\n  touch:             \"pe-dialog__touch\",\n\n  // states\n  fullScreen:        \"pe-dialog--full-screen\",\n  modal:             \"pe-dialog--modal\",\n  open:              \"pe-dialog--open\",    // class set to html element\n  visible:           \"pe-dialog--visible\", // class set to dialog element\n  showBackdrop:      \"pe-dialog--backdrop\",\n  transition:        \"pe-dialog--transition\",\n\n  // lookup\n  menuContent:       menuClasses.content,\n};\n","import listTileClasses from \"./list-tile\";\n\nexport default {\n  component:   \"pe-menu\",\n\n  // elements\n  panel:       \"pe-menu__panel\",\n  content:     \"pe-menu__content\",\n  placeholder: \"pe-menu__placeholder\",\n  backdrop:    \"pe-menu__backdrop\",\n\n  // states\n  floating:     \"pe-menu--floating\",\n  origin:       \"pe-menu--origin\",\n  permanent:    \"pe-menu--permanent\",\n  showBackdrop: \"pe-menu--backdrop\",\n  visible:      \"pe-menu--visible\",\n  width_auto:   \"pe-menu--width-auto\",\n  width_n:      \"pe-menu--width-\",\n  isTopMenu:    \"pe-menu--top-menu\",\n\n  // lookup\n  listTile:         listTileClasses.component,\n  selectedListTile: listTileClasses.selected,\n};","import { filterSupportedAttributes, subscribe, unsubscribe, transitionComponent, stylePropCompare, deprecation } from \"polythene-core\";\nimport classes from \"polythene-css-classes/dialog\";\n\nconst DEFAULT_SHADOW_DEPTH    = 3;\n\nexport const getElement = vnode =>\n  vnode.attrs.element || \"div\";\n\nconst isFullScreen = ({ state, attrs }) =>\n  attrs.fullScreen || stylePropCompare({\n    element: state.el,\n    pseudoSelector: \":before\",\n    prop: \"content\",\n    contains: `\"${\"full_screen\"}\"`\n  });\n\nconst isModal = ({ state, attrs }) =>\n  attrs.modal || stylePropCompare({\n    element: state.el,\n    pseudoSelector: \":before\",\n    prop: \"content\",\n    contains: `\"${\"modal\"}\"`\n  });\n\nconst transitionOptions = (state, attrs, isShow) => ({\n  state,\n  attrs,\n  isShow,\n  domElements: {\n    el: state.el,\n    contentEl: state.contentEl,\n    backdropEl: state.backdropEl,\n  },\n  showClass: classes.visible,\n  transitionClass: classes.transition,\n});\n\nconst showDialog = (state, attrs) =>\n  transitionComponent(transitionOptions(state, attrs, true));\n\nconst hideDialog = (state, attrs) =>\n  transitionComponent(transitionOptions(state, attrs, false));\n\nexport const getInitialState = (vnode, createStream) => {\n  const transitioning = createStream(false);\n  const visible = createStream(false);\n  return {\n    backdropEl: undefined,\n    touchEl:    undefined,\n    cleanUp:    undefined,\n    el:         undefined,\n    contentEl:  undefined,\n    transitioning,\n    visible,\n    redrawOnUpdate: createStream.merge([transitioning])\n  };\n};\n\nexport const onMount = vnode => {\n  if (!vnode.dom) {\n    return;\n  }\n  const state = vnode.state;\n  const attrs = vnode.attrs;\n\n  if (attrs.z !== undefined) {\n    deprecation(\"Dialog\", { option: \"z\", newOption: \"shadowDepth\" });\n  }\n\n  const dom = vnode.dom;\n  state.el = dom;\n  state.backdropEl = dom.querySelector(`.${classes.backdrop}`);\n  state.touchEl = dom.querySelector(`.${classes.touch}`);\n  state.contentEl = dom.querySelector(`.${classes.content}`);\n\n  if (!attrs.inactive) {\n\n    const handleEscape = e => {\n      if (isFullScreen(vnode) || isModal(vnode)) return;\n      if (e.key === \"Escape\" || e.key === \"Esc\") { // \"Esc\" for IE11\n        const openDialogs = document.querySelectorAll(`.${classes.component}`);\n        if (openDialogs[openDialogs.length - 1] === state.el) {\n          hideDialog(state, Object.assign({}, attrs, {\n            hideDelay: 0\n          }));\n        }\n      }\n    };\n\n    state.cleanUp = () => (\n      unsubscribe(\"keydown\", handleEscape)\n    );\n\n    subscribe(\"keydown\", handleEscape);\n\n    if (attrs.show) {\n      showDialog(state, attrs);\n    }\n  }\n};\n\nexport const onUnMount = vnode => (\n  vnode.state.cleanUp && vnode.state.cleanUp()\n);\n\nexport const createProps = (vnode, { keys: k }) => {\n  const state = vnode.state;\n  const attrs = vnode.attrs;\n  return Object.assign(\n    {},\n    filterSupportedAttributes(attrs, { remove: [\"style\"] }), // style set in content, and set by show/hide transition\n    {\n      className: [\n        attrs.parentClassName || classes.component,\n        attrs.fromMultipleClassName,\n        attrs.fullScreen ? classes.fullScreen : null,\n        attrs.modal ? classes.modal : null,\n        attrs.backdrop ? classes.showBackdrop : null,\n        // classes.visible is set in showDialog though transition\n        attrs.tone === \"dark\" ? \"pe-dark-tone\" : null,\n        attrs.tone === \"light\" ? \"pe-light-tone\" : null,\n        attrs.className || attrs[k.class],\n      ].join(\" \"),\n      \"data-spawn-id\": attrs.spawnId,\n      \"data-instance-id\": attrs.instanceId,\n      // click backdrop: close dialog\n      [k.onclick]: e => {\n        if (e.target !== state.el && e.target !== state.backdropEl && e.target !== state.touchEl) {\n          return;\n        }\n        if (isModal(vnode)) {\n          // not allowed\n          return;\n        }\n        hideDialog(state, attrs);\n      }\n    }\n  );\n};\n\nexport const createPane = (vnode, { renderer: h, Pane }) => {\n  const attrs = vnode.attrs;\n  return h(Pane, {\n    body: attrs.content || attrs.body || attrs.menu || vnode.children,\n    borders: attrs.borders,\n    className: attrs.className,\n    footer: attrs.footer,\n    footerButtons: attrs.footerButtons,\n    formOptions: attrs.formOptions,\n    fullBleed: attrs.fullBleed,\n    header: attrs.header,\n    style: attrs.style,\n    title: attrs.title,\n  });\n};\n\nexport const createContent = (vnode, { renderer, Shadow, createPane, Pane }) => {\n  const state = vnode.state;\n  const attrs = vnode.attrs;\n  const h = renderer;\n\n  if (state.el) {\n    const visible = state.visible();\n    const transitioning = state.transitioning();\n    if (!transitioning) {\n      if (attrs.hide && visible) {\n        // Use setTimeout to play nice with React's lifecycle functions\n        setTimeout(() => hideDialog(state, attrs), 0);\n      } else if (attrs.show && !visible) {\n        setTimeout(() => showDialog(state, attrs), 0);\n      }\n    }\n  }\n  const pane = attrs.panesOptions && attrs.panesOptions.length\n    ? h(Pane, attrs.panesOptions[0])\n    : attrs.panes && attrs.panes.length\n      ? attrs.panes[0]\n      : createPane(vnode, { renderer, Pane } );\n  const shadowDepth = attrs.shadowDepth !== undefined\n    ? attrs.shadowDepth\n    : attrs.z; // deprecated\n  return [\n    h(\"div\",\n      {\n        key: \"backdrop\",\n        className: classes.backdrop\n      }\n    ),\n    h(\"div\",\n      {\n        key: \"touch\",\n        className: classes.touch\n      }\n    ),\n    h(\"div\",\n      {\n        className: [\n          classes.content,\n          attrs.menu ? classes.menuContent : null\n        ].join(\" \"),\n        key: \"content\"\n      },\n      [\n        attrs.fullScreen\n          ? null\n          : h(Shadow, {\n            shadowDepth: shadowDepth !== undefined\n              ? shadowDepth\n              : DEFAULT_SHADOW_DEPTH,\n            animated: true,\n            key: \"shadow\"\n          }),\n        pane\n      ]\n    )\n  ];\n};\n"],"names":["component","placeholder","holder","content","backdrop","touch","fullScreen","modal","open","visible","showBackdrop","transition","menuContent","isModal","state","attrs","stylePropCompare","element","el","pseudoSelector","prop","contains","transitionOptions","isShow","domElements","contentEl","backdropEl","showClass","classes","transitionClass","showDialog","transitionComponent","hideDialog","vnode","createStream","transitioning","undefined","touchEl","cleanUp","redrawOnUpdate","merge","dom","z","deprecation","option","newOption","querySelector","inactive","handleEscape","e","isFullScreen","key","openDialogs","document","querySelectorAll","length","_extends","hideDelay","unsubscribe","subscribe","show","k","keys","filterSupportedAttributes","remove","className","parentClassName","fromMultipleClassName","tone","class","join","spawnId","instanceId","onclick","target","h","renderer","Pane","body","menu","children","borders","footer","footerButtons","formOptions","fullBleed","header","style","title","Shadow","createPane","hide","setTimeout","pane","panesOptions","panes","shadowDepth","animated"],"mappings":"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"}