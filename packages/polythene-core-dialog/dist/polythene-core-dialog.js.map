{"version":3,"file":"polythene-core-dialog.js","sources":["../../polythene-css-classes/dialog.js","../../polythene-css-classes/menu.js","../src/index.js"],"sourcesContent":["import menuClasses from \"./menu\";\n\nexport default {\n  component:         \"pe-dialog\",\n\n  // elements\n  placeholder:       \"pe-dialog__placeholder\",\n  holder:            \"pe-dialog__holder\",\n  content:           \"pe-dialog__content\",\n  backdrop:          \"pe-dialog__backdrop\",\n  touch:             \"pe-dialog__touch\",\n\n  // states\n  fullScreen:        \"pe-dialog--full-screen\",\n  modal:             \"pe-dialog--modal\",\n  open:              \"pe-dialog--open\",    // class set to html element\n  visible:           \"pe-dialog--visible\", // class set to dialog element\n  showBackdrop:      \"pe-dialog--backdrop\",\n  transition:        \"pe-dialog--transition\",\n\n  // lookup\n  menuContent:       menuClasses.content,\n};\n","import listTileClasses from \"./list-tile\";\n\nexport default {\n  component:   \"pe-menu\",\n\n  // elements\n  panel:       \"pe-menu__panel\",\n  content:     \"pe-menu__content\",\n  placeholder: \"pe-menu__placeholder\",\n  backdrop:    \"pe-menu__backdrop\",\n\n  // states\n  floating:     \"pe-menu--floating\",\n  origin:       \"pe-menu--origin\",\n  permanent:    \"pe-menu--permanent\",\n  showBackdrop: \"pe-menu--backdrop\",\n  visible:      \"pe-menu--visible\",\n  width_auto:   \"pe-menu--width-auto\",\n  width_n:      \"pe-menu--width-\",\n  isTopMenu:    \"pe-menu--top-menu\",\n\n  // lookup\n  listTile:         listTileClasses.component,\n  selectedListTile: listTileClasses.selected,\n};","import { filterSupportedAttributes, subscribe, unsubscribe, transitionComponent, stylePropCompare, transitionStateReducer, REFERRER_COMPONENT } from \"polythene-core\";\nimport classes from \"polythene-css-classes/dialog\";\n\nconst DEFAULT_SHADOW_DEPTH = 3;\n\nexport const openDialogsSelector =\n  `.${classes.component}`;\n\nconst createPane = ({ h, Pane, props }) =>\n  h(Pane, {\n    body: props.content || props.body || props.menu || props.children,\n    borders: props.borders,\n    className: props.className,\n    footer: props.footer,\n    footerButtons: props.footerButtons,\n    formOptions: props.formOptions,\n    fullBleed: props.fullBleed,\n    header: props.header,\n    style: props.style,\n    title: props.title,\n  });\n\nconst initialTransitionState = {\n  isVisible: false,\n  isTransitioning: false,\n  isHiding: false,\n};\n  \nexport const _Dialog = ({ h, a, useState, useEffect, useRef, getRef, useReducer, Pane, Shadow, openDialogsSelector, ...props }) => {\n  const [transitionState, dispatchTransitionState] = useReducer(transitionStateReducer, initialTransitionState);\n  const [domElement, setDomElement] = useState();\n  const backdropElRef = useRef();\n  const touchElRef = useRef();\n  const contentElRef = useRef();\n  \n  const isVisible = transitionState.isVisible;\n  const isTransitioning = transitionState.isTransitioning;\n  const isHiding = transitionState.isHiding;\n  \n  const transitionOptions = ({ isShow, hideDelay = props.hideDelay, referrer }) => ({\n    dispatchTransitionState,\n    instanceId: props.instanceId,\n    props: Object.assign({}, props, {\n      hideDelay\n    }),\n    isShow,\n    domElements: {\n      el: domElement,\n      contentEl: contentElRef.current,\n      backdropEl: backdropElRef.current,\n    },\n    showClass: classes.visible,\n    transitionClass: classes.transition,\n    referrer,\n  });\n  \n  const showDialog = () => (\n    transitionComponent(transitionOptions({ isShow: true }))\n  );\n  \n  const hideDialog = ({ hideDelay, referrer } = {}) => (\n    transitionComponent(transitionOptions({ isShow: false, hideDelay, referrer } ))\n  );\n  \n  const isModal = () =>\n    props.modal\n    || (domElement && domElement.classList.contains(classes.modal))\n    || stylePropCompare({\n      element: domElement,\n      pseudoSelector: \":before\",\n      prop: \"content\",\n      contains: `\"${\"modal\"}\"`\n    });\n\n  const isFullScreen = () =>\n    props.fullScreen\n    || (domElement && domElement.classList.contains(classes.fullScreen))\n    || stylePropCompare({\n      element: domElement,\n      pseudoSelector: \":before\",\n      prop: \"content\",\n      contains: `\"${\"full_screen\"}\"`\n    });\n\n  // DOM elements\n  useEffect(\n    () => {\n      if (!domElement) {\n        return;\n      }\n      backdropElRef.current = domElement.querySelector(`.${classes.backdrop}`);\n      touchElRef.current = domElement.querySelector(`.${classes.touch}`);\n      contentElRef.current = domElement.querySelector(`.${classes.content}`);\n    },\n    [domElement]\n  );\n\n  // Handle Escape key\n  useEffect(\n    () => {\n      if (!domElement || props.inactive) {\n        return;\n      }\n      const handleEscape = e => {\n        if (props.disableEscape && (isFullScreen() || isModal())) return;\n        if (e.key === \"Escape\" || e.key === \"Esc\") { // \"Esc\" for IE11\n          const openDialogs = document.querySelectorAll(openDialogsSelector);\n          if (openDialogs[openDialogs.length - 1] === domElement) {\n            hideDialog({ hideDelay: 0, referrer: REFERRER_COMPONENT });\n          }\n        }\n      };\n      subscribe(\"keydown\", handleEscape);\n\n      return () => {\n        unsubscribe(\"keydown\", handleEscape);\n      };\n    },\n    [domElement, props.inactive]\n  );\n  \n  // Show / hide logic\n  useEffect(\n    () => {\n      if (!domElement || isTransitioning || isHiding) {\n        return;\n      }\n      if (props.hide) {\n        if (isVisible) {\n          hideDialog();\n        }\n      } else if (props.show) {\n        if (!isVisible) {\n          showDialog();\n        }\n      }\n    },\n    [domElement, isTransitioning, isHiding, isVisible, props.hide, props.show]\n  );\n  \n  const componentProps = Object.assign(\n    {}, \n    filterSupportedAttributes(props, { remove: [\"style\"] }), // style set in content, and set by show/hide transition\n    getRef(dom => dom && !domElement && (\n      setDomElement(dom),\n      props.ref && props.ref(dom)\n    )),\n    {\n      className: [\n        props.parentClassName || classes.component,\n        props.fromMultipleClassName,\n        props.fullScreen ? classes.fullScreen : null,\n        props.modal ? classes.modal : null,\n        props.backdrop ? classes.showBackdrop : null,\n        // classes.visible is set in showDialog though transition\n        props.tone === \"dark\" ? \"pe-dark-tone\" : null,\n        props.tone === \"light\" ? \"pe-light-tone\" : null,\n        props.className || props[a.class],\n      ].join(\" \"),\n      \"data-spawn-id\": props.spawnId,       // received from Multi\n      \"data-instance-id\": props.instanceId, // received from Multi\n      // click backdrop: close dialog\n      [a.onclick]: e => {\n        if (e.target !== domElement && e.target !== backdropElRef.current && e.target !== touchElRef.current) {\n          return;\n        }\n        if (isModal()) {\n          // not allowed\n          return;\n        }\n        hideDialog({ referrer: REFERRER_COMPONENT });\n      }\n    }\n  );\n\n  const pane = props.panesOptions && props.panesOptions.length\n    ? h(Pane, props.panesOptions[0])\n    : props.panes && props.panes.length\n      ? props.panes[0]\n      : createPane({ h, Pane, props });\n  const shadowDepth = props.shadowDepth;\n\n  const content = [\n    h(\"div\",\n      {\n        key: \"backdrop\",\n        className: classes.backdrop\n      }\n    ),\n    h(\"div\",\n      {\n        key: \"touch\",\n        className: classes.touch\n      }\n    ),\n    h(\"div\",\n      {\n        className: [\n          classes.content,\n          props.menu ? classes.menuContent : null\n        ].join(\" \"),\n        key: \"content\"\n      },\n      [\n        props.fullScreen\n          ? null\n          : h(Shadow, {\n            shadowDepth: shadowDepth !== undefined\n              ? shadowDepth\n              : DEFAULT_SHADOW_DEPTH,\n            animated: true,\n            key: \"shadow\"\n          }),\n        props.before,\n        pane,\n        props.after,\n      ]\n    )\n  ];\n  return h(props.element || \"div\", componentProps, content);\n};\n"],"names":["component","placeholder","holder","content","backdrop","touch","fullScreen","modal","open","visible","showBackdrop","transition","menuContent","openDialogsSelector","classes","initialTransitionState","isVisible","isTransitioning","isHiding","h","a","useState","useEffect","useRef","getRef","useReducer","Pane","Shadow","props","transitionStateReducer","transitionState","dispatchTransitionState","domElement","setDomElement","backdropElRef","touchElRef","contentElRef","transitionOptions","isShow","hideDelay","referrer","instanceId","_extends","domElements","el","contentEl","current","backdropEl","showClass","transitionClass","hideDialog","transitionComponent","isModal","classList","contains","stylePropCompare","element","pseudoSelector","prop","querySelector","inactive","handleEscape","e","disableEscape","key","openDialogs","document","querySelectorAll","length","REFERRER_COMPONENT","subscribe","unsubscribe","hide","show","componentProps","filterSupportedAttributes","remove","dom","ref","className","parentClassName","fromMultipleClassName","tone","join","spawnId","onclick","target","pane","panesOptions","panes","body","menu","children","borders","footer","footerButtons","formOptions","fullBleed","header","style","title","createPane","shadowDepth","undefined","animated","before","after"],"mappings":"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"}